import{j as a,bu as F,B as w,h as L,ac as T,Y as g,k,aw as A,T as U,I as W,aE as B,bh as R,bv as $,C as z}from"./mui-vendor-DlldRxor.js";import{a as v}from"./react-vendor-C0s_J9t-.js";import{i as M,am as I,I as V}from"./index-D4QRAU_W.js";const G={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"95%",maxWidth:{xs:"100%",sm:550,md:600},maxHeight:{xs:"90vh",sm:"85vh"},overflow:"auto",bgcolor:"background.paper",boxShadow:24,p:{xs:2,sm:3,md:4},borderRadius:1},X=({product:i,onClose:s,onSave:d})=>{const[o,p]=v.useState({name:i.name,description:i.description}),h=c=>r=>{p(m=>({...m,[c]:r.target.value}))},x=c=>{c.preventDefault(),d(i.sku,o)};return a.jsx(F,{open:!0,onClose:s,children:a.jsxs(w,{sx:G,children:[a.jsx(L,{variant:"h6",component:"h2",gutterBottom:!0,children:"Edit Product"}),a.jsx("form",{onSubmit:x,children:a.jsxs(T,{spacing:3,children:[a.jsx(g,{label:"SKU",value:i.sku,disabled:!0,fullWidth:!0,inputProps:{"aria-label":"SKU"}}),a.jsx(g,{label:"Platform",value:i.platform,disabled:!0,fullWidth:!0,inputProps:{"aria-label":"Platform"}}),a.jsx(g,{label:"Name",value:o.name,onChange:h("name"),fullWidth:!0,required:!0,inputProps:{"aria-label":"Name"}}),a.jsx(g,{label:"Description",value:o.description,onChange:h("description"),fullWidth:!0,multiline:!0,rows:3,required:!0,inputProps:{"aria-label":"Description"}}),a.jsxs(w,{display:"flex",gap:2,justifyContent:"flex-end",children:[a.jsx(k,{onClick:s,color:"inherit",children:"Cancel"}),a.jsx(k,{type:"submit",variant:"contained",color:"primary",children:"Save Changes"})]})]})})]})})},l=i=>{if(i==null)return"";const s=String(i);return s.includes(",")||s.includes('"')||s.includes(`
`)?`"${s.replace(/"/g,'""')}"`:s},O=i=>{if(!i)return"";try{return i.toDate().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch(s){return console.warn("Error formatting timestamp:",s),""}},K=(i,s=[])=>{const d=new Map(s.map(e=>[e.id,e.name])),o=["SKU","Name","Description","Platform","Visibility","Selling Price","Category","Listing Status","MOQ","Amazon Serial Number","Flipkart Serial Number","Created At","Updated At","Last Imported From","Exists On Seller Page","Competition Analysis"],p=i.map(e=>{var u,f,y,b,C,j,S;return[l(e.sku),l(e.name),l(e.description),l(e.platform),l(e.visibility),l(e.sellingPrice),l(e.categoryId?d.get(e.categoryId)||"Unknown Category":"Uncategorized"),l((u=e.metadata)==null?void 0:u.listingStatus),l((f=e.metadata)==null?void 0:f.moq),l((y=e.metadata)==null?void 0:y.amazonSerialNumber),l((b=e.metadata)==null?void 0:b.flipkartSerialNumber),l((C=e.metadata)!=null&&C.createdAt?O(e.metadata.createdAt):""),l((j=e.metadata)!=null&&j.updatedAt?O(e.metadata.updatedAt):""),l((S=e.metadata)==null?void 0:S.lastImportedFrom),l(e.existsOnSellerPage!==void 0?e.existsOnSellerPage?"Yes":"No":""),l(e.competitionAnalysis?`Competitor: ${e.competitionAnalysis.competitorName}, Price: ${e.competitionAnalysis.competitorPrice}, Total Sellers: ${e.competitionAnalysis.totalSellers}`:"")]}),h=[o.join(","),...p.map(e=>e.join(","))].join(`
`),x=new Blob([h],{type:"text/csv;charset=utf-8;"}),c=window.URL.createObjectURL(x),r=document.createElement("a"),m=new Date().toISOString().split("T")[0];r.href=c,r.download=`products-export-${m}.csv`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(c)},q=$(),Z=({platform:i,search:s,selectedProducts:d,categories:o,allProducts:p,onFilterChange:h,onBulkCategoryUpdate:x})=>{const c=M(),[r,m]=v.useState(null),[e,u]=v.useState(""),[f,y]=v.useState(!1),b=n=>{const t=n.target.value;h({platform:t===""?void 0:t,search:s})},C=n=>{const t=n.target.value;h({platform:i,search:t})},j=()=>{K(p,o)},S=async()=>{if(e){y(!0);try{const n=await c(I({name:e}));if(I.fulfilled.match(n)&&typeof n.payload=="string"){const t=n.payload;d.length>0&&await x(d,t),c(V()),u(""),m(null)}}catch{}finally{y(!1)}}},N=async()=>{if(d.length>0&&r)try{await x(d,r),m(null)}catch{}};return a.jsxs(w,{sx:{mb:2,display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,alignItems:"center"},children:[a.jsxs(g,{select:!0,label:"Platform",value:i??"",onChange:b,sx:{minWidth:{xs:"100%",sm:200},flexGrow:{xs:1,sm:0}},children:[a.jsx(A,{value:"",children:"All"}),a.jsx(A,{value:"amazon",children:"Amazon"}),a.jsx(A,{value:"flipkart",children:"Flipkart"})]}),a.jsx(g,{label:"Search",value:s,onChange:C,sx:{minWidth:{xs:"100%",sm:200},flexGrow:1}}),a.jsx(U,{title:"Export all products to CSV",children:a.jsx(W,{onClick:j,color:"primary",disabled:p.length===0,sx:{border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white"}},children:a.jsx(B,{})})}),d.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(R,{options:o,getOptionLabel:n=>typeof n=="string"?n:n.name,value:o.find(n=>n.id===r)||null,onChange:(n,t)=>{t&&typeof t=="object"&&"inputValue"in t?(u(t.inputValue),m(null)):t&&typeof t=="object"?(m(t.id||null),u("")):t===null?(m(null),u("")):typeof t=="string"&&(u(t),m(null))},filterOptions:(n,t)=>{const P=[...q(o,t)],D=o.map(E=>E.name.toLowerCase());return t.inputValue!==""&&!D.includes(t.inputValue.toLowerCase())&&P.push({id:`add-${t.inputValue}`,name:`Add "${t.inputValue}"`,inputValue:t.inputValue}),P},selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,freeSolo:!0,renderOption:(n,t)=>a.jsx("li",{...n,children:typeof t=="string"?t:t.name}),renderInput:n=>a.jsx(g,{...n,label:"Assign Category",variant:"outlined",sx:{minWidth:{xs:"100%",sm:200},flexGrow:{xs:1,sm:.5}}})}),a.jsxs(k,{variant:"contained",onClick:()=>{e?S():r&&N()},disabled:!r&&!e||f,startIcon:f?a.jsx(z,{size:20,color:"inherit"}):null,sx:{minWidth:{xs:"100%",sm:150},flexGrow:{xs:1,sm:0}},children:[f?"Adding...":e?"Add & Assign":"Assign"," (",d.length,")"]})]})]})};export{Z as P,X as a};
