import{j as e,B as i,h as p,ai as x,aT as k,aq as D,I as A,ah as b,C as m,A as B,ak as P,k as R}from"./mui-vendor-DlldRxor.js";import{a as d}from"./react-vendor-C0s_J9t-.js";import{M as L}from"./MobileAppShell-dHUJWRrR.js";import{u as E,M as W}from"./useInfiniteScroll-C2oDQ5Wg.js";import{M as $}from"./MobileCard-BmxjauOU.js";import{I as G}from"./InventoryStatusChip-Dd2kFZgD.js";import{i as Q,j as g,E as j}from"./index-D4QRAU_W.js";import{u as T}from"./usePullToRefresh-C2FNOxJ5.js";import{C as F}from"./categories.page-zCuKk1tg.js";import"./redux-vendor-tKFe_QvA.js";import"./firebase-vendor-40dJGoDN.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-DisdNAgy.js";import"./DataTable-CqcHOsap.js";const H=({category:t,productCount:l=0,inventoryStatus:a,currentInventory:c,onTap:r})=>{const f=t.inventoryDeductionQuantity&&t.inventoryDeductionQuantity>0;return e.jsx($,{onClick:()=>r==null?void 0:r(t),sx:{minHeight:88,cursor:"pointer",width:"100%"},contentPadding:0,children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1,p:2,width:"100%"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:1},children:[e.jsx(p,{variant:"h6",sx:{fontWeight:600,fontSize:"16px",flex:1},children:t.name}),a&&e.jsx(G,{status:a})]}),t.description&&e.jsx(p,{variant:"body2",color:"text.secondary",sx:{fontSize:"14px"},children:t.description}),e.jsxs(i,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap",mt:.5},children:[e.jsx(x,{icon:e.jsx(k,{}),label:`${l} products`,size:"small",variant:"outlined",sx:{fontSize:"12px",height:28}}),f&&e.jsx(D,{badgeContent:t.inventoryDeductionQuantity,color:"primary",children:e.jsx(x,{label:"Auto Deduction",size:"small",color:"primary",sx:{fontSize:"12px",height:28}})}),t.costPrice&&e.jsx(x,{label:`â‚¹${t.costPrice.toFixed(2)}`,size:"small",color:"success",variant:"outlined",sx:{fontSize:"12px",height:28}}),typeof c=="number"&&e.jsx(x,{label:`Stock: ${c} ${t.inventoryUnit||"units"}`,size:"small",variant:"outlined",sx:{fontSize:"12px",height:28}}),t.categoryGroup&&e.jsx(x,{label:t.categoryGroup.name,size:"small",sx:{fontSize:"12px",height:28,backgroundColor:t.categoryGroup.color,color:"#fff"}})]})]})})},oe=()=>{const t=Q(),l=g(s=>{var o;return((o=s.categories)==null?void 0:o.items)||[]}),a=g(s=>{var o;return((o=s.categories)==null?void 0:o.loading)||!1}),c=g(s=>{var o;return((o=s.categories)==null?void 0:o.error)||null}),[r,f]=d.useState(""),[h,I]=d.useState(20),[S,u]=d.useState(!1),{state:y,containerRef:v}=T(async()=>{await t(j()).unwrap()},{threshold:80,enabled:!0}),n=d.useMemo(()=>{if(!r)return l;const s=r.toLowerCase();return l.filter(o=>o.name.toLowerCase().includes(s)||o.description&&o.description.toLowerCase().includes(s))},[l,r]),C=n.slice(0,h),{sentinelRef:z}=E({onLoadMore:()=>{h<n.length&&I(s=>Math.min(s+20,n.length))},isLoading:a,hasMore:h<n.length,threshold:100});d.useEffect(()=>{t(j())},[t]);const M=s=>{},w=()=>{t(j()),u(!1)};return e.jsx(L,{pageTitle:"Categories",children:e.jsxs(i,{ref:v,sx:{display:"flex",flexDirection:"column",flex:1,overflow:"auto",backgroundColor:"background.default",width:"100%"},children:[e.jsxs(i,{sx:{position:"sticky",top:0,zIndex:1,backgroundColor:"background.paper",borderBottom:1,borderColor:"divider",width:"100%"},children:[e.jsx(i,{sx:{px:2,pt:2,pb:1},children:e.jsx(W,{value:r,onChange:f,placeholder:"Search categories...",autoFocus:!1})}),e.jsxs(i,{sx:{px:2,pb:1.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(p,{variant:"h6",sx:{fontWeight:600},children:[n.length," ",n.length===1?"Category":"Categories"]}),e.jsx(A,{onClick:()=>u(!0),sx:{minWidth:44,minHeight:44},"aria-label":"Import categories",children:e.jsx(b,{})})]})]}),y.isRefreshing&&e.jsx(i,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(m,{size:24})}),c&&e.jsx(B,{severity:"error",sx:{m:2},children:c}),a&&!y.isRefreshing&&e.jsx(i,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(m,{})}),!a&&n.length===0&&e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,p:4,textAlign:"center",gap:2},children:[e.jsx(P,{sx:{fontSize:48,color:"text.secondary"}}),e.jsx(p,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No categories found"}),e.jsx(p,{variant:"body2",color:"text.secondary",children:r?"Try a different search term":"Import categories to get started"}),!r&&e.jsx(R,{variant:"contained",onClick:()=>u(!0),startIcon:e.jsx(b,{}),sx:{mt:2},children:"Import Categories"})]}),!a&&C.length>0&&e.jsxs(i,{sx:{px:2,py:2,display:"flex",flexDirection:"column",gap:2,width:"100%"},children:[C.map(s=>e.jsx(H,{category:s,onTap:M},s.id)),e.jsx("div",{ref:z,style:{height:20}}),h<n.length&&e.jsx(i,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(m,{size:24})})]}),e.jsx(F,{open:S,onClose:()=>u(!1),onImportSuccess:w})]})})};export{oe as MobileCategoriesPage};
