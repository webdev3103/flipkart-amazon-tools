const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MobileDashboardPage-CdBiZFNJ.js","assets/mui-vendor-DlldRxor.js","assets/react-vendor-C0s_J9t-.js","assets/MobileAppShell-dHUJWRrR.js","assets/index-D4QRAU_W.js","assets/redux-vendor-tKFe_QvA.js","assets/firebase-vendor-40dJGoDN.js","assets/utils-vendor-CFocuF-S.js","assets/pdf-vendor-DisdNAgy.js","assets/usePullToRefresh-C2FNOxJ5.js","assets/transactionAnalysis.service-DrepQx6p.js","assets/pdfStorageService-DGuhzLre.js","assets/formatDistanceToNow-Df0H9vuf.js","assets/endOfMonth-CxaODxht.js","assets/generateCategoricalChart-B6_j-LNJ.js","assets/PieChart-oV72AkmV.js"])))=>i.map(i=>d[i]);
import{_ as Te}from"./pdf-vendor-DisdNAgy.js";import{j as e,a3 as j,C as P,ab as Q,h as s,k as I,B as n,ac as E,ad as ge,D as Z,ae as oe,af as De,ag as ee,ah as xe,ai as M,p as pe,r as je,o as Re,aj as Le,A as he,ak as Pe,al as We,am as Fe,an as Ee,ao as Me,ap as _e,S as Be,aq as Oe,T as $,I as te,ar as me,a9 as m,Y as Ue,Z as Ne,as as $e,at as V,au as H,av as q,aw as A,ax as Ge,V as Ve,ay as He,az as qe,aA as Ye,c as ie,aB as Ke,E as ue,W as Ze,G as fe,aC as Xe,u as Je,d as Qe,R as se,aD as et}from"./mui-vendor-DlldRxor.js";import{b as R,L as W,a as z}from"./react-vendor-C0s_J9t-.js";import{i as ye,j as D,s as tt,k as st,m as rt,n as nt,o as ot,p as it,q as re,t as at,v as lt,w as ct,x as dt,y as xt,u as ht,z as mt,A as ut,B as gt,C as pt,D as jt,E as ft,F as yt}from"./index-D4QRAU_W.js";import{T as vt}from"./transactionAnalysis.service-DrepQx6p.js";import{p as bt}from"./pdfStorageService-DGuhzLre.js";import{f as kt}from"./formatDistanceToNow-Df0H9vuf.js";import{R as ve,C as It,T as be,L as ke,a as wt,X as At,Y as Ct}from"./generateCategoricalChart-B6_j-LNJ.js";import{P as St,a as zt,L as Tt,b as Dt}from"./PieChart-oV72AkmV.js";const Rt=({transactions:i,products:c,loading:y})=>{const[k,x]=R.useState({totalProfit:0,totalExpenses:0,totalSales:0,profitMargin:0}),[f,u]=R.useState(!1);return R.useEffect(()=>{if(!i.length){x({totalProfit:0,totalExpenses:0,totalSales:0,profitMargin:0});return}(async()=>{u(!0);try{const h=new Map(c.map(r=>[r.sku,{sku:r.sku,name:r.name,basePrice:r.sellingPrice}])),a=await new vt(i,h).analyze();x({totalProfit:a.totalProfit||0,totalExpenses:a.totalExpenses||0,totalSales:a.totalSales||0,profitMargin:a.totalSales>0?a.totalProfit/a.totalSales*100:0})}catch(h){console.error("Error analyzing transactions:",h)}finally{u(!1)}})()},[i,c]),y||f?e.jsx(j,{sx:{p:3,height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(P,{size:24})}):i.length?e.jsxs(j,{sx:{p:2,height:"100%",border:"1px solid",borderColor:"divider"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Q,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",component:"h2",sx:{color:"primary.dark",fontWeight:"bold"},children:"Profit Summary"})]}),e.jsxs(E,{spacing:2,children:[e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:.5},children:[e.jsx(ge,{sx:{fontSize:20,mr:1,color:"success.main"}}),e.jsx(s,{variant:"caption",color:"text.secondary",fontWeight:"medium",children:"Total Profit"})]}),e.jsxs(s,{variant:"h5",sx:{fontWeight:"bold",color:"success.dark"},children:["₹",k.totalProfit.toLocaleString(void 0,{maximumFractionDigits:0})]})]}),e.jsx(Z,{}),e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:.5},children:[e.jsx(oe,{sx:{fontSize:20,mr:1,color:"error.main"}}),e.jsx(s,{variant:"caption",color:"text.secondary",fontWeight:"medium",children:"Total Expenses"})]}),e.jsxs(s,{variant:"h6",sx:{fontWeight:"bold",color:"error.dark"},children:["₹",k.totalExpenses.toLocaleString(void 0,{maximumFractionDigits:0})]})]}),e.jsx(Z,{}),e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:.5},children:[e.jsx(De,{sx:{fontSize:20,mr:1,color:"info.main"}}),e.jsx(s,{variant:"caption",color:"text.secondary",fontWeight:"medium",children:"Profit Margin"})]}),e.jsxs(s,{variant:"h6",sx:{fontWeight:"bold",color:"info.dark"},children:[k.profitMargin.toFixed(1),"%"]})]})]}),e.jsx(n,{sx:{mt:3,textAlign:"center"},children:e.jsx(I,{variant:"outlined",component:W,to:"/order-analytics/",size:"small",startIcon:e.jsx(Q,{}),fullWidth:!0,children:"View Analytics"})}),e.jsx(n,{sx:{mt:2,pt:1.5,borderTop:"1px solid",borderColor:"divider"},children:e.jsxs(s,{variant:"caption",color:"text.secondary",align:"center",display:"block",children:["Based on ",i.length," transactions"]})})]}):e.jsxs(j,{sx:{p:3,height:"100%",textAlign:"center"},children:[e.jsx(Q,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Transaction Data"}),e.jsx(s,{variant:"body2",color:"text.secondary",mb:2,children:"Process orders to see profitability insights"}),e.jsx(I,{variant:"outlined",component:W,to:"/home/",size:"small",children:"Upload Invoices"})]})},Lt=({maxItems:i=5})=>{const[c,y]=R.useState([]),[k,x]=R.useState(!0),[f,u]=R.useState(null);return R.useEffect(()=>{(async()=>{x(!0),u(null);try{const v=(await bt.listAllPdfs()).sort((a,r)=>r.metadata.uploadedAt-a.metadata.uploadedAt).slice(0,i);y(v)}catch(h){console.error("Error fetching PDFs:",h),u("Failed to load PDF uploads")}finally{x(!1)}})()},[i]),k?e.jsx(j,{sx:{p:3,height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(P,{size:24})}):f?e.jsxs(j,{sx:{p:3,height:"100%",textAlign:"center"},children:[e.jsx(ee,{sx:{fontSize:48,color:"error.main",mb:2}}),e.jsx(s,{variant:"h6",color:"error",gutterBottom:!0,children:f}),e.jsx(I,{variant:"outlined",onClick:()=>window.location.reload(),size:"small",children:"Retry"})]}):c.length===0?e.jsxs(j,{sx:{p:3,height:"100%",textAlign:"center"},children:[e.jsx(ee,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No PDFs Uploaded Yet"}),e.jsx(s,{variant:"body2",color:"text.secondary",mb:2,children:"Upload Amazon/Flipkart invoices to get started"}),e.jsx(I,{variant:"contained",component:W,to:"/home/",startIcon:e.jsx(xe,{}),size:"small",children:"Upload Invoices"})]}):e.jsxs(j,{sx:{p:2,height:"100%",border:"1px solid",borderColor:"divider"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(ee,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",component:"h2",sx:{color:"primary.dark",fontWeight:"bold"},children:"Recent PDF Uploads"}),e.jsx(M,{label:c.length,color:"primary",size:"small",sx:{ml:1}})]}),e.jsx(pe,{dense:!0,sx:{mb:1},children:c.map((d,h)=>{var v;return e.jsx(je,{sx:{mb:1,borderRadius:1,bgcolor:"background.paper",border:"1px solid",borderColor:"divider","&:hover":{bgcolor:"action.hover"}},children:e.jsx(Re,{primary:e.jsx(s,{variant:"body2",noWrap:!0,title:d.metadata.originalFileName,children:d.metadata.originalFileName.length>35?`${d.metadata.originalFileName.substring(0,35)}...`:d.metadata.originalFileName}),secondary:e.jsxs(E,{direction:"row",spacing:1,sx:{mt:.5},children:[((v=d.metadata.stats)==null?void 0:v.productCount)&&e.jsx(M,{label:`${d.metadata.stats.productCount} products`,size:"small",sx:{height:18,fontSize:"0.65rem"},color:"info"}),e.jsx(s,{variant:"caption",color:"text.secondary",component:"span",children:kt(new Date(d.metadata.uploadedAt),{addSuffix:!0})})]})})},d.fileId||h)})}),e.jsxs(E,{direction:"row",spacing:1,justifyContent:"center",sx:{mt:2},children:[e.jsx(I,{variant:"contained",component:W,to:"/home/",size:"small",startIcon:e.jsx(xe,{}),sx:{fontSize:"0.75rem"},children:"Upload New"}),e.jsx(I,{variant:"outlined",component:W,to:"/storage-management/",size:"small",startIcon:e.jsx(Le,{}),sx:{fontSize:"0.75rem"},children:"View All Files"})]}),c.length>0&&e.jsx(n,{sx:{mt:2,pt:1.5,borderTop:"1px solid",borderColor:"divider"},children:e.jsxs(s,{variant:"caption",color:"text.secondary",align:"center",display:"block",children:["Showing ",c.length," most recent uploads"]})})]})},Y={low:"#2e7d32",medium:"#e65100",high:"#c62828",critical:"#b71c1c"},Pt={low_stock:e.jsx(Ze,{}),zero_stock:e.jsx(ue,{}),negative_stock:e.jsx(ue,{color:"error"})},K={low_stock:"Low Stock",zero_stock:"Zero Stock",negative_stock:"Negative Stock"},Wt=({variant:i="full",maxAlertsInWidget:c=5,onManualAdjustment:y,onViewCategoryGroup:k})=>{const x=ye(),f=D(tt),u=D(st),d=D(rt),h=D(nt),v=D(ot),a=D(it),[r,l]=z.useState({severity:"all",alertType:"all",categoryGroupId:"all",status:"active",search:""}),[g,b]=z.useState({open:!1,message:"",severity:"success"}),[T,C]=z.useState({open:!1,alertId:"",action:"",alertInfo:""}),[L,p]=z.useState(!1),[_,G]=z.useState(),O=z.useMemo(()=>v.reduce((t,o)=>(o.id&&(t[o.id]=o),t),{}),[v]),F=z.useMemo(()=>{let t=f;if(r.status==="active"?t=t.filter(o=>o.isActive):r.status==="acknowledged"?t=t.filter(o=>o.acknowledgedBy&&o.isActive):r.status==="resolved"&&(t=t.filter(o=>!o.isActive)),r.severity!=="all"&&(t=t.filter(o=>o.severity===r.severity)),r.alertType!=="all"&&(t=t.filter(o=>o.alertType===r.alertType)),r.categoryGroupId!=="all"&&(t=t.filter(o=>o.categoryGroupId===r.categoryGroupId)),r.search){const o=r.search.toLowerCase();t=t.filter(w=>{const S=O[w.categoryGroupId];return(S==null?void 0:S.name.toLowerCase().includes(o))||(S==null?void 0:S.description.toLowerCase().includes(o))||K[w.alertType].toLowerCase().includes(o)})}return t.sort((o,w)=>{var ce,de;const S={critical:0,high:1,medium:2,low:3},B=S[o.severity]-S[w.severity];if(B!==0)return B;const N=((ce=o.createdAt)==null?void 0:ce.toDate().getTime())||0;return(((de=w.createdAt)==null?void 0:de.toDate().getTime())||0)-N})},[f,r,O]),ae=z.useMemo(()=>i==="widget"?F.slice(0,c):F,[F,i,c]);z.useEffect(()=>{x(re()),x(at())},[x]),z.useEffect(()=>{if(L){const t=setInterval(()=>{x(re())},3e4);G(t)}else _&&(clearInterval(_),G(void 0));return()=>{_&&clearInterval(_)}},[L,x]),z.useEffect(()=>{h.alertAcknowledgment&&(b({open:!0,message:h.alertAcknowledgment,severity:"error"}),x(lt())),h.alertResolution&&(b({open:!0,message:h.alertResolution,severity:"error"}),x(ct()))},[h.alertAcknowledgment,h.alertResolution,x]);const Ie=()=>{x(re())},U=(t,o)=>{l(w=>({...w,[t]:o}))},we=()=>{l({severity:"all",alertType:"all",categoryGroupId:"all",status:"active",search:""})},le=(t,o,w)=>{C({open:!0,alertId:t,action:o,alertInfo:w})},Ae=async()=>{if(!(a!=null&&a.uid)){b({open:!0,message:"User not authenticated",severity:"error"});return}const{alertId:t,action:o}=T;try{o==="acknowledge"?(await x(dt({alertId:t,acknowledgedBy:a.uid})).unwrap(),b({open:!0,message:"Alert acknowledged successfully",severity:"success"})):o==="resolve"&&(await x(xt({alertId:t,acknowledgedBy:a.uid})).unwrap(),b({open:!0,message:"Alert resolved successfully",severity:"success"}))}catch(w){b({open:!0,message:`Failed to ${o} alert: ${w}`,severity:"error"})}C({open:!1,alertId:"",action:"acknowledge",alertInfo:""})},X=t=>{if(!t)return"Unknown";let o;typeof t=="object"&&t&&"toDate"in t&&typeof t.toDate=="function"?o=t.toDate():o=new Date(t);const S=new Date().getTime()-o.getTime(),B=Math.floor(S/(1e3*60)),N=Math.floor(B/60),J=Math.floor(N/24);return B<1?"Just now":B<60?`${B}m ago`:N<24?`${N}h ago`:J<7?`${J}d ago`:o.toLocaleDateString()},Ce=t=>{const o=O[t.categoryGroupId],w=!!t.acknowledgedBy,S=!t.isActive;return e.jsx(Ve,{sx:{mb:2,border:`2px solid ${Y[t.severity]}`,opacity:S?.6:1,"&:hover":{boxShadow:4}},children:e.jsx(He,{children:e.jsxs(m,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(m,{item:!0,xs:12,sm:3,children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(n,{sx:{color:Y[t.severity],display:"flex",alignItems:"center"},children:Pt[t.alertType]}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:K[t.alertType]}),e.jsx(M,{label:t.severity.toUpperCase(),size:"small",sx:{backgroundColor:Y[t.severity],color:"#ffffff",fontWeight:"bold","&:hover":{backgroundColor:Y[t.severity],filter:"brightness(0.9)"}}})]})]})}),e.jsx(m,{item:!0,xs:12,sm:4,children:e.jsxs(n,{children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,mb:1,children:[o&&e.jsx(n,{sx:{width:12,height:12,backgroundColor:o.color,borderRadius:"50%"}}),e.jsx(s,{variant:"body1",fontWeight:"medium",children:(o==null?void 0:o.name)||"Unknown Category"})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Current: ",e.jsxs("strong",{children:[t.currentLevel," ",t.unit]})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Threshold: ",e.jsxs("strong",{children:[t.thresholdLevel," ",t.unit]})]})]})}),e.jsx(m,{item:!0,xs:12,sm:3,children:e.jsxs(n,{children:[e.jsxs(s,{variant:"body2",color:"text.secondary",display:"flex",alignItems:"center",gap:.5,children:[e.jsx(qe,{fontSize:"small"}),"Created: ",X(t.createdAt)]}),w&&e.jsxs(s,{variant:"body2",color:"text.secondary",display:"flex",alignItems:"center",gap:.5,children:[e.jsx(Ye,{fontSize:"small"}),"Acknowledged: ",X(t.acknowledgedAt)]}),S&&e.jsxs(s,{variant:"body2",color:"text.secondary",display:"flex",alignItems:"center",gap:.5,children:[e.jsx(ie,{fontSize:"small"}),"Resolved: ",X(t.resolvedAt)]})]})}),e.jsx(m,{item:!0,xs:12,sm:2,children:e.jsxs(E,{direction:"row",spacing:1,justifyContent:"flex-end",children:[t.isActive&&!w&&e.jsx($,{title:"Acknowledge Alert",children:e.jsx(te,{size:"small",onClick:()=>le(t.id,"acknowledge",`${o==null?void 0:o.name} - ${K[t.alertType]}`),disabled:d.alertAcknowledgment,children:e.jsx(Ke,{})})}),t.isActive&&e.jsx($,{title:"Resolve Alert",children:e.jsx(te,{size:"small",color:"success",onClick:()=>le(t.id,"resolve",`${o==null?void 0:o.name} - ${K[t.alertType]}`),disabled:d.alertResolution,children:e.jsx(ie,{})})}),y&&t.isActive&&e.jsx($,{title:"Manual Adjustment",children:e.jsx(I,{size:"small",variant:"outlined",onClick:()=>y(t.categoryGroupId),children:"Adjust"})}),k&&e.jsx($,{title:"View Category Group",children:e.jsx(I,{size:"small",variant:"text",onClick:()=>k(t.categoryGroupId),children:"View"})})]})})]})})},t.id)},Se=()=>e.jsx(j,{sx:{p:2,mb:2},children:e.jsxs(m,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(m,{item:!0,xs:12,sm:6,md:2,children:e.jsx(Ue,{fullWidth:!0,size:"small",placeholder:"Search alerts...",value:r.search,onChange:t=>U("search",t.target.value),InputProps:{startAdornment:e.jsx(Ne,{position:"start",children:e.jsx($e,{})})}})}),e.jsx(m,{item:!0,xs:6,sm:3,md:2,children:e.jsxs(V,{fullWidth:!0,size:"small",children:[e.jsx(H,{children:"Status"}),e.jsxs(q,{value:r.status,label:"Status",onChange:t=>U("status",t.target.value),children:[e.jsx(A,{value:"all",children:"All"}),e.jsx(A,{value:"active",children:"Active"}),e.jsx(A,{value:"acknowledged",children:"Acknowledged"}),e.jsx(A,{value:"resolved",children:"Resolved"})]})]})}),e.jsx(m,{item:!0,xs:6,sm:3,md:2,children:e.jsxs(V,{fullWidth:!0,size:"small",children:[e.jsx(H,{children:"Severity"}),e.jsxs(q,{value:r.severity,label:"Severity",onChange:t=>U("severity",t.target.value),children:[e.jsx(A,{value:"all",children:"All"}),e.jsx(A,{value:"critical",children:"Critical"}),e.jsx(A,{value:"high",children:"High"}),e.jsx(A,{value:"medium",children:"Medium"}),e.jsx(A,{value:"low",children:"Low"})]})]})}),e.jsx(m,{item:!0,xs:6,sm:3,md:2,children:e.jsxs(V,{fullWidth:!0,size:"small",children:[e.jsx(H,{children:"Alert Type"}),e.jsxs(q,{value:r.alertType,label:"Alert Type",onChange:t=>U("alertType",t.target.value),children:[e.jsx(A,{value:"all",children:"All"}),e.jsx(A,{value:"low_stock",children:"Low Stock"}),e.jsx(A,{value:"zero_stock",children:"Zero Stock"}),e.jsx(A,{value:"negative_stock",children:"Negative Stock"})]})]})}),e.jsx(m,{item:!0,xs:6,sm:3,md:2,children:e.jsxs(V,{fullWidth:!0,size:"small",children:[e.jsx(H,{children:"Category Group"}),e.jsxs(q,{value:r.categoryGroupId,label:"Category Group",onChange:t=>U("categoryGroupId",t.target.value),children:[e.jsx(A,{value:"all",children:"All"}),v.map(t=>e.jsx(A,{value:t.id,children:t.name},t.id))]})]})}),e.jsx(m,{item:!0,xs:6,sm:3,md:2,children:e.jsx(E,{direction:"row",spacing:1,children:e.jsx(I,{variant:"outlined",size:"small",startIcon:e.jsx(Ge,{}),onClick:we,children:"Clear"})})})]})}),ze=()=>e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(s,{variant:i==="widget"?"h6":"h5",component:"h2",children:["Inventory Alerts",e.jsx(Oe,{badgeContent:u.length,color:"error",sx:{ml:1},children:e.jsx(n,{})})]}),e.jsxs(E,{direction:"row",spacing:1,children:[e.jsx($,{title:"Refresh Alerts",children:e.jsx(te,{onClick:Ie,disabled:d.inventoryAlerts,children:d.inventoryAlerts?e.jsx(P,{size:20}):e.jsx(me,{})})}),i==="full"&&e.jsx(I,{variant:L?"contained":"outlined",size:"small",onClick:()=>p(!L),startIcon:e.jsx(me,{}),children:"Auto Refresh"})]})]});return d.inventoryAlerts&&f.length===0?e.jsxs(n,{display:"flex",justifyContent:"center",alignItems:"center",p:4,children:[e.jsx(P,{}),e.jsx(s,{variant:"body1",sx:{ml:2},children:"Loading alerts..."})]}):e.jsxs(n,{children:[ze(),i==="full"&&Se(),h.inventoryAlerts&&e.jsx(he,{severity:"error",sx:{mb:2},children:h.inventoryAlerts}),ae.length===0?e.jsxs(j,{sx:{p:4,textAlign:"center"},children:[e.jsx(Pe,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(s,{variant:"h6",color:"text.secondary",children:"No alerts found"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:r.status==="active"?"All inventory levels are above their thresholds!":"Try adjusting your filters to see more alerts."})]}):e.jsxs(n,{children:[ae.map(Ce),i==="widget"&&F.length>c&&e.jsx(n,{textAlign:"center",mt:2,children:e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Showing ",c," of ",F.length," alerts"]})})]}),e.jsxs(We,{open:T.open,onClose:()=>C({open:!1,alertId:"",action:"acknowledge",alertInfo:""}),children:[e.jsx(Fe,{children:T.action==="acknowledge"?"Acknowledge Alert":"Resolve Alert"}),e.jsx(Ee,{children:e.jsxs(Me,{children:["Are you sure you want to ",T.action," this alert?",e.jsx("br",{}),e.jsx("strong",{children:T.alertInfo})]})}),e.jsxs(_e,{children:[e.jsx(I,{onClick:()=>C({open:!1,alertId:"",action:"acknowledge",alertInfo:""}),children:"Cancel"}),e.jsx(I,{onClick:Ae,color:"primary",variant:"contained",disabled:d.alertAcknowledgment||d.alertResolution,children:d.alertAcknowledgment||d.alertResolution?e.jsx(P,{size:20}):T.action==="acknowledge"?"Acknowledge":"Resolve"})]})]}),e.jsx(Be,{open:g.open,autoHideDuration:6e3,onClose:()=>b({...g,open:!1}),children:e.jsx(he,{onClose:()=>b({...g,open:!1}),severity:g.severity,children:g.message})})]})},Ft=({maxAlertsInWidget:i=5,onManualAdjustment:c,onViewCategoryGroup:y})=>e.jsx(Wt,{variant:"widget",maxAlertsInWidget:i,onManualAdjustment:c,onViewCategoryGroup:y}),Et=({maxAlertsInWidget:i=5})=>e.jsx(Ft,{maxAlertsInWidget:i,onManualAdjustment:c=>{console.log("Manual adjustment for category group:",c)},onViewCategoryGroup:c=>{console.log("View category group:",c)}}),Mt=({transactions:i,products:c,categories:y,loading:k,maxCategories:x=5})=>{const f=R.useMemo(()=>{if(!i.length||!c.length)return[];const u=new Map(c.map(r=>[r.sku,r.categoryId])),d=new Map(y.map(r=>[r.id,r])),h=new Map;i.forEach(r=>{var T;if(!["order","delivered","in_transit","return_cancelled"].includes(((T=r.type)==null?void 0:T.toLowerCase())||""))return;const g=u.get(r.sku);if(!g)return;const b=r.sellingPrice*r.quantity;h.set(g,(h.get(g)||0)+b)});const v=Array.from(h.values()).reduce((r,l)=>r+l,0);return Array.from(h.entries()).map(([r,l])=>{const g=d.get(r);return{categoryId:r,categoryName:(g==null?void 0:g.name)||"Unknown Category",revenue:l,percentage:v>0?l/v*100:0,color:g==null?void 0:g.color}}).sort((r,l)=>l.revenue-r.revenue).slice(0,x)},[i,c,y,x]);return k?e.jsx(j,{sx:{p:3,height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(P,{size:24})}):f.length===0?e.jsxs(j,{sx:{p:3,height:"100%",textAlign:"center"},children:[e.jsx(fe,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Category Data"}),e.jsx(s,{variant:"body2",color:"text.secondary",mb:2,children:"Process orders to see top categories by revenue"}),e.jsx(I,{variant:"outlined",component:W,to:"/home/",size:"small",children:"Upload Invoices"})]}):e.jsxs(j,{sx:{p:2,height:"100%",border:"1px solid",borderColor:"divider"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(ge,{sx:{mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",component:"h2",sx:{color:"primary.dark",fontWeight:"bold"},children:"Top Categories"}),e.jsx(M,{label:f.length,color:"primary",size:"small",sx:{ml:1}})]}),e.jsx(pe,{dense:!0,sx:{mb:1},children:f.map((u,d)=>e.jsxs(je,{sx:{mb:1.5,borderRadius:1,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",flexDirection:"column",alignItems:"flex-start",p:1.5},children:[e.jsxs(n,{sx:{width:"100%",display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(M,{label:`#${d+1}`,size:"small",color:"primary",sx:{height:20,fontSize:"0.7rem"}}),e.jsx(s,{variant:"body2",fontWeight:"medium",children:u.categoryName})]}),e.jsx(M,{label:`${u.percentage.toFixed(1)}%`,size:"small",sx:{height:20,fontSize:"0.7rem",bgcolor:"success.light"}})]}),e.jsxs(s,{variant:"h6",sx:{fontWeight:"bold",color:"primary.dark",mb:.5},children:["₹",u.revenue.toLocaleString(void 0,{maximumFractionDigits:0})]}),e.jsx(Xe,{variant:"determinate",value:u.percentage,sx:{width:"100%",height:6,borderRadius:1,bgcolor:"grey.200","& .MuiLinearProgress-bar":{bgcolor:u.color||"primary.main"}}})]},u.categoryId))}),e.jsx(n,{sx:{textAlign:"center",mt:2},children:e.jsx(I,{variant:"outlined",component:W,to:"/categories/",size:"small",fullWidth:!0,sx:{fontSize:"0.75rem"},children:"View All Categories"})}),e.jsx(n,{sx:{mt:2,pt:1.5,borderTop:"1px solid",borderColor:"divider"},children:e.jsxs(s,{variant:"caption",color:"text.secondary",align:"center",display:"block",children:["Top ",f.length," categories by revenue"]})})]})},ne={shipping:"#2196f3",marketplace:"#ff9800",other:"#9e9e9e"},_t=({transactions:i,loading:c})=>{const y=Je(),k=Qe(y.breakpoints.down("md")),[x,f]=R.useState([]),[u,d]=R.useState(0),[h,v]=R.useState(!1);R.useEffect(()=>{if(!i.length){f([]),d(0);return}(async()=>{v(!0);try{let l=0,g=0,b=0;i.forEach(L=>{L.expenses&&(l+=L.expenses.shippingFee||0,g+=L.expenses.marketplaceFee||0,b+=L.expenses.otherFees||0)});const T=l+g+b,C=[];l>0&&C.push({name:"Shipping",value:l,color:ne.shipping}),g>0&&C.push({name:"Marketplace Fees",value:g,color:ne.marketplace}),b>0&&C.push({name:"Other Fees",value:b,color:ne.other}),f(C),d(T)}catch(l){console.error("Error analyzing expenses:",l)}finally{v(!1)}})()},[i]);const a=({active:r,payload:l})=>{if(r&&l&&l.length){const g=l[0].payload,b=u>0?g.value/u*100:0;return e.jsxs(n,{sx:{backgroundColor:"background.paper",border:"1px solid #ccc",borderRadius:1,p:1.5,boxShadow:2},children:[e.jsx(s,{variant:"body2",fontWeight:"bold",mb:.5,children:g.name}),e.jsxs(s,{variant:"body2",color:"primary",children:["₹",g.value.toLocaleString(void 0,{maximumFractionDigits:0})]}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:[b.toFixed(1),"% of total"]})]})}return null};return c||h?e.jsx(j,{sx:{p:3,height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(P,{size:24})}):x.length===0?e.jsxs(j,{sx:{p:3,height:"100%",textAlign:"center"},children:[e.jsx(oe,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Expense Data"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Process orders to see expense breakdown"})]}):e.jsxs(j,{sx:{p:2,height:"100%",border:"1px solid",borderColor:"divider"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(oe,{sx:{mr:1,color:"error.main"}}),e.jsx(s,{variant:"h6",component:"h2",sx:{color:"error.dark",fontWeight:"bold"},children:"Expense Breakdown"})]}),e.jsxs(n,{sx:{textAlign:"center",mb:2},children:[e.jsx(s,{variant:"caption",color:"text.secondary",display:"block",children:"Total Expenses"}),e.jsxs(s,{variant:"h5",sx:{fontWeight:"bold",color:"error.dark"},children:["₹",u.toLocaleString(void 0,{maximumFractionDigits:0})]})]}),e.jsx(n,{sx:{height:k?200:220,mb:2},children:e.jsx(ve,{width:"100%",height:"100%",children:e.jsxs(St,{children:[e.jsx(zt,{data:x,cx:"50%",cy:"50%",outerRadius:k?60:70,innerRadius:k?30:35,paddingAngle:2,dataKey:"value",children:x.map((r,l)=>e.jsx(It,{fill:r.color},`cell-${l}`))}),e.jsx(be,{content:e.jsx(a,{})}),e.jsx(ke,{wrapperStyle:{fontSize:"12px"},iconType:"circle"})]})})}),e.jsx(n,{sx:{mt:2},children:x.map(r=>{const l=u>0?r.value/u*100:0;return e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,p:1,borderRadius:1,bgcolor:"background.default"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:r.color}}),e.jsx(s,{variant:"caption",fontWeight:"medium",children:r.name})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(s,{variant:"caption",color:"text.secondary",children:["₹",r.value.toLocaleString(void 0,{maximumFractionDigits:0})]}),e.jsx(M,{label:`${l.toFixed(0)}%`,size:"small",sx:{height:18,fontSize:"0.65rem"}})]})]},r.name)})}),e.jsx(n,{sx:{mt:2,pt:1.5,borderTop:"1px solid",borderColor:"divider"},children:e.jsxs(s,{variant:"caption",color:"text.secondary",align:"center",display:"block",children:["Based on ",i.length," transactions"]})})]})},Bt=({returns:i,loading:c})=>{var v;const y=i.length,k=i.reduce((a,r)=>a+r.financials.netLoss,0),x=i.filter(a=>a.resaleable).length,f=y>0?x/y*100:0,u=[...i].sort((a,r)=>new Date(r.dates.returnInitiatedDate).getTime()-new Date(a.dates.returnInitiatedDate).getTime()).slice(0,5),d=i.reduce((a,r)=>{const l=r.returnReasonCategory;return a[l]=(a[l]||0)+r.financials.netLoss,a},{}),h=((v=Object.entries(d).sort(([,a],[,r])=>r-a)[0])==null?void 0:v[0])||"N/A";return c?e.jsx(j,{sx:{p:3,height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(P,{size:24})}):y?e.jsxs(j,{sx:{p:2,height:"100%",border:"1px solid",borderColor:"divider"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(se,{sx:{mr:1,color:"warning.main"}}),e.jsx(s,{variant:"h6",component:"h2",sx:{color:"warning.dark",fontWeight:"bold"},children:"Returns Overview"})]}),e.jsxs(E,{spacing:2,children:[e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:.5},children:[e.jsx(et,{sx:{fontSize:20,mr:1,color:"error.main"}}),e.jsx(s,{variant:"caption",color:"text.secondary",fontWeight:"medium",children:"Total Net Loss"})]}),e.jsxs(s,{variant:"h5",sx:{fontWeight:"bold",color:"error.dark"},children:["₹",k.toLocaleString(void 0,{maximumFractionDigits:0})]})]}),e.jsx(Z,{}),e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:.5},children:[e.jsx(ie,{sx:{fontSize:20,mr:1,color:"success.main"}}),e.jsx(s,{variant:"caption",color:"text.secondary",fontWeight:"medium",children:"Resaleable Returns"})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"baseline",gap:1},children:[e.jsx(s,{variant:"h6",sx:{fontWeight:"bold",color:"success.dark"},children:x}),e.jsx(M,{label:`${f.toFixed(0)}%`,size:"small",color:"success",sx:{height:20,fontSize:"0.75rem"}})]})]}),e.jsx(Z,{}),e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:.5},children:[e.jsx(fe,{sx:{fontSize:20,mr:1,color:"info.main"}}),e.jsx(s,{variant:"caption",color:"text.secondary",fontWeight:"medium",children:"Top Loss Reason"})]}),e.jsx(s,{variant:"body2",sx:{fontWeight:"medium",color:"info.dark"},children:h})]})]}),u.length>0&&e.jsxs(n,{sx:{mt:2,pt:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsx(s,{variant:"caption",color:"text.secondary",fontWeight:"medium",display:"block",mb:1,children:"Recent Returns"}),e.jsx(E,{spacing:.5,children:u.slice(0,3).map(a=>e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:.5,borderRadius:.5,"&:hover":{bgcolor:"action.hover"}},children:[e.jsx(s,{variant:"caption",color:"text.secondary",sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.sku}),e.jsxs(s,{variant:"caption",sx:{fontWeight:"medium",color:a.financials.netLoss>0?"error.main":"success.main"},children:["₹",a.financials.netLoss.toFixed(0)]})]},a.returnId))})]}),e.jsx(n,{sx:{mt:3,textAlign:"center"},children:e.jsx(I,{variant:"outlined",component:W,to:"/flipkart-returns",size:"small",startIcon:e.jsx(se,{}),fullWidth:!0,children:"View All Returns"})}),e.jsx(n,{sx:{mt:2,pt:1.5,borderTop:"1px solid",borderColor:"divider"},children:e.jsxs(s,{variant:"caption",color:"text.secondary",align:"center",display:"block",children:[y," total returns"]})})]}):e.jsxs(j,{sx:{p:3,height:"100%",textAlign:"center"},children:[e.jsx(se,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Returns Data"}),e.jsx(s,{variant:"body2",color:"text.secondary",mb:2,children:"Upload Flipkart returns to see insights"}),e.jsx(I,{variant:"outlined",component:W,to:"/flipkart-returns/upload",size:"small",children:"Upload Returns"})]})},Ot=z.lazy(()=>Te(()=>import("./MobileDashboardPage-CdBiZFNJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])).then(i=>({default:i.MobileDashboardPage}))),Ut=()=>{const i=ye(),{items:c,loading:y}=D(p=>p.products),{items:k}=D(p=>p.orders),{dailyOrders:x}=D(p=>p.orderHistory),{items:f,loading:u}=D(p=>p.transactions),{items:d,loading:h}=D(p=>p.categories),{returns:v,loading:a}=D(p=>p.flipkartReturns),r=D(mt);z.useEffect(()=>{r&&(i(ut({})),i(gt()),i(pt()),i(jt()),i(ft()),i(yt()))},[i,r]);const l=k.length,g=c.length,b=k.reduce((p,_)=>{var F;const G=((F=_.product)==null?void 0:F.sellingPrice)||0,O=parseInt(_.quantity)||0;return p+G*O},0),T=l>0?b/l:0,C=y||u||h;if(C)return e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(P,{})});const L=x.map(p=>({date:p.date,orders:p.orders.length}));return e.jsxs(n,{sx:{p:3},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(s,{variant:"h4",component:"h1",sx:{fontWeight:"bold",color:"primary.dark"},children:"Dashboard"}),e.jsx(n,{sx:{flexGrow:1}}),e.jsx(s,{variant:"subtitle1",color:"text.secondary",children:new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs(m,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(j,{sx:{p:2,borderRadius:2,borderLeft:"4px solid",borderColor:"primary.main",height:"100%"},children:[e.jsx(n,{sx:{display:"flex",alignItems:"center",mb:1},children:e.jsx(s,{variant:"subtitle1",color:"text.secondary",fontWeight:"medium",children:"Total Orders"})}),e.jsx(s,{variant:"h4",sx:{fontWeight:"bold",color:"primary.dark"},children:l}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Across all platforms"})]})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(j,{sx:{p:2,borderRadius:2,borderLeft:"4px solid",borderColor:"success.main",height:"100%"},children:[e.jsx(n,{sx:{display:"flex",alignItems:"center",mb:1},children:e.jsx(s,{variant:"subtitle1",color:"text.secondary",fontWeight:"medium",children:"Total Revenue"})}),e.jsxs(s,{variant:"h4",sx:{fontWeight:"bold",color:"success.dark"},children:["₹",b.toLocaleString()]}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Gross revenue from all sales"})]})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(j,{sx:{p:2,borderRadius:2,borderLeft:"4px solid",borderColor:"info.main",height:"100%"},children:[e.jsx(n,{sx:{display:"flex",alignItems:"center",mb:1},children:e.jsx(s,{variant:"subtitle1",color:"text.secondary",fontWeight:"medium",children:"Total Products"})}),e.jsx(s,{variant:"h4",sx:{fontWeight:"bold",color:"info.dark"},children:g}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Products in catalog"})]})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(j,{sx:{p:2,borderRadius:2,borderLeft:"4px solid",borderColor:"secondary.main",height:"100%"},children:[e.jsx(n,{sx:{display:"flex",alignItems:"center",mb:1},children:e.jsx(s,{variant:"subtitle1",color:"text.secondary",fontWeight:"medium",children:"Average Order Value"})}),e.jsxs(s,{variant:"h4",sx:{fontWeight:"bold",color:"secondary.dark"},children:["₹",T.toLocaleString(void 0,{maximumFractionDigits:0})]}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Average revenue per order"})]})})]}),e.jsxs(m,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(m,{item:!0,xs:12,md:8,children:e.jsxs(j,{sx:{p:2},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Orders Overview"}),e.jsx(ve,{width:"100%",height:300,children:e.jsxs(Tt,{data:L,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(wt,{strokeDasharray:"3 3"}),e.jsx(At,{dataKey:"date",tickFormatter:p=>new Date(p).toLocaleDateString("en-US",{month:"short",day:"numeric"}),interval:2}),e.jsx(Ct,{}),e.jsx(be,{labelFormatter:p=>new Date(p).toLocaleDateString(),formatter:p=>[`${p} orders`,"Orders"]}),e.jsx(ke,{}),e.jsx(Dt,{type:"monotone",dataKey:"orders",name:"Orders",stroke:"#8884d8",activeDot:{r:8}})]})})]})}),e.jsx(m,{item:!0,xs:12,md:4,children:e.jsx(Rt,{transactions:f,products:c,loading:C})})]}),e.jsxs(m,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(Lt,{maxItems:5})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(Et,{maxAlertsInWidget:5})})]}),e.jsxs(m,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(Mt,{transactions:f,products:c,categories:d,loading:C,maxCategories:5})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(_t,{transactions:f,loading:C})})]}),e.jsx(m,{container:!0,spacing:3,children:e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(Bt,{returns:v,loading:a})})})]})},Nt=()=>ht()?e.jsx(z.Suspense,{fallback:e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(P,{})}),children:e.jsx(Ot,{})}):e.jsx(Ut,{}),Jt=Object.freeze(Object.defineProperty({__proto__:null,DashboardPage:Nt},Symbol.toStringTag,{value:"Module"}));export{Et as I,Rt as P,Lt as R,Mt as T,Jt as d};
