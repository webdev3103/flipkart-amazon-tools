import{u as Q,cl as Y,br as ee,j as e,B as r,h as n,ai as v,at as E,au as H,av as R,aw as b,D as g,I as T,aV as U,b as te,C as M,A as se,k as re,S as ae}from"./mui-vendor-DlldRxor.js";import{i as ne,a as h}from"./react-vendor-C0s_J9t-.js";import{M as oe}from"./MobileAppShell-dHUJWRrR.js";import{M as le}from"./MobileCard-BmxjauOU.js";import{I as O}from"./InventoryStatusChip-Dd2kFZgD.js";import{M as ie,u as ce}from"./useInfiniteScroll-C2oDQ5Wg.js";import{j as w,i as xe,A as K,X as de}from"./index-D4QRAU_W.js";import{M as he}from"./MobileModal-BBoQbQka.js";import{M as fe}from"./MobileBarcodeScanner-C2yMGKQf.js";import{u as pe}from"./usePullToRefresh-C2FNOxJ5.js";import"./redux-vendor-tKFe_QvA.js";import"./firebase-vendor-40dJGoDN.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-DisdNAgy.js";const ue=({product:l,stockLevel:u,inventoryStatus:t,onTap:i})=>{const f=Q(),x={amazon:{label:"Amazon",color:"#FF9900",icon:ee},flipkart:{label:"Flipkart",color:"#2874F0",icon:Y}}[l.platform],p=x.icon,j=t==="low_stock",o=t==="zero_stock";return e.jsx(le,{onClick:()=>i==null?void 0:i(l),sx:{minHeight:88,cursor:"pointer",...o&&{borderLeft:`4px solid ${f.palette.error.main}`},...j&&{borderLeft:`4px solid ${f.palette.warning.main}`}},children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1,p:2},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:1},children:[e.jsx(n,{variant:"h6",sx:{fontWeight:600,fontSize:"16px",flex:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:l.name}),t&&e.jsx(O,{status:t})]}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{fontSize:"14px"},children:[e.jsx("strong",{children:"SKU:"})," ",l.sku]}),typeof u=="number"&&e.jsxs(n,{variant:"body2",color:o?"error":j?"warning.main":"text.secondary",sx:{fontSize:"14px",fontWeight:o||j?600:400},children:[e.jsx("strong",{children:"Stock:"})," ",u," units"]})]}),e.jsxs(r,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap",mt:.5},children:[e.jsx(v,{icon:e.jsx(p,{sx:{fontSize:"16px"}}),label:x.label,size:"small",sx:{backgroundColor:x.color,color:"#ffffff",fontWeight:600,fontSize:"12px",height:28,"& .MuiChip-icon":{color:"#ffffff"}}}),l.category&&e.jsx(v,{label:l.category.name,size:"small",variant:"outlined",color:"primary",sx:{fontSize:"12px",height:28}})]})]})})},me=({searchValue:l,onSearchChange:u,platformFilter:t,onPlatformFilterChange:i,categoryFilter:f,onCategoryFilterChange:c,sortBy:x,onSortChange:p})=>{const j=w(o=>{var C;return((C=o.categories)==null?void 0:C.items)||[]});return e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:2,p:2,backgroundColor:"background.paper"},children:[e.jsx(ie,{value:l,onChange:u,placeholder:"Search products...",autoFocus:!1}),e.jsx(r,{children:e.jsxs(r,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:2},children:[e.jsx(v,{label:"All",onClick:()=>i("all"),color:t==="all"?"primary":"default",variant:t==="all"?"filled":"outlined",sx:{minHeight:44,px:2}}),e.jsx(v,{label:"Amazon",onClick:()=>i("amazon"),color:t==="amazon"?"primary":"default",variant:t==="amazon"?"filled":"outlined",sx:{minHeight:44,px:2}}),e.jsx(v,{label:"Flipkart",onClick:()=>i("flipkart"),color:t==="flipkart"?"primary":"default",variant:t==="flipkart"?"filled":"outlined",sx:{minHeight:44,px:2}})]})}),e.jsxs(r,{sx:{display:"flex",gap:2},children:[e.jsxs(E,{fullWidth:!0,children:[e.jsx(H,{children:"Category"}),e.jsxs(R,{value:f||"",label:"Category",onChange:o=>c(o.target.value||null),sx:{minHeight:56},children:[e.jsx(b,{value:"",children:e.jsx("em",{children:"All Categories"})}),j.map(o=>e.jsx(b,{value:o.id,children:o.name},o.id))]})]}),e.jsxs(E,{fullWidth:!0,children:[e.jsx(H,{children:"Sort By"}),e.jsxs(R,{value:x,label:"Sort By",onChange:o=>p(o.target.value),sx:{minHeight:56},children:[e.jsx(b,{value:"name",children:"Name"}),e.jsx(b,{value:"sku",children:"SKU"}),e.jsx(b,{value:"stock",children:"Stock Level"})]})]})]})]})},je=({open:l,onClose:u,product:t,stockLevel:i,inventoryStatus:f,onEdit:c})=>{var x;return t?e.jsx(he,{open:l,onClose:u,title:t.name,headerAction:c?{label:"Edit",onClick:c}:void 0,children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(r,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:"SKU"}),e.jsx(n,{variant:"body1",sx:{fontWeight:600},children:t.sku})]}),e.jsx(g,{}),e.jsxs(r,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:"Platform"}),e.jsx(n,{variant:"body1",sx:{textTransform:"capitalize"},children:t.platform})]}),t.category&&e.jsxs(e.Fragment,{children:[e.jsx(g,{}),e.jsxs(r,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:"Category"}),e.jsx(n,{variant:"body1",children:t.category.name}),t.category.categoryGroup&&e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Group: ",t.category.categoryGroup.name]})]})]}),typeof i=="number"&&e.jsxs(e.Fragment,{children:[e.jsx(g,{}),e.jsxs(r,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:"Stock Level"}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(n,{variant:"h5",sx:{fontWeight:600},children:i}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"units"}),f&&e.jsx(O,{status:f})]})]})]}),e.jsx(g,{}),e.jsxs(r,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:"Selling Price"}),e.jsxs(n,{variant:"body1",children:["â‚¹",t.sellingPrice.toFixed(2)]})]}),e.jsx(g,{}),e.jsxs(r,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:"Visibility"}),e.jsx(n,{variant:"body1",sx:{textTransform:"capitalize"},children:t.visibility})]}),t.description&&e.jsxs(e.Fragment,{children:[e.jsx(g,{}),e.jsxs(r,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:"Description"}),e.jsx(n,{variant:"body1",children:t.description})]})]}),((x=t.metadata)==null?void 0:x.createdAt)&&e.jsxs(e.Fragment,{children:[e.jsx(g,{}),e.jsxs(r,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:"Created"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:new Date(typeof t.metadata.createdAt=="object"&&"toDate"in t.metadata.createdAt?t.metadata.createdAt.toDate():t.metadata.createdAt).toLocaleDateString()})]})]})]})}):null},We=()=>{const l=xe(),u=ne(),t=w(s=>{var a;return((a=s.products)==null?void 0:a.items)||[]}),i=w(s=>{var a;return((a=s.products)==null?void 0:a.loading)||!1}),f=w(s=>{var a;return((a=s.products)==null?void 0:a.error)||null}),[c,x]=h.useState(""),[p,j]=h.useState("all"),[o,C]=h.useState(null),[S,V]=h.useState("name"),[y,z]=h.useState(null),[G,P]=h.useState(!1),[k,N]=h.useState(20),[_,A]=h.useState(!1),[D,I]=h.useState(null),{state:W,containerRef:$}=pe(async()=>{await l(K({})).unwrap()},{threshold:80,enabled:!0}),m=h.useMemo(()=>{let s=[...t];if(c){const a=c.toLowerCase();s=s.filter(d=>d.name.toLowerCase().includes(a)||d.sku.toLowerCase().includes(a))}return p!=="all"&&(s=s.filter(a=>a.platform===p)),o&&(s=s.filter(a=>a.categoryId===o)),s.sort((a,d)=>S==="name"?a.name.localeCompare(d.name):S==="sku"?a.sku.localeCompare(d.sku):0),s},[t,c,p,o,S]),L=m.slice(0,k),{sentinelRef:X}=ce({onLoadMore:()=>{k<m.length&&N(s=>Math.min(s+20,m.length))},isLoading:i,hasMore:k<m.length,threshold:100});h.useEffect(()=>{l(K({}))},[l]);const Z=s=>{z(s),P(!0)},B=async s=>{var d;const a=(d=s.target.files)==null?void 0:d[0];if(a){if(!a.name.endsWith(".xlsx")&&!a.name.endsWith(".xls")&&!a.name.endsWith(".txt")){I("Please upload an Excel file (.xlsx or .xls)");return}try{I(null),await l(de({file:a,updateExisting:!0})).unwrap()}catch{I("Failed to import products. Please check the file format.")}s.target.value=""}},q=()=>{y!=null&&y.id&&u(`/products/edit/${y.id}`)},J=(s,a)=>{const d=t.find(F=>F.sku.toLowerCase()===s.toLowerCase()||F.name.toLowerCase().includes(s.toLowerCase()));d?(z(d),P(!0)):x(s)};return e.jsx(oe,{pageTitle:"Products",children:e.jsxs(r,{ref:$,sx:{display:"flex",flexDirection:"column",flex:1,overflow:"auto",backgroundColor:"background.default"},children:[e.jsxs(r,{sx:{position:"sticky",top:0,zIndex:1,backgroundColor:"background.paper"},children:[e.jsx(me,{searchValue:c,onSearchChange:x,platformFilter:p,onPlatformFilterChange:j,categoryFilter:o,onCategoryFilterChange:C,sortBy:S,onSortChange:V}),e.jsxs(r,{sx:{px:2,py:1,borderBottom:1,borderColor:"divider",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(n,{variant:"h6",sx:{fontWeight:600},children:[m.length," ",m.length===1?"Product":"Products"]}),e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsxs(T,{component:"label",sx:{minWidth:44,minHeight:44},"aria-label":"Import products",children:[e.jsx(U,{}),e.jsx("input",{type:"file",hidden:!0,accept:".xlsx,.xls,.txt",onChange:B})]}),e.jsx(T,{onClick:()=>A(!0),sx:{minWidth:44,minHeight:44},"aria-label":"Scan barcode",children:e.jsx(te,{})})]})]})]}),W.isRefreshing&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(M,{size:24})}),f&&e.jsx(se,{severity:"error",sx:{m:2},children:f}),i&&!W.isRefreshing&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(M,{})}),!i&&m.length===0&&e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,p:4,textAlign:"center",gap:2},children:[e.jsx(n,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No products found"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:c||p!=="all"||o?"Try adjusting your search or filters":"Import products from an Excel file to get started"}),!c&&p==="all"&&!o&&e.jsxs(re,{variant:"contained",component:"label",startIcon:e.jsx(U,{}),sx:{mt:2},children:["Import Products",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx,.xls,.txt",onChange:B})]})]}),!i&&L.length>0&&e.jsxs(r,{sx:{px:2,py:2,display:"flex",flexDirection:"column",gap:2},children:[L.map(s=>e.jsx(ue,{product:s,onTap:Z},s.id||s.sku)),e.jsx("div",{ref:X,style:{height:20}}),k<m.length&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(M,{size:24})})]}),e.jsx(je,{open:G,onClose:()=>P(!1),product:y,onEdit:q}),e.jsx(fe,{isActive:_,onScan:J,onClose:()=>A(!1),instructions:"Scan product barcode or SKU"}),e.jsx(ae,{open:!!D,autoHideDuration:6e3,onClose:()=>I(null),message:D})]})})};export{We as MobileProductsPage};
