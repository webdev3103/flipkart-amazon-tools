import{j as e,B as u,C as ee,k as C,bf as N,a3 as D,G as P,h as a,aK as te,a9 as i,V as R,ay as L,aD as K,c as se}from"./mui-vendor-DlldRxor.js";import{i as ae,a as m}from"./react-vendor-C0s_J9t-.js";import{au as re,at as ne,i as oe,j as ie,aZ as W,H as B}from"./index-D4QRAU_W.js";import{a as le,D as ce}from"./DateRangeFilter-COuz8j7O.js";import{s as w,i as de,L as xe,A as he}from"./AdapterDateFns-Cwp-64Ap.js";import{R as A,a as O,X as $,Y as E,T as F,L as z,C as S,B as ue}from"./generateCategoricalChart-B6_j-LNJ.js";import{L as me,b as Y,P as G,a as H}from"./PieChart-oV72AkmV.js";import{B as je}from"./BarChart-wdLFzAYP.js";import{e as U}from"./endOfMonth-CxaODxht.js";import"./redux-vendor-tKFe_QvA.js";import"./firebase-vendor-40dJGoDN.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-DisdNAgy.js";function ge(j,l){const[c,g]=re(j,l.start,l.end);return{start:c,end:g}}function fe(j,l){const{start:c,end:g}=ge(l==null?void 0:l.in,j);let y=+c>+g;const b=y?+c:+g,r=y?g:c;r.setHours(0,0,0,0),r.setDate(1);let M=1;const p=[];for(;+r<=b;)p.push(ne(c,r)),r.setMonth(r.getMonth()+M);return y?p.reverse():p}const X=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8","#82CA9D","#FFC658","#8DD1E1","#D0ED57","#A4DE6C","#FCCB00"],Be=()=>{const j=ae(),l=oe(),{returns:c,loading:g}=ie(t=>t.flipkartReturns),[y,b]=m.useState(null),[r,M]=m.useState({startDate:w(new Date),endDate:U(new Date)});m.useEffect(()=>{l(W({startDate:w(new Date),endDate:U(new Date)}))},[l]);const p=(t,s)=>{M({startDate:t,endDate:s})},V=t=>{b(t.currentTarget)},Z=()=>{b(null),l(W({startDate:r.startDate,endDate:r.endDate}))},o=m.useMemo(()=>c.filter(t=>{const s=t.dates.returnDeliveredDate||t.dates.returnApprovedDate||t.dates.returnInitiatedDate;return de(new Date(s),{start:r.startDate,end:r.endDate})}),[c,r]),d=m.useMemo(()=>{const t=o.length,s=o.reduce((h,f)=>h+f.financials.netLoss,0),n=o.reduce((h,f)=>h+f.financials.refundAmount,0),x=o.filter(h=>h.resaleable).length,I=t>0?s/t:0;return{totalReturns:t,totalNetLoss:s,totalRefunded:n,resaleableCount:x,resaleablePercentage:t>0?x/t*100:0,averageLoss:I}},[o]),T=m.useMemo(()=>{const t=o.reduce((s,n)=>{const x=n.returnReasonCategory;return s[x]=(s[x]||0)+1,s},{});return Object.entries(t).map(([s,n])=>({name:s,value:n})).sort((s,n)=>n.value-s.value)},[o]),q=m.useMemo(()=>{const t=o.reduce((s,n)=>{const x=n.returnReasonCategory;return s[x]=(s[x]||0)+n.financials.netLoss,s},{});return Object.entries(t).map(([s,n])=>({category:s.length>15?s.substring(0,15)+"...":s,fullCategory:s,loss:n})).sort((s,n)=>n.loss-s.loss).slice(0,10)},[o]),J=m.useMemo(()=>{if(o.length===0)return[];const t=new Date,s=le(t,5);return fe({start:s,end:t}).map(I=>{const h=w(I),f=o.filter(k=>{const v=new Date(k.dates.returnInitiatedDate);return v.getFullYear()===h.getFullYear()&&v.getMonth()===h.getMonth()}),_=f.reduce((k,v)=>k+v.financials.netLoss,0);return{month:B(h,"MMM yyyy"),returns:f.length,loss:_}})},[o]),Q=[{name:"Resaleable",value:d.resaleableCount},{name:"Non-Resaleable",value:d.totalReturns-d.resaleableCount}];return g?e.jsx(u,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh"},children:e.jsx(ee,{})}):c.length===0?e.jsxs(u,{sx:{p:3},children:[e.jsx(C,{startIcon:e.jsx(N,{}),onClick:()=>j("/flipkart-returns"),sx:{mb:2},children:"Back to Returns"}),e.jsxs(D,{sx:{p:6,textAlign:"center"},children:[e.jsx(P,{sx:{fontSize:80,color:"text.secondary",mb:2}}),e.jsx(a,{variant:"h5",gutterBottom:!0,children:"No Returns Data Available"}),e.jsx(a,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Upload Flipkart returns to view analytics and insights"}),e.jsx(C,{variant:"contained",onClick:()=>j("/flipkart-returns/upload"),children:"Upload Returns"})]})]}):e.jsx(xe,{dateAdapter:he,children:e.jsxs(u,{sx:{p:3},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(C,{startIcon:e.jsx(N,{}),onClick:()=>j("/flipkart-returns"),sx:{mr:2},children:"Back"}),e.jsx(a,{variant:"h4",sx:{fontWeight:"bold"},children:"Returns Analytics"})]}),e.jsxs(C,{variant:"outlined",startIcon:e.jsx(te,{}),onClick:V,sx:{textTransform:"none"},children:[B(r.startDate,"dd MMM yyyy")," - ",B(r.endDate,"dd MMM yyyy")]})]}),e.jsxs(i,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{children:e.jsxs(L,{children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(P,{sx:{mr:1,color:"primary.main"}}),e.jsx(a,{variant:"subtitle2",color:"text.secondary",children:"Total Returns"})]}),e.jsx(a,{variant:"h4",sx:{fontWeight:"bold"},children:d.totalReturns})]})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{children:e.jsxs(L,{children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(K,{sx:{mr:1,color:"error.main"}}),e.jsx(a,{variant:"subtitle2",color:"text.secondary",children:"Total Net Loss"})]}),e.jsxs(a,{variant:"h4",sx:{fontWeight:"bold",color:"error.main"},children:["₹",d.totalNetLoss.toLocaleString(void 0,{maximumFractionDigits:0})]})]})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{children:e.jsxs(L,{children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(se,{sx:{mr:1,color:"success.main"}}),e.jsx(a,{variant:"subtitle2",color:"text.secondary",children:"Resaleable"})]}),e.jsxs(a,{variant:"h4",sx:{fontWeight:"bold",color:"success.main"},children:[d.resaleablePercentage.toFixed(0),"%"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[d.resaleableCount," of ",d.totalReturns]})]})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{children:e.jsxs(L,{children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(K,{sx:{mr:1,color:"warning.main"}}),e.jsx(a,{variant:"subtitle2",color:"text.secondary",children:"Avg Loss/Return"})]}),e.jsxs(a,{variant:"h4",sx:{fontWeight:"bold",color:"warning.main"},children:["₹",d.averageLoss.toLocaleString(void 0,{maximumFractionDigits:0})]})]})})})]}),e.jsxs(i,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(i,{item:!0,xs:12,md:8,children:e.jsxs(D,{sx:{p:2},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Returns Trend (Last 6 Months)"}),e.jsx(A,{width:"100%",height:300,children:e.jsxs(me,{data:J,children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"month"}),e.jsx(E,{yAxisId:"left"}),e.jsx(E,{yAxisId:"right",orientation:"right"}),e.jsx(F,{}),e.jsx(z,{}),e.jsx(Y,{yAxisId:"left",type:"monotone",dataKey:"returns",stroke:"#8884d8",name:"Returns Count",strokeWidth:2}),e.jsx(Y,{yAxisId:"right",type:"monotone",dataKey:"loss",stroke:"#ff7300",name:"Net Loss (₹)",strokeWidth:2})]})})]})}),e.jsx(i,{item:!0,xs:12,md:4,children:e.jsxs(D,{sx:{p:2},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Returns by Category"}),e.jsx(A,{width:"100%",height:300,children:e.jsxs(G,{children:[e.jsx(H,{data:T,cx:"50%",cy:"50%",labelLine:!1,label:t=>`${t.name}: ${t.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:T.map((t,s)=>e.jsx(S,{fill:X[s%X.length]},`cell-${s}`))}),e.jsx(F,{})]})})]})})]}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,md:8,children:e.jsxs(D,{sx:{p:2},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Loss by Category (Top 10)"}),e.jsx(A,{width:"100%",height:300,children:e.jsxs(je,{data:q,children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"category",angle:-45,textAnchor:"end",height:100}),e.jsx(E,{}),e.jsx(F,{formatter:t=>[`₹${t.toLocaleString(void 0,{maximumFractionDigits:0})}`,"Net Loss"]}),e.jsx(ue,{dataKey:"loss",fill:"#ff7300",name:"Net Loss"})]})})]})}),e.jsx(i,{item:!0,xs:12,md:4,children:e.jsxs(D,{sx:{p:2},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Resaleable Status"}),e.jsx(A,{width:"100%",height:300,children:e.jsxs(G,{children:[e.jsxs(H,{data:Q,cx:"50%",cy:"50%",labelLine:!1,label:t=>`${t.name}: ${t.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:[e.jsx(S,{fill:"#00C49F"}),e.jsx(S,{fill:"#FF8042"})]}),e.jsx(F,{}),e.jsx(z,{})]})})]})})]}),e.jsx(ce,{dateRange:r,onDateRangeChange:p,anchorEl:y,onClose:Z})]})})};export{Be as default};
