const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MobileTodaysOrdersPage-C5wllafr.js","assets/mui-vendor-DlldRxor.js","assets/react-vendor-C0s_J9t-.js","assets/MobileAppShell-dHUJWRrR.js","assets/index-D4QRAU_W.js","assets/redux-vendor-tKFe_QvA.js","assets/firebase-vendor-40dJGoDN.js","assets/utils-vendor-CFocuF-S.js","assets/pdf-vendor-DisdNAgy.js","assets/MobileDatePicker-CdEtDmOk.js","assets/AdapterDateFns-Cwp-64Ap.js","assets/endOfMonth-CxaODxht.js","assets/MobileFAB-bvPFLu1R.js","assets/MobileCard-BmxjauOU.js","assets/usePullToRefresh-C2FNOxJ5.js"])))=>i.map(i=>d[i]);
var at=Object.defineProperty;var nt=(n,t,s)=>t in n?at(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var Y=(n,t,s)=>nt(n,typeof t!="symbol"?t+"":t,s);import{_ as it}from"./pdf-vendor-DisdNAgy.js";import{u as re,d as de,j as e,ai as j,B as m,Y as Ge,Z as ot,as as lt,a3 as se,G as oe,h as x,a_ as ct,a$ as Be,b0 as Re,b1 as Z,b2 as C,b3 as ge,b4 as Fe,V as ue,ay as be,I as K,b5 as Ne,b6 as Pe,a9 as E,ac as H,x as Se,c as ee,az as he,P as dt,al as _e,b7 as ut,T as X,ax as ve,p as ht,r as mt,n as xt,o as pt,aB as ft,D as me,E as Oe,aN as gt,am as Qe,b as Ce,a as Ke,an as Ve,aX as jt,aY as je,b8 as yt,aq as bt,z as St,ap as vt,k as $,b9 as Ct,aZ as It,aK as wt,ar as zt,C as Ie,A as Ee,ag as Dt,ba as Tt,aE as At,bb as kt,bc as ye,at as qe,au as Ye,av as Ze,aw as ce,bd as $e,aj as Mt,v as Bt,w as Rt,be as Ft,Q as Nt,O as Pt,bf as Ot,bg as Et}from"./mui-vendor-DlldRxor.js";import{a as d,b as Je}from"./react-vendor-C0s_J9t-.js";import{$ as $t,a0 as Wt,u as Ut,i as Lt,j as We,H as J,B as Ht,a1 as Gt,a2 as _t,a3 as Qt,a4 as Kt,a5 as Ue,a6 as Vt,a7 as qt,a8 as Yt,a9 as Zt}from"./index-D4QRAU_W.js";import{D as Jt}from"./DataTable-CqcHOsap.js";import{V as Xe,a as et}from"./ActionButtons-BOIGwPW5.js";import{F as Le}from"./FormattedCurrency-CWfs6hb7.js";import{u as Xt}from"./useEnhancedCamera-C15S_UMc.js";import{p as He}from"./pdfStorageService-DGuhzLre.js";import{L as es,A as ts,D as ss}from"./AdapterDateFns-Cwp-64Ap.js";import"./redux-vendor-tKFe_QvA.js";import"./firebase-vendor-40dJGoDN.js";import"./utils-vendor-CFocuF-S.js";import"./endOfMonth-CxaODxht.js";class rs{constructor(){Y(this,"currentSession",null)}startSession(){const t=new Date().toISOString(),s=`scan_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return this.currentSession={sessionId:s,isActive:!0,startedAt:t,lastActivity:t,scanHistory:[],statistics:this.createInitialStatistics(t),throttledBarcodes:new Map},this.currentSession}getCurrentSession(){return this.currentSession}isSessionActive(){var t;return((t=this.currentSession)==null?void 0:t.isActive)??!1}addScanToSession(t,s,r=!1){if(!this.currentSession||!this.currentSession.isActive)return;const o=new Date().toISOString(),u={barcodeId:t,scannedAt:o,result:s,feedbackShown:r};this.currentSession.scanHistory.push(u),this.currentSession.lastActivity=o,this.updateSessionStatistics()}addThrottledBarcode(t,s){!this.currentSession||!this.currentSession.isActive||(this.currentSession.throttledBarcodes.set(t,s),this.updateSessionStatistics())}removeThrottledBarcode(t){this.currentSession&&this.currentSession.throttledBarcodes.delete(t)}getScanHistory(){var t;return((t=this.currentSession)==null?void 0:t.scanHistory)??[]}getSessionStatistics(){var t;return((t=this.currentSession)==null?void 0:t.statistics)??null}getFilteredScanHistory(t){const s=this.getScanHistory();return t===void 0?s:s.filter(r=>r.result.success===t)}getUniqueScannedBarcodes(){const t=this.getScanHistory();return new Set(t.map(s=>s.barcodeId))}wasBarcodeScanned(t){return this.getScanHistory().some(r=>r.barcodeId===t&&r.result.success)}getLastScanForBarcode(t){const r=this.getScanHistory().filter(o=>o.barcodeId===t);return r.length>0?r[r.length-1]:void 0}endSession(){if(!this.currentSession)return null;this.currentSession.isActive=!1,this.updateSessionStatistics();const t={...this.currentSession.statistics};return this.currentSession=null,t}resetSession(){if(!this.currentSession)return;const t=new Date().toISOString();this.currentSession.scanHistory=[],this.currentSession.throttledBarcodes.clear(),this.currentSession.lastActivity=t,this.currentSession.statistics=this.createInitialStatistics(this.currentSession.startedAt)}getSessionDuration(){if(!this.currentSession)return 0;const t=new Date(this.currentSession.startedAt).getTime();return Date.now()-t}exportSessionData(){return this.currentSession?{...this.currentSession,scanHistory:[...this.currentSession.scanHistory],statistics:{...this.currentSession.statistics},throttledBarcodes:new Map(this.currentSession.throttledBarcodes)}:null}createInitialStatistics(t){return{totalScanned:0,successfulScans:0,failedScans:0,duplicateAttempts:0,sessionStarted:t,sessionDuration:0,averageScanInterval:0}}updateSessionStatistics(){if(!this.currentSession)return;const t=this.currentSession.scanHistory,s=t.filter(u=>u.result.success),r=t.filter(u=>!u.result.success),o=this.currentSession.throttledBarcodes.size;this.currentSession.statistics={totalScanned:t.length,successfulScans:s.length,failedScans:r.length,duplicateAttempts:o,sessionStarted:this.currentSession.startedAt,sessionDuration:this.getSessionDuration(),averageScanInterval:this.calculateAverageScanInterval()}}calculateAverageScanInterval(){var o;const t=((o=this.currentSession)==null?void 0:o.scanHistory)??[];if(t.length<2)return 0;const s=[];for(let u=1;u<t.length;u++){const c=new Date(t[u-1].scannedAt).getTime(),a=new Date(t[u].scannedAt).getTime();s.push(a-c)}return s.reduce((u,c)=>u+c,0)/s.length}}const as=()=>{const n=d.useRef(new rs),[t,s]=d.useState(null),[r,o]=d.useState(!1),[u,c]=d.useState([]),[a,i]=d.useState(null),l=n.current,p=d.useCallback(()=>{const h=l.getCurrentSession();s(h),o(l.isSessionActive()),c(l.getScanHistory()),i(l.getSessionStatistics())},[l]),g=d.useCallback(()=>{const h=l.startSession();return p(),h},[l,p]),z=d.useCallback(()=>{const h=l.endSession();return p(),h},[l,p]),y=d.useCallback((h,w,D=!1)=>{l.addScanToSession(h,w,D),p()},[l,p]),A=d.useCallback((h,w)=>{l.addThrottledBarcode(h,w),p()},[l,p]),k=d.useCallback(()=>{l.resetSession(),p()},[l,p]),v=d.useCallback(h=>l.wasBarcodeScanned(h),[l]),T=d.useCallback(()=>l.getUniqueScannedBarcodes(),[l]),P=d.useCallback(()=>l.exportSessionData(),[l]);return d.useEffect(()=>{p()},[p]),{session:t,isActive:r,scanHistory:u,statistics:a,startSession:g,endSession:z,addScan:y,addThrottledBarcode:A,resetSession:k,wasBarcodeScanned:v,getUniqueScannedBarcodes:T,exportSessionData:P}};class ns{constructor(t=3e3,s=100){Y(this,"throttleCache",new Map);Y(this,"throttleDuration");Y(this,"maxCacheSize");Y(this,"cleanupTimer");this.throttleDuration=t,this.maxCacheSize=s,this.startPeriodicCleanup()}isThrottled(t){const s=Date.now(),r=this.throttleCache.get(t);return r?s-r.firstScanAt<this.throttleDuration?r.isThrottled:(this.throttleCache.delete(t),!1):!1}registerScan(t){const s=Date.now(),r=this.throttleCache.get(t);if(r)if(s-r.firstScanAt<this.throttleDuration){const a={...r,lastAttemptAt:s,attemptCount:r.attemptCount+1,isThrottled:!0};return this.throttleCache.set(t,a),a}else this.throttleCache.delete(t);const o={firstScanAt:s,lastAttemptAt:s,attemptCount:1,isThrottled:!1};return this.enforceCacheLimit(),this.throttleCache.set(t,o),o}getThrottleInfo(t){return this.throttleCache.get(t)}getThrottledBarcodes(){const t=Date.now(),s=new Map;for(const[r,o]of this.throttleCache.entries())t-o.firstScanAt<this.throttleDuration&&o.isThrottled&&s.set(r,o);return s}getTotalDuplicateAttempts(){let t=0;for(const s of this.throttleCache.values())s.attemptCount>1&&(t+=s.attemptCount-1);return t}clearBarcode(t){this.throttleCache.delete(t)}clearAll(){this.throttleCache.clear()}getCacheSize(){return this.throttleCache.size}getConfig(){return{throttleDuration:this.throttleDuration,maxCacheSize:this.maxCacheSize}}enforceCacheLimit(){if(this.cleanupExpiredEntries(),this.throttleCache.size>=this.maxCacheSize){const t=Array.from(this.throttleCache.entries());t.sort((r,o)=>r[1].lastAttemptAt-o[1].lastAttemptAt);const s=t.slice(0,t.length-this.maxCacheSize+1);for(const[r]of s)this.throttleCache.delete(r)}}cleanupExpiredEntries(){const t=Date.now(),s=[];for(const[r,o]of this.throttleCache.entries())t-o.lastAttemptAt>this.throttleDuration&&s.push(r);for(const r of s)this.throttleCache.delete(r)}startPeriodicCleanup(){this.cleanupTimer=setInterval(()=>{this.cleanupExpiredEntries()},6e4)}destroy(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=void 0),this.clearAll()}}const is=(n={})=>{const{throttleDuration:t=3e3,maxCacheSize:s=100}=n,r=d.useRef(null);r.current||(r.current=new ns(t,s));const o=r.current,u=d.useCallback(A=>o.isThrottled(A),[o]),c=d.useCallback(A=>o.registerScan(A),[o]),a=d.useCallback(A=>o.getThrottleInfo(A),[o]),i=d.useCallback(()=>o.getThrottledBarcodes(),[o]),l=d.useCallback(()=>o.getTotalDuplicateAttempts(),[o]),p=d.useCallback(A=>{o.clearBarcode(A)},[o]),g=d.useCallback(()=>{o.clearAll()},[o]),z=d.useCallback(()=>o.getCacheSize(),[o]),y=d.useCallback(()=>o.getConfig(),[o]);return d.useEffect(()=>()=>{r.current&&(r.current.destroy(),r.current=null)},[]),{isThrottled:u,registerScan:c,getThrottleInfo:a,getThrottledBarcodes:i,getTotalDuplicateAttempts:l,clearBarcode:p,clearAll:g,getCacheSize:z,getConfig:y}},os={mobileBreakpoint:768,useDrawerOnMobile:!0,useDialogOnDesktop:!0,fullScreenMobile:!0,autoHeight:!0},ls=(n={})=>{const t=re(),{responsiveConfig:s={}}=n,r=d.useMemo(()=>({...os,...s}),[s]),o=de(t.breakpoints.down("md")),u=de(`(max-width:${r.mobileBreakpoint}px)`),[c,a]=d.useState(null),i=c!==null?c:o||u,l=i?r.useDrawerOnMobile:!r.useDialogOnDesktop,p=!l,g=i&&r.fullScreenMobile,z=r.autoHeight,y=d.useCallback(k=>{a(k)},[]),A=d.useCallback(()=>{a(null)},[]);return d.useEffect(()=>{},[i,l,p,g,o,u,c,r]),{isMobile:i,useDrawer:l,useDialog:p,fullScreenMobile:g,autoHeight:z,config:r,forceMobile:y,resetResponsive:A}},cs=({summary:n,products:t,categories:s})=>{const r=a=>{var i,l,p,g,z,y;return e.jsxs(e.Fragment,{children:[((i=a.product)==null?void 0:i.platform)==="flipkart"&&((p=(l=a.product)==null?void 0:l.metadata)==null?void 0:p.flipkartSerialNumber)&&a.product.metadata.flipkartSerialNumber.trim()!==""&&e.jsx(Xe,{flipkartSerialNumber:a.product.metadata.flipkartSerialNumber}),((g=a.product)==null?void 0:g.platform)==="amazon"&&((y=(z=a.product)==null?void 0:z.metadata)==null?void 0:y.amazonSerialNumber)&&a.product.metadata.amazonSerialNumber.trim()!==""&&e.jsx(et,{amazonSerialNumber:a.product.metadata.amazonSerialNumber})]})},o=n,u=a=>{if(a.category)return a.category;if(t!=null&&t.length&&a.SKU){const i=t.find(l=>l.sku===a.SKU);if(i!=null&&i.categoryId&&(s!=null&&s.length)){const l=s.find(p=>p.id===i.categoryId);return(l==null?void 0:l.name)||"Uncategorized"}}return"Uncategorized"},c=[{id:"SKU",label:"SKU",filter:!0},{id:"name",label:"Name",filter:!0},{id:"category",label:"Category",filter:!0,format:(a,i)=>{const l=u(i);return l!=="Uncategorized"?e.jsx(j,{label:l,color:"secondary",variant:"outlined",size:"small"}):e.jsx(j,{label:"Uncategorized",color:"default",variant:"outlined",size:"small"})}},{id:"quantity",label:"Quantity",align:"right",format:a=>e.jsx("span",{children:a.toString()})},{id:"type",label:"Platform",format:a=>e.jsx(j,{label:a.toUpperCase(),color:a==="amazon"?"default":"primary"}),filter:!0},{id:"batchInfo",label:"Batch",filter:!0,format:(a,i)=>{const l=i;return l.batchInfo?e.jsx(j,{label:l.batchInfo.fileName.substring(0,20)+(l.batchInfo.fileName.length>20?"...":""),color:"info",variant:"outlined",size:"small",title:`${l.batchInfo.fileName} - ${l.batchInfo.orderCount} orders`}):e.jsx(j,{label:"Legacy",color:"default",variant:"outlined",size:"small"})}},{id:"actions",label:"Actions",align:"center",format:(a,i)=>r(i)}];return e.jsx(Jt,{id:"summary-table",columns:c,data:o,defaultSortColumn:"quantity",defaultSortDirection:"desc",rowsPerPageOptions:[10,20,40,80,100],defaultRowsPerPage:20})},xe=n=>{var r;const t=((r=n.product)==null?void 0:r.sellingPrice)||0,s=parseInt(n.quantity)||0;return t*s},ds=n=>{const t=new Map,s=[];n.forEach(c=>{var p;const a=c.category||null,i=(p=c.product)==null?void 0:p.categoryId;if(!a||a.trim()===""){s.push(c);return}t.has(a)||t.set(a,{categoryName:a,categoryId:i,orders:[],totalQuantity:0,totalRevenue:0,totalItems:0,platforms:[]});const l=t.get(a);l.orders.push(c),l.totalQuantity+=parseInt(c.quantity)||0,l.totalRevenue+=xe(c),l.totalItems+=1,c.type&&!l.platforms.includes(c.type)&&l.platforms.push(c.type)});const r={categoryName:"Uncategorized",orders:s,totalQuantity:s.reduce((c,a)=>c+(parseInt(a.quantity)||0),0),totalRevenue:s.reduce((c,a)=>c+xe(a),0),totalItems:s.length,platforms:[...new Set(s.map(c=>c.type).filter(Boolean))]},o=Array.from(t.values()).sort((c,a)=>c.categoryName.localeCompare(a.categoryName)),u=o.reduce((c,a)=>c+a.totalRevenue,0)+r.totalRevenue;return{categorizedGroups:o,uncategorizedGroup:r,summary:{totalCategories:o.length+(r.totalItems>0?1:0),totalOrders:n.length,totalRevenue:u}}},us=(n,t,s="all")=>{const r=t.toLowerCase(),o=a=>{var p,g;const i=!t.trim()||((p=a.name)==null?void 0:p.toLowerCase().includes(r))||((g=a.SKU)==null?void 0:g.toLowerCase().includes(r)),l=s==="all"||a.type===s;return i&&l},u=n.categorizedGroups.map(a=>a.categoryName.toLowerCase().includes(r)?{...a,orders:a.orders.filter(i=>s==="all"||i.type===s)}:{...a,orders:a.orders.filter(o)}).filter(a=>a.orders.length>0).map(a=>({...a,totalQuantity:a.orders.reduce((i,l)=>i+(parseInt(l.quantity)||0),0),totalRevenue:a.orders.reduce((i,l)=>i+xe(l),0),totalItems:a.orders.length,platforms:[...new Set(a.orders.map(i=>i.type).filter(Boolean))]})),c={...n.uncategorizedGroup,orders:n.uncategorizedGroup.orders.filter(o)};return c.totalQuantity=c.orders.reduce((a,i)=>a+(parseInt(i.quantity)||0),0),c.totalRevenue=c.orders.reduce((a,i)=>a+xe(i),0),c.totalItems=c.orders.length,c.platforms=[...new Set(c.orders.map(a=>a.type).filter(Boolean))],{categorizedGroups:u,uncategorizedGroup:c,summary:{totalCategories:u.length+(c.totalItems>0?1:0),totalOrders:u.reduce((a,i)=>a+i.totalItems,0)+c.totalItems,totalRevenue:u.reduce((a,i)=>a+i.totalRevenue,0)+c.totalRevenue}}},le=n=>{const t=n.orders.filter(o=>o.isCompleted===!0).length,s=n.totalItems-t,r=n.totalItems>0?t/n.totalItems*100:0;return{itemCount:n.totalItems,totalQuantity:n.totalQuantity,averageQuantity:n.totalItems>0?Math.round(n.totalQuantity/n.totalItems*100)/100:0,platforms:n.platforms,completion:{completed:t,pending:s,completionRate:Math.round(r*100)/100}}},hs=({groupedData:n})=>{const t=re(),s=de(t.breakpoints.down("md")),[r,o]=d.useState(""),[u,c]=d.useState({}),[a,i]=d.useState("totalQuantity"),[l,p]=d.useState("desc"),g=us(n,r,"all"),z=h=>{c(w=>({...w,[h]:!w[h]}))},y=h=>{p(a===h&&l==="asc"?"desc":"asc"),i(h)},A=[...g.categorizedGroups].sort((h,w)=>{const D=le(h),I=le(w);let f,R;switch(a){case"category":f=h.categoryName.toLowerCase(),R=w.categoryName.toLowerCase();break;case"itemCount":f=D.itemCount,R=I.itemCount;break;case"totalQuantity":f=D.totalQuantity,R=I.totalQuantity;break;default:f=h.categoryName.toLowerCase(),R=w.categoryName.toLowerCase()}return typeof f=="string"&&typeof R=="string"?l==="asc"?f.localeCompare(R):R.localeCompare(f):l==="asc"?f-R:R-f}),k=h=>h.isCompleted?e.jsx(j,{icon:e.jsx(ee,{}),label:"Completed",color:"success",size:"small",variant:"filled",title:`Completed at: ${h.completedAt?new Date(h.completedAt).toLocaleString():"Unknown"}`}):e.jsx(j,{icon:e.jsx(he,{}),label:"Pending",color:"warning",size:"small",variant:"outlined",title:"Order not yet completed"}),v=h=>{var w,D,I,f,R,N;return e.jsxs(m,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[((w=h.product)==null?void 0:w.platform)==="flipkart"&&((I=(D=h.product)==null?void 0:D.metadata)==null?void 0:I.flipkartSerialNumber)&&h.product.metadata.flipkartSerialNumber.trim()!==""&&e.jsx(Xe,{flipkartSerialNumber:h.product.metadata.flipkartSerialNumber}),((f=h.product)==null?void 0:f.platform)==="amazon"&&((N=(R=h.product)==null?void 0:R.metadata)==null?void 0:N.amazonSerialNumber)&&h.product.metadata.amazonSerialNumber.trim()!==""&&e.jsx(et,{amazonSerialNumber:h.product.metadata.amazonSerialNumber})]})},T=({group:h,isExpanded:w,onToggle:D})=>{const I=le(h);return e.jsx(ue,{sx:{mb:2,overflow:"visible"},children:e.jsxs(be,{sx:{p:2},children:[e.jsxs(m,{onClick:D,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",mb:2},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[e.jsx(oe,{sx:{fontSize:20,color:"primary.main"}}),e.jsx(x,{variant:"subtitle1",sx:{fontWeight:"bold",fontSize:"1rem"},children:h.categoryName})]}),e.jsx(K,{size:"small",children:w?e.jsx(Ne,{}):e.jsx(Pe,{})})]}),e.jsxs(E,{container:!0,spacing:1,sx:{mb:2},children:[e.jsx(E,{item:!0,xs:6,children:e.jsxs(H,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Items:"}),e.jsx(j,{label:I.itemCount,size:"small",variant:"outlined"})]})}),e.jsx(E,{item:!0,xs:6,children:e.jsxs(H,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Qty:"}),e.jsx(j,{label:I.totalQuantity,size:"small",variant:"outlined"})]})}),e.jsx(E,{item:!0,xs:6,children:e.jsxs(H,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Completed:"}),e.jsx(j,{label:I.completion.completed,size:"small",color:"success",variant:"outlined"})]})}),e.jsx(E,{item:!0,xs:6,children:e.jsxs(H,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Pending:"}),e.jsx(j,{label:I.completion.pending,size:"small",color:"warning",variant:"outlined"})]})})]}),I.platforms&&Array.isArray(I.platforms)&&e.jsxs(m,{sx:{mb:2},children:[e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mr:1},children:"Platforms:"}),e.jsx(j,{label:I.platforms.join(", "),size:"small",variant:"outlined"})]}),e.jsx(Se,{in:w,timeout:"auto",unmountOnExit:!0,children:e.jsxs(m,{sx:{mt:2},children:[e.jsx(x,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold"},children:"Orders:"}),e.jsx(H,{spacing:1,children:h.orders.map((f,R)=>{var N,S,O;return e.jsx(ue,{variant:"outlined",sx:{p:1.5},children:e.jsxs(E,{container:!0,spacing:1,children:[e.jsx(E,{item:!0,xs:12,children:e.jsx(x,{variant:"body2",sx:{fontWeight:500,mb:.5},children:((N=f.product)==null?void 0:N.name)||f.name||"Unknown Product"})}),e.jsxs(E,{item:!0,xs:6,children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"SKU:"}),e.jsx(x,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.75rem"},children:f.SKU||"N/A"})]}),e.jsxs(E,{item:!0,xs:6,children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Quantity:"}),e.jsx(j,{label:f.quantity,size:"small",color:"primary",variant:"outlined",sx:{height:20,fontSize:"0.75rem"}})]}),e.jsxs(E,{item:!0,xs:6,children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Platform:"}),e.jsx(j,{label:((S=f.type)==null?void 0:S.toUpperCase())||"Unknown",size:"small",variant:"outlined",sx:{height:20,fontSize:"0.75rem"}})]}),e.jsxs(E,{item:!0,xs:6,children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Price:"}),e.jsx(x,{variant:"body2",sx:{fontWeight:500},children:e.jsx(Le,{value:((O=f.product)==null?void 0:O.sellingPrice)||0})})]}),e.jsx(E,{item:!0,xs:12,children:e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[k(f),v(f)]})}),f.batchInfo&&e.jsxs(E,{item:!0,xs:12,children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Batch:"}),e.jsx(j,{label:f.batchInfo.fileName.substring(0,20)+(f.batchInfo.fileName.length>20?"...":""),color:"info",variant:"outlined",size:"small",title:`${f.batchInfo.fileName} - ${f.batchInfo.orderCount} orders`,sx:{ml:.5,height:20,fontSize:"0.7rem"}})]})]})},`${f.SKU}-${R}`)})})]})})]})})},P=({group:h,isExpanded:w,onToggle:D})=>{const I=le(h);return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{onClick:D,role:"button",sx:{cursor:"pointer"},children:[e.jsx(C,{children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(K,{size:"small",children:w?e.jsx(Ne,{}):e.jsx(Pe,{})}),e.jsx(oe,{sx:{fontSize:20}}),e.jsxs(x,{variant:"subtitle1",sx:{fontWeight:"bold"},children:[h.categoryName,h.categoryName==="Uncategorized"&&e.jsx("span",{style:{display:"none"},children:" Products"})]}),h.categoryName==="Uncategorized"&&e.jsx(x,{variant:"subtitle1",sx:{fontWeight:"bold",position:"absolute",left:"-9999px"},children:"Uncategorized Products"})]})}),e.jsx(C,{align:"center",children:e.jsx(j,{label:`${I.itemCount} Items`,size:"small",variant:"outlined"})}),e.jsx(C,{align:"center",children:e.jsx(j,{label:`Qty: ${I.totalQuantity}`,size:"small",variant:"outlined"})}),e.jsx(C,{align:"center",children:I.platforms&&Array.isArray(I.platforms)&&e.jsx(j,{label:I.platforms.join(", "),size:"small",variant:"outlined"})}),e.jsx(C,{align:"center",children:e.jsxs(m,{sx:{display:"flex",gap:.5,alignItems:"center",justifyContent:"center"},children:[e.jsx(j,{icon:e.jsx(ee,{}),label:`${I.completion.completed}`,size:"small",color:"success",variant:"outlined",title:`${I.completion.completed} completed orders`}),e.jsx(j,{icon:e.jsx(he,{}),label:`${I.completion.pending}`,size:"small",color:"warning",variant:"outlined",title:`${I.completion.pending} pending orders`})]})}),e.jsx(C,{align:"center",children:e.jsx(x,{variant:"body2",color:"text.secondary",children:"Category Summary"})})]}),e.jsx(Z,{children:e.jsx(C,{style:{paddingBottom:0,paddingTop:0},colSpan:6,children:e.jsx(Se,{in:w,timeout:"auto",unmountOnExit:!0,children:e.jsx(m,{sx:{margin:1},children:e.jsxs(Be,{size:"small",children:[e.jsx(Re,{children:e.jsxs(Z,{children:[e.jsx(C,{children:e.jsx("strong",{children:"SKU"})}),e.jsx(C,{children:e.jsx("strong",{children:"Product Name"})}),e.jsx(C,{align:"center",children:e.jsx("strong",{children:"Quantity"})}),e.jsx(C,{align:"center",children:e.jsx("strong",{children:"Platform"})}),e.jsx(C,{align:"center",children:e.jsx("strong",{children:"Batch"})}),e.jsx(C,{align:"center",children:e.jsx("strong",{children:"Status"})}),e.jsx(C,{align:"right",children:e.jsx("strong",{children:"Unit Price"})}),e.jsx(C,{align:"center",children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(Fe,{children:h.orders.map((f,R)=>{var N,S,O;return e.jsxs(Z,{children:[e.jsx(C,{sx:{fontFamily:"monospace",fontSize:"0.875rem"},children:f.SKU||"N/A"}),e.jsx(C,{children:e.jsx(x,{variant:"body2",sx:{fontWeight:500},children:((N=f.product)==null?void 0:N.name)||f.name||"Unknown Product"})}),e.jsx(C,{align:"center",children:e.jsx(j,{label:f.quantity,size:"small",color:"primary",variant:"outlined"})}),e.jsx(C,{align:"center",children:e.jsx(j,{label:((S=f.type)==null?void 0:S.toUpperCase())||"Unknown",size:"small",variant:"outlined"})}),e.jsx(C,{align:"center",children:f.batchInfo?e.jsx(j,{label:f.batchInfo.fileName.substring(0,15)+(f.batchInfo.fileName.length>15?"...":""),color:"info",variant:"outlined",size:"small",title:`${f.batchInfo.fileName} - ${f.batchInfo.orderCount} orders`}):e.jsx(j,{label:"Legacy",color:"default",variant:"outlined",size:"small",title:"Order without batch information"})}),e.jsx(C,{align:"center",children:k(f)}),e.jsx(C,{align:"right","data-testid":"unit-price",children:e.jsx(Le,{value:((O=f.product)==null?void 0:O.sellingPrice)||0})}),e.jsx(C,{align:"center",children:v(f)})]},`${f.SKU}-${R}`)})})]})})})})})]})};return e.jsxs(m,{children:[e.jsx(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:e.jsx(Ge,{variant:"outlined",placeholder:s?"Search products...":"Search by product name, SKU, or category...",value:r,onChange:h=>o(h.target.value),sx:{flexGrow:1},size:s?"small":"medium",InputProps:{startAdornment:e.jsx(ot,{position:"start",children:e.jsx(lt,{fontSize:s?"small":"medium"})})}})}),s?e.jsx(m,{children:g.categorizedGroups.length===0&&g.uncategorizedGroup.totalItems===0?e.jsxs(se,{sx:{p:4,textAlign:"center"},children:[e.jsx(oe,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No orders found"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:r?"Try adjusting your search terms":"No active orders available"})]}):e.jsxs(m,{children:[A.map(h=>e.jsx(T,{group:h,isExpanded:u[h.categoryName]??!1,onToggle:()=>z(h.categoryName)},h.categoryName)),g.uncategorizedGroup.totalItems>0&&e.jsx(T,{group:g.uncategorizedGroup,isExpanded:u.uncategorized??!1,onToggle:()=>z("uncategorized")},"uncategorized")]})}):e.jsx(ct,{component:se,sx:{boxShadow:2},children:e.jsxs(Be,{children:[e.jsx(Re,{children:e.jsxs(Z,{children:[e.jsx(C,{children:e.jsx(ge,{active:a==="category",direction:a==="category"?l:"asc",onClick:()=>y("category"),children:e.jsx("strong",{children:"Category / Product"})})}),e.jsx(C,{align:"center",children:e.jsx(ge,{active:a==="itemCount",direction:a==="itemCount"?l:"asc",onClick:()=>y("itemCount"),children:e.jsx("strong",{children:"Items"})})}),e.jsx(C,{align:"center",children:e.jsx(ge,{active:a==="totalQuantity",direction:a==="totalQuantity"?l:"asc",onClick:()=>y("totalQuantity"),children:e.jsx("strong",{children:"Quantity"})})}),e.jsx(C,{align:"center",children:e.jsx("strong",{children:"Platform"})}),e.jsx(C,{align:"center",children:e.jsx("strong",{children:"Status"})}),e.jsx(C,{align:"center",children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(Fe,{children:g.categorizedGroups.length===0&&g.uncategorizedGroup.totalItems===0?e.jsx(Z,{children:e.jsxs(C,{colSpan:6,sx:{textAlign:"center",py:4},children:[e.jsx(oe,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No orders found"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:r?"Try adjusting your search terms":"No active orders available"})]})}):e.jsxs(e.Fragment,{children:[A.map(h=>e.jsx(P,{group:h,isExpanded:u[h.categoryName]??!1,onToggle:()=>z(h.categoryName)},h.categoryName)),g.uncategorizedGroup.totalItems>0&&e.jsx(P,{group:g.uncategorizedGroup,isExpanded:u.uncategorized??!1,onToggle:()=>z("uncategorized")},"uncategorized")]})})]})})]})},ms=Je.forwardRef(function(t,s){return e.jsx(ut,{direction:"up",ref:s,...t})}),xs=({open:n,onClose:t,children:s,useDrawerOnMobile:r=!0,useDialogOnDesktop:o=!0,fullScreenMobile:u=!0,mobileBreakpoint:c="md",dialogProps:a={},drawerProps:i={},sx:l={}})=>{const p=re(),g=de(p.breakpoints.down(c));return(g?r:!o)?e.jsxs(dt,{anchor:"bottom",open:n,onClose:t,ModalProps:{keepMounted:!0},PaperProps:{sx:{borderTopLeftRadius:g?16:0,borderTopRightRadius:g?16:0,maxHeight:g&&u?"90vh":"80vh",minHeight:g?"50vh":"auto",...l}},SlideProps:{direction:"up"},...i,children:[g&&e.jsx(se,{sx:{width:40,height:4,borderRadius:2,backgroundColor:"grey.400",mx:"auto",mt:1,mb:2,cursor:"pointer"},onClick:t,"aria-label":"Close scanner",role:"button",tabIndex:0,onKeyDown:y=>{(y.key==="Enter"||y.key===" ")&&t()}}),s]}):e.jsx(_e,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,fullScreen:g&&u,TransitionComponent:g?ms:void 0,PaperProps:{sx:{borderRadius:g?0:2,maxHeight:"90vh",...l}},...a,children:s})},ps=n=>new Date(n).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),fs=n=>{const t=Math.floor(n/1e3),s=Math.floor(t/60);return s>0?`${s}m ${t%60}s`:`${t}s`},gs=n=>{if(n.result.success)return e.jsx(ee,{color:"success",fontSize:"small"});switch(n.result.errorType){case"ALREADY_COMPLETED":return e.jsx(gt,{color:"warning",fontSize:"small"});case"NOT_FOUND":case"INVALID_BARCODE":return e.jsx(Oe,{color:"error",fontSize:"small"});default:return e.jsx(Oe,{color:"error",fontSize:"small"})}},js=({scanHistory:n,statistics:t,detailed:s=!1,maxItems:r=10,onClearHistory:o,onItemClick:u})=>{const c=[...n].reverse(),a=r>0?c.slice(0,r):c;return n.length===0?e.jsx(m,{sx:{p:2,textAlign:"center"},children:e.jsx(x,{variant:"body2",color:"text.secondary",children:"No scans yet in this session"})}):e.jsxs(m,{children:[t&&e.jsx(m,{sx:{p:2,backgroundColor:"grey.50",borderRadius:1,mb:2},children:e.jsxs(H,{direction:"row",spacing:1,flexWrap:"wrap",alignItems:"center",children:[e.jsx(x,{variant:"subtitle2",color:"primary",children:"Session Stats:"}),e.jsx(j,{size:"small",label:`${t.totalScanned} scanned`,color:"primary",variant:"outlined"}),e.jsx(j,{size:"small",label:`${t.successfulScans} success`,color:"success",variant:"outlined"}),t.failedScans>0&&e.jsx(j,{size:"small",label:`${t.failedScans} failed`,color:"error",variant:"outlined"}),t.duplicateAttempts>0&&e.jsx(j,{size:"small",label:`${t.duplicateAttempts} throttled`,color:"warning",variant:"outlined"}),e.jsx(j,{size:"small",label:fs(t.sessionDuration),variant:"outlined"}),o&&e.jsx(X,{title:"Clear history",children:e.jsx(K,{size:"small",onClick:o,sx:{ml:"auto"},children:e.jsx(ve,{fontSize:"small"})})})]})}),e.jsx(ht,{dense:!0,sx:{maxHeight:"300px",overflow:"auto"},children:a.map((i,l)=>e.jsxs(Je.Fragment,{children:[e.jsxs(mt,{secondaryAction:u&&e.jsx(X,{title:"View details",children:e.jsx(K,{edge:"end",size:"small",onClick:()=>u(i),children:e.jsx(ft,{fontSize:"small"})})}),sx:{cursor:u?"pointer":"default","&:hover":u?{backgroundColor:"action.hover"}:{}},onClick:u?()=>u(i):void 0,children:[e.jsx(xt,{children:gs(i)}),e.jsx(pt,{primary:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{variant:"body2",fontFamily:"monospace",children:i.barcodeId}),i.result.success&&e.jsx(j,{size:"small",label:"âœ“",color:"success",sx:{minWidth:"auto",height:16,fontSize:"0.7rem"}})]}),secondary:e.jsxs(m,{children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:ps(i.scannedAt)}),s&&i.result.orderData&&e.jsxs(x,{variant:"caption",display:"block",color:"text.secondary",children:[i.result.orderData.productName.substring(0,30),i.result.orderData.productName.length>30?"...":""]}),!i.result.success&&i.result.error&&e.jsx(x,{variant:"caption",display:"block",color:"error",children:i.result.error})]})})]}),l<a.length-1&&e.jsx(me,{})]},`${i.barcodeId}-${i.scannedAt}`))}),r>0&&n.length>r&&e.jsx(m,{sx:{p:1,textAlign:"center"},children:e.jsxs(x,{variant:"caption",color:"text.secondary",children:["+",n.length-r," more items"]})})]})},ys={},bs=({open:n,onClose:t,onScanSuccess:s,onScanError:r,options:o={}})=>{var Ae,ke;const{throttleDuration:u=3e3,maxThrottleCache:c=100,feedbackDuration:a=2e3,persistSession:i=!0,responsiveConfig:l=ys,cameraTimeout:p=3e4,enableManualEntry:g=!0,validateBarcode:z}=o,[y,A]=d.useState("camera"),[k,v]=d.useState(""),[T,P]=d.useState("scanner"),h=d.useRef(null),w=d.useRef(new $t),D=d.useMemo(()=>l,[l]),I=d.useMemo(()=>({throttleDuration:u,maxCacheSize:c}),[u,c]),f=d.useMemo(()=>({defaultDuration:a}),[a]),R=d.useMemo(()=>({targetRef:h,timeout:p,useEnvironmentCamera:!0}),[p]),N=ls({responsiveConfig:D}),S=as(),O=is(I),W=Wt(f),M=Xt(R),ae=d.useRef(O),G=d.useRef(W),b=d.useRef(S),L=d.useRef(s),V=d.useRef(r),pe=d.useRef(z);d.useEffect(()=>{ae.current=O,G.current=W,b.current=S,L.current=s,V.current=r,pe.current=z});const ne=d.useRef(B=>{tt(B)}).current;d.useEffect(()=>{n&&!S.isActive&&S.startSession()},[n,S]);const tt=d.useCallback(async B=>{var U,_,Me;const F=B.codeResult.code;try{const q=ae.current.registerScan(F);if(q.isThrottled&&q.attemptCount>1){G.current.showThrottled(`Already scanned recently (${q.attemptCount} attempts)`),b.current.addThrottledBarcode(F,Date.now());return}if(pe.current&&!pe.current(F)){G.current.showError("Invalid barcode format");const fe={success:!1,error:"Invalid barcode format",errorType:"INVALID_BARCODE"};b.current.addScan(F,fe,!0);return}G.current.showInfo("Processing barcode...");const Q=await w.current.lookupBarcode(F);b.current.addScan(F,Q,!0),Q.success?(G.current.showSuccess("Barcode scanned successfully!"),(U=L.current)==null||U.call(L,Q)):(G.current.showError(Q.error||"Failed to scan barcode"),(_=V.current)==null||_.call(V,Q.error||"Scan failed"))}catch(q){const Q=q instanceof Error?q.message:"Failed to process scan";G.current.showError(Q);const fe={success:!1,error:Q,errorType:"NETWORK_ERROR"};b.current.addScan(F,fe,!0),(Me=V.current)==null||Me.call(V,Q)}},[]),we=async()=>{if(!k.trim()){W.showError("Please enter a barcode ID");return}const B=k.trim();try{const F=O.registerScan(B);if(F.isThrottled&&F.attemptCount>1){W.showThrottled(`Already scanned recently (${F.attemptCount} attempts)`),S.addThrottledBarcode(B,Date.now());return}if(z&&!z(B)){W.showError("Invalid barcode format");const _={success:!1,error:"Invalid barcode format",errorType:"INVALID_BARCODE"};S.addScan(B,_,!0);return}W.showInfo("Processing barcode...");const U=await w.current.lookupBarcode(B);S.addScan(B,U,!0),U.success?(W.showSuccess("Barcode processed successfully!"),s==null||s(U),v("")):(W.showError(U.error||"Failed to find barcode"),r==null||r(U.error||"Manual entry failed"))}catch(F){const U=F instanceof Error?F.message:"Failed to process manual entry";W.showError(U);const _={success:!1,error:U,errorType:"NETWORK_ERROR"};S.addScan(B,_,!0),r==null||r(U)}},te=d.useRef(!1),ze=d.useRef("camera"),De=d.useRef(!1);d.useEffect(()=>{const B=De.current!==n,F=ze.current!==y;De.current=n,ze.current=y,B&&n&&(te.current=!1),n&&T==="scanner"&&y==="camera"?!M.isActive&&!te.current&&(te.current=!0,(async()=>{try{N.useDialog&&await new Promise(_=>setTimeout(_,100)),await M.startCamera()}catch(_){console.error("Auto-activation failed:",_),te.current=!1}})()):M.isActive&&(F||!n||T!=="scanner")&&(te.current=!1,M.stopCamera())},[n,y,T,M.isActive,M.startCamera,M.stopCamera,ne,N.useDialog]),d.useEffect(()=>(n&&y==="camera"&&M.isActive?M.setOnDetected(ne):M.removeOnDetected(),()=>{M.removeOnDetected()}),[n,y,M.isActive,ne]);const ie=async()=>{await M.stopCamera(),i||S.endSession(),W.resetToIdle(),t()},st=()=>{S.resetSession(),O.clearAll(),W.showInfo("Session history cleared")},Te=async B=>{B==="camera"?(A(B),await M.startCamera(),M.setOnDetected(ne)):(await M.stopCamera(),M.removeOnDetected(),A(B)),W.resetToIdle()},rt=()=>T==="history"?e.jsx(js,{scanHistory:S.scanHistory,statistics:S.statistics,detailed:!0,onClearHistory:st}):T==="stats"&&S.statistics?e.jsxs(m,{sx:{p:2},children:[e.jsx(x,{variant:"h6",gutterBottom:!0,children:"Session Statistics"}),e.jsx(H,{spacing:2,children:e.jsxs(m,{children:[e.jsxs(x,{variant:"body2",color:"text.secondary",children:["Session Duration:"," ",Math.floor(S.statistics.sessionDuration/1e3),"s"]}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:["Total Scanned: ",S.statistics.totalScanned]}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:["Success Rate:"," ",S.statistics.totalScanned>0?Math.round(S.statistics.successfulScans/S.statistics.totalScanned*100):0,"%"]}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:["Avg Scan Interval:"," ",Math.floor(S.statistics.averageScanInterval/1e3),"s"]})]})})]}):e.jsxs(m,{children:[e.jsxs(H,{direction:"row",spacing:1,sx:{mb:2},children:[e.jsx($,{variant:y==="camera"?"contained":"outlined",onClick:()=>Te("camera"),startIcon:e.jsx(Ct,{}),disabled:M.cameraState==="denied",size:"small",children:"Camera"}),g&&e.jsx($,{variant:y==="manual"?"contained":"outlined",onClick:()=>Te("manual"),startIcon:e.jsx(It,{}),size:"small",children:"Manual"})]}),!1,y==="camera"&&e.jsxs(m,{sx:{mb:2},children:[e.jsx("div",{ref:h,style:{width:"100%",height:N.isMobile?"250px":"300px",borderRadius:"8px",backgroundColor:"#000",position:"relative",overflow:"hidden"}}),M.cameraState==="active"&&e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:"Point camera at barcode to scan"})]}),y==="manual"&&e.jsxs(m,{sx:{mb:2},children:[e.jsx(Ge,{fullWidth:!0,label:"Enter Barcode ID",placeholder:"BC_2024-01-15_001",value:k,onChange:B=>v(B.target.value),onKeyDown:B=>{B.key==="Enter"&&we()},disabled:M.cameraState==="initializing",size:"small",sx:{mb:1}}),e.jsx($,{fullWidth:!0,variant:"contained",onClick:we,disabled:M.cameraState==="initializing"||!k.trim(),size:"small",children:"Scan Barcode"})]})]});return e.jsxs(xs,{open:n,onClose:ie,useDrawerOnMobile:N.config.useDrawerOnMobile,useDialogOnDesktop:N.config.useDialogOnDesktop,fullScreenMobile:N.config.fullScreenMobile,children:[e.jsxs(Qe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ce,{}),e.jsx(x,{variant:"h6",component:"h2",children:"Barcode Scanner"}),S.isActive&&e.jsx(j,{size:"small",label:`${((Ae=S.statistics)==null?void 0:Ae.totalScanned)||0} scanned`,color:"primary",variant:"outlined"})]}),e.jsx(K,{onClick:ie,size:"small",children:e.jsx(Ke,{})})]}),e.jsxs(Ve,{sx:{px:2},children:[e.jsxs(jt,{value:T,onChange:(B,F)=>P(F),variant:"fullWidth",sx:{mb:2},children:[e.jsx(je,{label:"Scanner",value:"scanner",icon:e.jsx(Ce,{}),iconPosition:"start"}),e.jsx(je,{label:e.jsx(bt,{badgeContent:S.scanHistory.length,color:"primary",children:"History"}),value:"history",icon:e.jsx(yt,{}),iconPosition:"start"}),e.jsx(je,{label:"Stats",value:"stats",icon:e.jsx(St,{}),iconPosition:"start"})]}),e.jsx(me,{sx:{mb:2}}),rt()]}),e.jsxs(vt,{sx:{p:2,pt:0},children:[e.jsx($,{onClick:ie,variant:"outlined",size:"small",children:"Close"}),S.isActive&&e.jsxs($,{variant:"contained",color:"primary",startIcon:e.jsx(ee,{}),onClick:ie,size:"small",children:["Complete Session (",((ke=S.statistics)==null?void 0:ke.successfulScans)||0," ","scanned)"]})]})]})},Ss=n=>{if(n===0)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(n)/Math.log(t));return parseFloat((n/Math.pow(t,r)).toFixed(2))+" "+s[r]},vs=n=>{const s=Math.floor((new Date().getTime()-n.getTime())/(1e3*60));if(s<1)return"Just now";if(s<60)return`${s}m ago`;const r=Math.floor(s/60);return r<24?`${r}h ago`:n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},Cs=({onRefresh:n,selectedDate:t=new Date})=>{const s=re(),[r,o]=d.useState([]),[u,c]=d.useState(!0),[a,i]=d.useState(null),[l,p]=d.useState(""),g=async()=>{try{c(!0),i(null);const v=He.getDateString(t);p(v);const T=await He.listFilesForDate(t);o(T)}catch(v){const T=v instanceof Error?v.message:"Failed to load files";i(T),console.error("Error loading files for date:",t,v)}finally{c(!1)}},z=v=>{window.open(v.downloadUrl,"_blank")},y=()=>{g(),n==null||n()};d.useEffect(()=>{g()},[t]);const k=t.toDateString()===new Date().toDateString()?"Today's Files (All Users)":`Files for ${l} (All Users)`;return e.jsx(ue,{elevation:2,sx:{mb:3,border:`2px solid ${s.palette.primary.main}`,borderRadius:2},children:e.jsxs(be,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(wt,{color:"primary"}),e.jsx(x,{variant:"h6",component:"h2",children:k}),e.jsx(j,{label:l,size:"small",color:"primary",variant:"outlined"})]}),e.jsx(K,{onClick:y,disabled:u,size:"small",children:e.jsx(zt,{})})]}),u&&e.jsx(m,{sx:{display:"flex",justifyContent:"center",py:3},children:e.jsx(Ie,{size:40})}),a&&!u&&e.jsx(Ee,{severity:"error",sx:{mb:2},children:a}),!u&&!a&&r.length===0&&e.jsxs(Ee,{severity:"info",children:["No files available for download on ",l,". Files from all users are shown when available."]}),!u&&!a&&r.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:[r.length," file",r.length!==1?"s":""," available for download from all users"]}),e.jsx(E,{container:!0,spacing:2,children:r.map(v=>{var T;return e.jsx(E,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ue,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:s.shadows[4]}},children:[e.jsxs(be,{sx:{flexGrow:1,pb:1},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"flex-start",gap:1,mb:1},children:[e.jsx(Dt,{color:"error",sx:{mt:.5,flexShrink:0}}),e.jsx(m,{sx:{minWidth:0,flexGrow:1},children:e.jsx(x,{variant:"subtitle2",sx:{wordBreak:"break-word",lineHeight:1.2,fontSize:"0.875rem"},children:v.name})})]}),e.jsxs(H,{spacing:.5,children:[e.jsx(j,{label:Ss(v.size),size:"small",variant:"outlined",sx:{width:"fit-content"}}),((T=v.metadata)==null?void 0:T.userId)&&e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Owner: ",v.metadata.userId.substring(0,8),"..."]}),e.jsx(x,{variant:"caption",color:"text.secondary",children:vs(v.lastModified)})]})]}),e.jsx(Tt,{sx:{pt:0,justifyContent:"flex-end"},children:e.jsx($,{startIcon:e.jsx(At,{}),onClick:()=>z(v),variant:"contained",size:"small",fullWidth:!0,children:"Download"})})]})},v.path)})})]})]})})},Is=({open:n,onClose:t,selectedDate:s})=>{const o=s.toDateString()===new Date().toDateString()?"Today's Files":`Files for ${s.toLocaleDateString()}`;return e.jsxs(_e,{open:n,onClose:t,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2,maxHeight:"80vh"}},children:[e.jsxs(Qe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[e.jsx(x,{variant:"h6",component:"h2",children:o}),e.jsx(K,{onClick:t,size:"small",children:e.jsx(Ke,{})})]}),e.jsx(Ve,{sx:{p:0},children:e.jsx(m,{sx:{p:2,pt:0},children:e.jsx(Cs,{selectedDate:s})})})]})},ws=({value:n,onChange:t,label:s="Platform Filter",size:r="medium"})=>{const o=(u,c)=>{c&&t(c)};return e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[s&&e.jsxs(x,{variant:"body2",color:"text.secondary",children:[s,":"]}),e.jsxs(kt,{value:n,exclusive:!0,onChange:o,"aria-label":"platform filter",size:r,children:[e.jsx(ye,{value:"all","aria-label":"all platforms",children:"All"}),e.jsx(ye,{value:"amazon","aria-label":"amazon",children:"Amazon"}),e.jsx(ye,{value:"flipkart","aria-label":"flipkart",children:"Flipkart"})]})]})},zs=({value:n,onChange:t,batches:s,loading:r=!1,label:o="Batch",size:u="medium"})=>{const c=i=>{t(i.target.value)},a=[{value:"all",label:"All Batches"},...s.map(i=>({value:i.batchId,label:`${i.fileName} (${i.orderCount} orders)`,batchInfo:i}))];return e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[o&&e.jsxs(x,{variant:"body2",color:"text.secondary",children:[o,":"]}),e.jsxs(qe,{size:u,sx:{minWidth:200},children:[e.jsx(Ye,{id:"batch-filter-label",children:"Filter by Batch"}),e.jsx(Ze,{labelId:"batch-filter-label",value:n,onChange:c,label:"Filter by Batch",disabled:r,children:a.map(i=>e.jsx(ce,{value:i.value,children:i.label},i.value))})]})]})},Ds=({value:n,onChange:t,size:s="medium",label:r="Completion Status"})=>{const o=i=>{t(i.target.value)},u=i=>{switch(i){case"completed":return e.jsx(ee,{fontSize:"small"});case"pending":return e.jsx(he,{fontSize:"small"});default:return e.jsx($e,{fontSize:"small"})}},c=i=>{switch(i){case"completed":return"Completed";case"pending":return"Pending";default:return"All Orders"}},a=i=>{switch(i){case"completed":return"success";case"pending":return"warning";default:return"default"}};return e.jsxs(qe,{size:s,sx:{minWidth:160},children:[e.jsx(Ye,{children:r}),e.jsxs(Ze,{value:n,label:r,onChange:o,renderValue:i=>e.jsx(m,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(j,{icon:u(i),label:c(i),size:"small",color:a(i),variant:"outlined"})}),children:[e.jsx(ce,{value:"all",children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($e,{fontSize:"small"}),"All Orders"]})}),e.jsx(ce,{value:"completed",children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ee,{fontSize:"small",color:"success"}),"Completed"]})}),e.jsx(ce,{value:"pending",children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(he,{fontSize:"small",color:"warning"}),"Pending"]})})]})]})},Ts=({viewMode:n,onViewModeChange:t,platformFilter:s,onPlatformFilterChange:r,batchFilter:o,onBatchFilterChange:u,batches:c,batchesLoading:a=!1,completionFilter:i,onCompletionFilterChange:l,onFilesClick:p,onScannerClick:g,onClearAllFilters:z,totalCount:y,filteredCount:A})=>{const k=re(),[v,T]=d.useState(!1),P=[];if(s!=="all"&&P.push({type:"platform",value:s,label:s.charAt(0).toUpperCase()+s.slice(1)}),o&&o!=="all"){const D=c.find(I=>I.batchId===o);P.push({type:"batch",value:o,label:D?D.fileName.substring(0,20)+(D.fileName.length>20?"...":""):"Unknown Batch"})}i!=="all"&&P.push({type:"completion",value:i,label:i.charAt(0).toUpperCase()+i.slice(1)});const h=P.length>0,w=A!==y;return e.jsxs(m,{sx:{mb:3},children:[e.jsxs(m,{sx:{display:"flex",alignItems:{xs:"flex-start",md:"center"},justifyContent:"space-between",flexDirection:{xs:"column",md:"row"},gap:{xs:2,md:0},p:{xs:1.5,md:2},borderRadius:3,backgroundColor:k.palette.mode==="dark"?"grey.900":"grey.50",border:`1px solid ${k.palette.divider}`,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:k.palette.mode==="dark"?"grey.800":"grey.100"}},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:{xs:1,md:2},flexWrap:"wrap",width:{xs:"100%",md:"auto"}},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:.5,flexShrink:0},children:[e.jsx($,{size:"small",variant:n==="individual"?"contained":"text",onClick:()=>t("individual"),sx:{minWidth:{xs:70,md:80},height:32,fontSize:{xs:"0.7rem",md:"0.75rem"},fontWeight:n==="individual"?600:400,textTransform:"none",borderRadius:1.5},children:"Individual"}),e.jsx($,{size:"small",variant:n==="grouped"?"contained":"text",onClick:()=>t("grouped"),sx:{minWidth:{xs:70,md:80},height:32,fontSize:{xs:"0.7rem",md:"0.75rem"},fontWeight:n==="grouped"?600:400,textTransform:"none",borderRadius:1.5},children:"Category"})]}),e.jsx(me,{orientation:"vertical",flexItem:!0,sx:{height:24,display:{xs:"none",sm:"block"}}}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsxs(x,{variant:"body2",color:"text.primary",sx:{fontWeight:500,fontSize:{xs:"0.75rem",md:"0.875rem"}},children:[w?`${A} of ${y}`:`${y}`," orders"]}),w&&e.jsx(j,{label:"Filtered",size:"small",color:"primary",variant:"outlined",sx:{height:20,fontSize:"0.7rem"}})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx(me,{orientation:"vertical",flexItem:!0,sx:{height:24,display:{xs:"none",sm:"block"}}}),e.jsxs(H,{direction:"row",spacing:.5,sx:{flexWrap:"wrap","& > *":{mb:{xs:.5,sm:0}}},children:[P.slice(0,2).map(D=>e.jsx(j,{label:D.label,size:"small",variant:"filled",color:"secondary",onDelete:()=>{D.type==="platform"?r("all"):D.type==="batch"?u("all"):D.type==="completion"&&l("all")},sx:{height:{xs:24,sm:20},fontSize:{xs:"0.75rem",sm:"0.7rem"},"& .MuiChip-deleteIcon":{fontSize:{xs:"0.875rem",sm:"0.75rem"}}}},`${D.type}-${D.value}`)),P.length>2&&e.jsx(j,{label:`+${P.length-2} more`,size:"small",variant:"outlined",sx:{height:{xs:24,sm:20},fontSize:{xs:"0.75rem",sm:"0.7rem"}}})]})]})]}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:{xs:.5,md:1},flexWrap:"wrap",width:{xs:"100%",md:"auto"},justifyContent:{xs:"flex-end",md:"flex-end"}},children:[h&&e.jsx(X,{title:"Clear all filters",children:e.jsx($,{size:"small",variant:"text",startIcon:e.jsx(ve,{fontSize:"small"}),onClick:z,sx:{minWidth:{xs:40,sm:"auto"},px:{xs:1,md:1.5},fontSize:{xs:"0.75rem",md:"0.875rem"},color:"text.secondary","&:hover":{color:"error.main",backgroundColor:"error.light"},"& .MuiButton-startIcon":{marginRight:{xs:0,sm:1}}},children:e.jsx(m,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Clear"})})}),e.jsx(X,{title:"Files & Uploads",children:e.jsx($,{size:"small",variant:"outlined",startIcon:e.jsx(Mt,{fontSize:"small"}),onClick:p,sx:{minWidth:{xs:40,sm:"auto"},px:{xs:1,md:1.5},fontSize:{xs:"0.75rem",md:"0.875rem"},"& .MuiButton-startIcon":{marginRight:{xs:0,sm:1}}},children:e.jsx(m,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Files"})})}),g&&e.jsx(X,{title:"Scan Order Barcode",children:e.jsx($,{size:"small",variant:"outlined",color:"primary",startIcon:e.jsx(Ce,{fontSize:"small"}),onClick:g,sx:{minWidth:{xs:40,sm:"auto"},px:{xs:1,md:1.5},fontSize:{xs:"0.75rem",md:"0.875rem"},"& .MuiButton-startIcon":{marginRight:{xs:0,sm:1}}},children:e.jsx(m,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Scan"})})}),e.jsx(X,{title:v?"Hide filters":"Show filters",children:e.jsx($,{size:"small",variant:"text",startIcon:e.jsx(Ft,{fontSize:"small"}),endIcon:v?e.jsx(Bt,{fontSize:"small"}):e.jsx(Rt,{fontSize:"small"}),onClick:()=>T(!v),sx:{minWidth:{xs:40,sm:"auto"},px:{xs:1,md:1.5},fontSize:{xs:"0.75rem",md:"0.875rem"},color:v?"primary.main":"text.secondary","& .MuiButton-startIcon":{marginRight:{xs:0,sm:1}},"& .MuiButton-endIcon":{marginLeft:{xs:0,sm:1}}},children:e.jsx(m,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Filters"})})})]})]}),e.jsx(Se,{in:v,timeout:"auto",unmountOnExit:!0,children:e.jsx(m,{sx:{mt:1,p:2,borderRadius:2,backgroundColor:k.palette.background.paper,border:`1px solid ${k.palette.divider}`},children:e.jsxs(H,{direction:{xs:"column",md:"row"},spacing:2,alignItems:{xs:"stretch",md:"center"},children:[e.jsx(ws,{value:s,onChange:r,size:"small",label:"Platform"}),e.jsx(zs,{value:o,onChange:u,batches:c,loading:a,size:"small",label:"Batch"}),e.jsx(Ds,{value:i,onChange:l,size:"small",label:"Status"}),h&&e.jsx(m,{sx:{ml:{xs:0,md:"auto"}},children:e.jsx($,{size:"small",variant:"outlined",color:"error",startIcon:e.jsx(ve,{fontSize:"small"}),onClick:z,children:"Clear All"})})]})})})]})},As=d.lazy(()=>it(()=>import("./MobileTodaysOrdersPage-C5wllafr.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])).then(n=>({default:n.MobileTodaysOrdersPage}))),ks=()=>{const n=Lt(),{items:t,loading:s,batches:r,batchesLoading:o,batchFilter:u,platformFilter:c,completionFilter:a}=We(b=>b.orders),[i,l]=d.useState("grouped"),[p,g]=d.useState(new Date),[z,y]=d.useState(!1),[A,k]=d.useState(!1),[v,T]=d.useState(null);d.useEffect(()=>{const b=J(p,"yyyy-MM-dd"),L=J(new Date,"yyyy-MM-dd");b===L?(n(Ht()),n(Gt())):(n(_t(b)),n(Qt(b)))},[n,p]);const P=b=>{b&&g(b)},h=()=>{const b=new Date(p);b.setDate(b.getDate()-1),g(b)},w=()=>{const b=new Date(p);b.setDate(b.getDate()+1),g(b)},D=()=>{g(new Date)},I=b=>{n(Yt(b))},f=b=>{n(qt(b))},R=b=>{n(Vt(b))},N=async b=>{if(b.success&&b.barcodeId)try{const L=await n(Zt({barcodeId:b.barcodeId})).unwrap();T({type:"success",message:`Order completed: ${L.orderData.productName}`}),k(!1)}catch(L){T({type:"error",message:L instanceof Error?L.message:"Failed to complete order"})}},S=b=>{T({type:"error",message:b})},O=We(Kt),W=d.useMemo(()=>ds(O),[O]),M=c!=="all"||u&&u!=="all"||a!=="all",ae=t.length,G=O.length;return e.jsx(Nt,{maxWidth:!1,sx:{py:{xs:1,sm:2,md:3},px:{xs:1,sm:2}},children:e.jsxs(se,{sx:{p:{xs:2,sm:3},mb:4,borderRadius:2},children:[e.jsxs(m,{sx:{mb:3},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",mb:{xs:2,md:0}},children:[e.jsx(Pt,{sx:{fontSize:{xs:24,md:32},mr:{xs:1,md:2},color:"primary.main"}}),e.jsx(x,{variant:"h4",component:"h1",sx:{fontWeight:"bold",color:"primary.dark",flexGrow:1,fontSize:{xs:"1.5rem",md:"2.125rem"}},children:J(p,"yyyy-MM-dd")===J(new Date,"yyyy-MM-dd")?"Today's Orders":"Orders"})]}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:{xs:.5,md:1},flexWrap:"wrap",justifyContent:{xs:"center",md:"flex-end"}},children:[e.jsx(K,{onClick:h,color:"primary",size:"small",children:e.jsx(Ot,{fontSize:"small"})}),e.jsx(es,{dateAdapter:ts,children:e.jsx(ss,{value:p,onChange:P,sx:{"& .MuiInputBase-root":{fontSize:"0.875rem",minWidth:{xs:"140px",md:"160px"}}},slotProps:{textField:{size:"small",variant:"outlined"}}})}),e.jsx(K,{onClick:w,color:"primary",size:"small",children:e.jsx(Et,{fontSize:"small"})}),e.jsx($,{variant:J(p,"yyyy-MM-dd")===J(new Date,"yyyy-MM-dd")?"contained":"outlined",size:"small",onClick:D,sx:{minWidth:"auto",px:{xs:1.5,md:2}},children:"Today"})]})]}),e.jsx(Ts,{viewMode:i,onViewModeChange:l,platformFilter:c,onPlatformFilterChange:I,batchFilter:u||"all",onBatchFilterChange:f,batches:r,batchesLoading:o,completionFilter:a,onCompletionFilterChange:R,onFilesClick:()=>y(!0),onScannerClick:()=>k(!0),onClearAllFilters:()=>n(Ue()),totalCount:ae,filteredCount:G}),e.jsx(Is,{open:z,onClose:()=>y(!1),selectedDate:p}),e.jsx(bs,{open:A,onClose:()=>k(!1),onScanSuccess:N,onScanError:S,options:{enableManualEntry:!0,cameraTimeout:3e4}}),e.jsxs(m,{sx:{mb:2},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:"bold",color:"primary.dark",mb:2},children:i==="individual"?"Current Orders":"Orders by Category"}),s?e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",m:4,children:e.jsx(Ie,{color:"primary",size:40,thickness:4})}):G===0&&M?e.jsxs(se,{sx:{p:4,textAlign:"center",border:"1px dashed",borderColor:"divider"},children:[e.jsx(x,{variant:"h6",color:"text.secondary",sx:{mb:1},children:"No orders match your current filters"}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Try adjusting your platform or batch filters to see more results"}),e.jsx($,{variant:"outlined",size:"small",onClick:()=>{n(Ue())},children:"Clear All Filters"})]}):e.jsxs(e.Fragment,{children:[i==="individual"&&e.jsx(cs,{summary:O}),i==="grouped"&&e.jsx(hs,{groupedData:W})]})]})]})})},Ks=()=>Ut()?e.jsx(d.Suspense,{fallback:e.jsx(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(Ie,{})}),children:e.jsx(As,{})}):e.jsx(ks,{});export{Ks as TodaysOrderPage};
