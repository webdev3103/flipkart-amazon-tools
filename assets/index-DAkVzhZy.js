import{j as e,bn as me,B as c,p as pe,bo as ye,h as d,k as ce,r as B,at as q,au as $,av as H,aw as F,u as X,b5 as je,b6 as be,bp as Ce,a_ as ve,a3 as W,a$ as Se,b0 as Pe,b1 as te,b2 as T,b4 as Ie,ai as de,bq as De,C as _,Y as Oe,Z as Re,as as ze,V as Te,m as re,ay as ke,br as Fe,aT as Ae,ad as Me,aD as we,bs as We,a9 as A,T as ae,ak as ne,Q as se,aK as Ee,I as Le,aq as Ne,bd as Ue}from"./mui-vendor-DlldRxor.js";import{a as m,b as ue}from"./react-vendor-C0s_J9t-.js";import{u as Be,f as K}from"./redux-vendor-tKFe_QvA.js";import{ak as qe,u as $e,H as oe,al as He,A as Ke,E as Ve,F as Qe}from"./index-D4QRAU_W.js";import{s as Ye,D as Ge}from"./DateRangeFilter-COuz8j7O.js";import{s as Xe,i as V,L as _e,A as Ze}from"./AdapterDateFns-Cwp-64Ap.js";import{e as G}from"./endOfMonth-CxaODxht.js";import{F as Y}from"./FormattedCurrency-CWfs6hb7.js";import{D as Je}from"./DataTable-CqcHOsap.js";import{R as et,a as tt,X as rt,Y as at,T as nt,B as st,C as ot}from"./generateCategoricalChart-B6_j-LNJ.js";import{B as it}from"./BarChart-wdLFzAYP.js";import{M as ie}from"./MobileAppShell-dHUJWRrR.js";import"./firebase-vendor-40dJGoDN.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-DisdNAgy.js";const lt=({anchorEl:o,onClose:g,categories:h,selectedCategory:l,selectedSku:x,selectedPlatform:f,selectedProduct:b,skuOptions:a,platformOptions:i,productOptions:p,onCategoryChange:C,onSkuChange:v,onPlatformChange:u,onProductChange:n,onClearFilters:S})=>e.jsx(me,{open:!!o,anchorEl:o,onClose:g,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(c,{sx:{width:300,maxHeight:500,overflow:"auto"},children:e.jsxs(pe,{children:[e.jsx(ye,{children:e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(d,{variant:"subtitle1",children:"Filters"}),e.jsx(ce,{size:"small",onClick:S,children:"Clear All"})]})}),e.jsx(B,{children:e.jsxs(q,{fullWidth:!0,children:[e.jsx($,{children:"Category"}),e.jsxs(H,{value:l,label:"Category",onChange:r=>C(r.target.value),size:"small",children:[e.jsx(F,{value:"",children:"All Categories"}),h.map(r=>e.jsx(F,{value:r.name,children:r.name},r.id)),e.jsx(F,{value:"Uncategorized",children:"Uncategorized"})]})]})}),e.jsx(B,{children:e.jsxs(q,{fullWidth:!0,children:[e.jsx($,{children:"Product"}),e.jsxs(H,{value:b,label:"Product",onChange:r=>n(r.target.value),size:"small",children:[e.jsx(F,{value:"",children:"All Products"}),p.map(r=>e.jsx(F,{value:r,children:r},r))]})]})}),e.jsx(B,{children:e.jsxs(q,{fullWidth:!0,children:[e.jsx($,{children:"SKU"}),e.jsxs(H,{value:x,label:"SKU",onChange:r=>v(r.target.value),size:"small",children:[e.jsx(F,{value:"",children:"All SKUs"}),a.map(r=>e.jsx(F,{value:r,children:r},r))]})]})}),e.jsx(B,{children:e.jsxs(q,{fullWidth:!0,children:[e.jsx($,{children:"Platform"}),e.jsxs(H,{value:f,label:"Platform",onChange:r=>u(r.target.value),size:"small",children:[e.jsx(F,{value:"",children:"All Platforms"}),i.map(r=>e.jsx(F,{value:r,children:r},r))]})]})})]})})}),ct=({allOrders:o,categories:g,products:h})=>{const[l,x]=m.useState({selectedCategory:"",selectedSku:"",selectedPlatform:"",selectedProduct:"",dateRange:{startDate:Xe(new Date),endDate:G(new Date)}}),[f,b]=m.useState([]),[a,i]=m.useState([]),[p,C]=m.useState([]);m.useEffect(()=>{if(o.length>0){const r=Array.from(new Set(o.map(t=>t.SKU).filter(t=>t&&typeof t=="string")));b(r);const P=Array.from(new Set(o.map(t=>t.type).filter(t=>t&&typeof t=="string")));i(P);const s=Array.from(new Set(o.map(t=>{var y;return t.name||((y=t.product)==null?void 0:y.name)}).filter(t=>t&&typeof t=="string")));C(s)}},[o]);const v=(r,P)=>{x(s=>({...s,[r]:P}))},u=()=>{x({selectedCategory:"",selectedSku:"",selectedPlatform:"",selectedProduct:"",dateRange:l.dateRange})},n=()=>{x(r=>({...r,dateRange:{startDate:new Date,endDate:new Date}}))},S=o.filter(r=>{var M;let P=!0;try{if(r.date&&typeof r.date=="string"){const k=new Date(r.date);isNaN(k.getTime())||(P=V(k,{start:l.dateRange.startDate,end:l.dateRange.endDate}))}}catch{}if(!P)return!1;const s=(()=>{var N;if(!((N=r.product)!=null&&N.categoryId)||g.length===0)return"Uncategorized";const k=g.find(Q=>{var U;return Q.id===((U=r.product)==null?void 0:U.categoryId)});return(k==null?void 0:k.name)||"Uncategorized"})(),t=r.SKU||"",y=r.type||"",I=r.name||((M=r.product)==null?void 0:M.name)||"",D=!l.selectedCategory||s===l.selectedCategory,O=!l.selectedSku||t===l.selectedSku,R=!l.selectedPlatform||y===l.selectedPlatform,L=!l.selectedProduct||I===l.selectedProduct;return D&&O&&R&&L}).map(r=>{const P=h.find(s=>{var t;return s.sku.toLowerCase()===((t=r.SKU)==null?void 0:t.toLowerCase())});return{...r,product:P}});return{filterState:l,skuOptions:f,platformOptions:a,productOptions:p,filteredOrders:S,updateFilter:v,clearFilters:u,clearDateRange:n}},dt=({orders:o,categories:g})=>{const[h,l]=m.useState(!1),x=m.useMemo(()=>{const a=qe(new Date),i=Ye(a,1);return{today:{start:a,end:G(a)},yesterday:{start:i,end:G(i)}}},[]),f=m.useMemo(()=>{const a={};return g.forEach(i=>{i.id&&(a[i.id]=i.name)}),a},[g]),b=m.useMemo(()=>{if(!o.length)return{categoryData:[],topCategories:[],todayTotal:0,yesterdayTotal:0};const a={};let i=0,p=0;o.forEach(u=>{var r;let n,S;if((r=u.product)!=null&&r.categoryId&&f[u.product.categoryId]?(n=u.product.categoryId,S=f[n]):(n="uncategorized",S="Uncategorized"),a[n]||(a[n]={categoryId:n,categoryName:S,totalOrders:0,todayOrders:0,yesterdayOrders:0,orderChange:0,orderChangePercent:0,isTopCategory:!1,productCount:0}),a[n].totalOrders+=1,u.date){const P=new Date(u.date);V(P,x.today)?(a[n].todayOrders+=1,i+=1):V(P,x.yesterday)&&(a[n].yesterdayOrders+=1,p+=1)}}),Object.values(a).forEach(u=>{const n=new Set(o.filter(S=>{var r,P;return u.categoryId==="uncategorized"?!((r=S.product)!=null&&r.categoryId)||!f[S.product.categoryId]:((P=S.product)==null?void 0:P.categoryId)===u.categoryId}).map(S=>S.SKU).filter(Boolean));u.productCount=n.size}),Object.values(a).forEach(u=>{u.orderChange=u.todayOrders-u.yesterdayOrders,u.orderChangePercent=u.yesterdayOrders>0?u.orderChange/u.yesterdayOrders*100:u.todayOrders>0?100:0});const C=Object.values(a).sort((u,n)=>n.totalOrders-u.totalOrders),v=C.slice(0,10).map(u=>({...u,isTopCategory:!0}));return v.forEach(u=>{const n=a[u.categoryId];n&&(n.isTopCategory=!0)}),{categoryData:C,topCategories:v,todayTotal:i,yesterdayTotal:p}},[o,f,x]);return m.useEffect(()=>{if(o.length>0){l(!0);const a=setTimeout(()=>l(!1),100);return()=>clearTimeout(a)}},[o.length]),{...b,loading:h}},le=({value:o,percentage:g,showIcon:h=!0,size:l="medium"})=>{const x=X(),f=()=>o>0?{color:x.palette.success.main,icon:e.jsx(je,{fontSize:l}),textColor:x.palette.success.main}:o<0?{color:x.palette.error.main,icon:e.jsx(be,{fontSize:l}),textColor:x.palette.error.main}:{color:x.palette.text.secondary,icon:e.jsx(Ce,{fontSize:l}),textColor:x.palette.text.secondary},{color:b,icon:a,textColor:i}=f(),p=n=>n>0?`+${n}`:n<0?`${n}`:"0",C=n=>n>0?`+${n.toFixed(1)}%`:n<0?`${n.toFixed(1)}%`:"0.0%",u={small:{fontSize:"0.75rem",iconSize:"small",spacing:.5},medium:{fontSize:"0.875rem",iconSize:"small",spacing:1},large:{fontSize:"1rem",iconSize:"medium",spacing:1.5}}[l];return e.jsxs(c,{display:"flex",alignItems:"center",gap:u.spacing,sx:{color:i,fontWeight:500},children:[h&&e.jsx(c,{display:"flex",alignItems:"center",sx:{color:b},children:ue.cloneElement(a,{fontSize:u.iconSize})}),e.jsxs(c,{display:"flex",flexDirection:"column",alignItems:"flex-end",children:[e.jsx(d,{variant:"body2",sx:{fontSize:u.fontSize,fontWeight:600,lineHeight:1.2},children:p(o)}),e.jsx(d,{variant:"caption",sx:{fontSize:`calc(${u.fontSize} * 0.85)`,color:x.palette.text.secondary,lineHeight:1.2},children:C(g)})]})]})},ut=({categoryName:o,products:g,categories:h,isOpen:l})=>{const[x,f]=m.useState(0),[b,a]=m.useState(10),i={};h.forEach(n=>{n.id&&(i[n.id]=n.name)});const p=m.useMemo(()=>[...g].sort((n,S)=>{const r=parseInt(n.quantity)||0;return(parseInt(S.quantity)||0)-r}),[g]),C=m.useMemo(()=>{const n=x*b;return p.slice(n,n+b)},[p,x,b]),v=(n,S)=>{f(S)},u=n=>{a(parseInt(n.target.value,10)),f(0)};return ue.useEffect(()=>{f(0)},[g]),l?e.jsxs(c,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,color:"primary",sx:{mt:2,mb:1},children:['Products in "',o,'" Category']}),e.jsxs(d,{variant:"body2",color:"text.secondary",mb:2,children:[p.length," products found"]}),e.jsx(ve,{component:W,variant:"outlined",children:e.jsxs(Se,{size:"small",children:[e.jsx(Pe,{children:e.jsxs(te,{children:[e.jsx(T,{sx:{fontWeight:"bold"},children:"Product Name"}),e.jsx(T,{sx:{fontWeight:"bold"},align:"right",children:"SKU"}),e.jsx(T,{sx:{fontWeight:"bold"},align:"right",children:"Quantity"}),e.jsx(T,{sx:{fontWeight:"bold"},align:"right",children:"Price"}),e.jsx(T,{sx:{fontWeight:"bold"},align:"right",children:"Total Value"})]})}),e.jsx(Ie,{children:C.map((n,S)=>{var t,y,I,D,O;const r=parseInt(n.quantity)||0,P=((t=n.product)==null?void 0:t.sellingPrice)||0,s=r*P;return e.jsxs(te,{hover:!0,children:[e.jsx(T,{children:e.jsxs(c,{children:[e.jsx(d,{variant:"body2",fontWeight:"medium",children:((y=n.product)==null?void 0:y.name)||"Unknown Product"}),((I=n.product)==null?void 0:I.categoryId)&&e.jsx(de,{label:i[n.product.categoryId]||"Unknown Category",size:"small",color:"primary",variant:"outlined",sx:{mt:.5}})]})}),e.jsx(T,{align:"right",children:e.jsx(d,{variant:"body2",fontFamily:"monospace",children:((D=n.product)==null?void 0:D.sku)||"N/A"})}),e.jsx(T,{align:"right",children:e.jsx(d,{variant:"body2",fontWeight:"medium",children:r.toLocaleString()})}),e.jsx(T,{align:"right",children:e.jsxs(d,{variant:"body2",children:["₹",P.toLocaleString()]})}),e.jsx(T,{align:"right",children:e.jsxs(d,{variant:"body2",fontWeight:"bold",color:"primary",children:["₹",s.toLocaleString()]})})]},`${(O=n.product)==null?void 0:O.sku}-${S}`)})})]})}),p.length>0&&e.jsx(De,{rowsPerPageOptions:[5,10,25,50],component:"div",count:p.length,rowsPerPage:b,page:x,onPageChange:v,onRowsPerPageChange:u,sx:{".MuiTablePagination-selectLabel":{fontSize:"0.875rem"},".MuiTablePagination-displayedRows":{fontSize:"0.875rem"}}}),p.length===0&&e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"No products found in this category"})})]}):null},ht=({historicalData:o,orders:g,categories:h})=>{const[l,x]=m.useState(!0),[f,b]=m.useState([]),[a,i]=m.useState(""),p=m.useMemo(()=>{const s={};return h.forEach(t=>{t.id&&(s[t.id]=t.name)}),s},[h]),C=m.useMemo(()=>{const s={};return g.forEach(t=>{var D;const y=(D=t.product)==null?void 0:D.categoryId,I=y&&p[y]||"Uncategorized";s[I]||(s[I]=[]),s[I].push(t)}),s},[g,p]),v=m.useCallback(s=>C[s]||[],[C]),u=m.useMemo(()=>{const s={},t={};return g.forEach(y=>{var O;const I=(O=y.product)==null?void 0:O.categoryId,D=I&&p[I]||"Uncategorized";t[D]||(t[D]=[]),t[D].push(y)}),Object.entries(t).forEach(([y,I])=>{s[y]={revenue:0,cost:0,profit:0},I.forEach(D=>{var M;const O=parseInt(D.quantity)||1,R=((M=D.product)==null?void 0:M.sellingPrice)||0,L=0;s[y].revenue+=R*O,s[y].cost+=L*O}),s[y].profit=s[y].revenue-s[y].cost}),s},[g,p]),n=m.useMemo(()=>{if(!o.length)return[];const s=[];return o.forEach(t=>{const y=u[t.categoryName]||{revenue:0,cost:0,profit:0},I=y.revenue>0?y.profit/y.revenue*100:0;s.push({categoryId:t.categoryId,categoryName:t.categoryName,totalOrders:t.totalOrders,todayOrders:t.todayOrders,yesterdayOrders:t.yesterdayOrders,orderChange:t.orderChange,orderChangePercent:t.orderChangePercent,totalRevenue:y.revenue,totalCost:y.cost,profit:y.profit,profitMargin:I})}),s},[o,u]);m.useEffect(()=>{b(n),x(!1)},[n]);const S=m.useMemo(()=>{if(!a)return f;const s=a.toLowerCase();return f.filter(t=>t.categoryName.toLowerCase().includes(s))},[f,a]),r=m.useMemo(()=>f.reduce((s,t)=>({orders:s.orders+t.totalOrders,revenue:s.revenue+t.totalRevenue}),{orders:0,revenue:0}),[f]),P=[{id:"categoryName",label:"Category",minWidth:150},{id:"totalOrders",label:"Total Orders",align:"left",minWidth:150,format:(s,t)=>{const y=r.orders>0?s/r.orders*100:0;return e.jsxs(c,{sx:{width:"100%"},children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",mb:.5,children:[e.jsx(d,{variant:"body2",children:s.toLocaleString()}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:[y.toFixed(1),"%"]})]}),e.jsx(c,{sx:{width:"100%",height:6,bgcolor:"action.hover",borderRadius:1,overflow:"hidden"},children:e.jsx(c,{sx:{width:`${y}%`,height:"100%",bgcolor:"primary.main",borderRadius:1}})}),e.jsx(le,{value:(t==null?void 0:t.orderChange)||0,percentage:(t==null?void 0:t.orderChangePercent)||0,size:"small"})]})}},{id:"orderChange",label:"Vs Yesterday",align:"right",minWidth:150,format:(s,t)=>e.jsx(le,{value:(t==null?void 0:t.orderChange)||0,percentage:(t==null?void 0:t.orderChangePercent)||0,size:"small"})},{id:"totalRevenue",label:"Revenue",align:"right",minWidth:150,format:(s,t)=>{const y=r.revenue>0?s/r.revenue*100:0;return e.jsxs(c,{children:[e.jsx(Y,{value:s}),e.jsxs(d,{variant:"caption",display:"block",color:"text.secondary",children:[y.toFixed(1),"% share"]})]})}},{id:"totalCost",label:"Cost",align:"right",minWidth:150,format:s=>e.jsx(Y,{value:s})},{id:"profit",label:"Profit",align:"right",minWidth:150,format:(s,t)=>e.jsxs(c,{children:[e.jsx(Y,{value:s}),e.jsxs(c,{fontSize:"0.75rem",color:"text.secondary",children:[t==null?void 0:t.profitMargin.toFixed(1),"%"]})]})}];return l?e.jsx(c,{display:"flex",justifyContent:"center",p:2,children:e.jsx(_,{})}):f.length?e.jsxs(c,{children:[e.jsx(c,{mb:2,children:e.jsx(Oe,{placeholder:"Search categories...",variant:"outlined",size:"small",fullWidth:!0,value:a,onChange:s=>i(s.target.value),InputProps:{startAdornment:e.jsx(Re,{position:"start",children:e.jsx(ze,{})})}})}),e.jsx(Je,{columns:P,data:S,defaultSortColumn:"totalOrders",defaultSortDirection:"desc",getRowId:s=>s.categoryId,rowsPerPageOptions:[10,25,50],defaultRowsPerPage:25,renderCollapse:s=>e.jsx(ut,{categoryName:s.categoryName,products:v(s.categoryName),categories:h,isOpen:!0})})]}):e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",children:e.jsx(c,{textAlign:"center",children:e.jsx(c,{color:"text.secondary",mb:2,children:"No category data available"})})})},gt=({category:o,rank:g})=>{const h=X(),l=g<=3,f=(i=>{switch(i){case 1:return"#FFD700";case 2:return"#C0C0C0";case 3:return"#CD7F32";default:return h.palette.grey[300]}})(g),b=o.orderChange>=0,a=b?h.palette.success.main:h.palette.error.main;return e.jsxs(Te,{sx:{height:"100%",position:"relative",overflow:"visible",transition:"transform 0.2s, box-shadow 0.2s",border:`1px solid ${re(h.palette.divider,.1)}`,"&:hover":{transform:"translateY(-4px)",boxShadow:h.shadows[4],borderColor:h.palette.primary.main}},children:[e.jsx(c,{sx:{position:"absolute",top:-10,left:-10,width:32,height:32,borderRadius:"50%",backgroundColor:f,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:h.shadows[2],zIndex:1,border:`2px solid ${h.palette.background.paper}`},children:e.jsx(d,{variant:"subtitle2",sx:{fontWeight:"bold",color:l?"#fff":h.palette.text.primary,textShadow:l?"0px 1px 2px rgba(0,0,0,0.3)":"none"},children:g})}),e.jsxs(ke,{sx:{pt:3,pb:"16px !important"},children:[e.jsx(d,{variant:"subtitle1",fontWeight:"bold",noWrap:!0,title:o.categoryName,sx:{mb:2,ml:1},children:o.categoryName}),e.jsxs(c,{display:"flex",flexDirection:"column",gap:1.5,children:[e.jsxs(c,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(c,{display:"flex",alignItems:"center",gap:1,color:"text.secondary",children:[e.jsx(Fe,{fontSize:"small"}),e.jsx(d,{variant:"body2",children:"Orders"})]}),e.jsx(d,{variant:"subtitle2",fontWeight:"bold",children:o.totalOrders.toLocaleString()})]}),e.jsxs(c,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(c,{display:"flex",alignItems:"center",gap:1,color:"text.secondary",children:[e.jsx(Ae,{fontSize:"small"}),e.jsx(d,{variant:"body2",children:"Products"})]}),e.jsx(d,{variant:"subtitle2",fontWeight:"bold",children:o.productCount.toLocaleString()})]}),e.jsxs(c,{sx:{mt:1,p:1,bgcolor:re(a,.1),borderRadius:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(d,{variant:"caption",fontWeight:"medium",color:"text.secondary",children:"vs Yesterday"}),e.jsxs(c,{display:"flex",alignItems:"center",gap:.5,children:[b?e.jsx(Me,{sx:{fontSize:16,color:a}}):e.jsx(we,{sx:{fontSize:16,color:a}}),e.jsxs(d,{variant:"caption",fontWeight:"bold",sx:{color:a},children:[Math.abs(o.orderChange)," (",Math.abs(o.orderChangePercent).toFixed(1),"%)"]})]})]})]})]})]})},xt=({topCategories:o,totalCategories:g})=>{const h=X();return o.length?e.jsxs(c,{children:[e.jsxs(c,{display:"flex",alignItems:"center",gap:1,mb:2,children:[e.jsx(We,{sx:{color:h.palette.warning.main}}),e.jsx(d,{variant:"h6",children:"Top 10 Categories"}),e.jsx(de,{label:`${o.length} of ${g} categories`,size:"small",variant:"outlined",color:"primary"})]}),e.jsx(A,{container:!0,spacing:2,children:o.map((l,x)=>e.jsx(A,{item:!0,xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(gt,{category:l,rank:x+1})},l.categoryId))})]}):e.jsx(c,{textAlign:"center",py:3,children:e.jsx(d,{variant:"h6",color:"text.secondary",children:"No top performers data available"})})},ft=({orders:o,categories:g,isLoading:h})=>{const{categoryData:l,topCategories:x,loading:f}=dt({orders:o,categories:g});return h||f?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(_,{})}):o.length?e.jsxs(e.Fragment,{children:[e.jsx(W,{sx:{p:2,mb:3},children:e.jsx(xt,{topCategories:x,totalCategories:l.length})}),e.jsxs(W,{sx:{p:2},children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"All Categories & Distribution Details"}),e.jsx(ht,{historicalData:l,orders:o,categories:g})]})]}):e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",children:e.jsx(d,{variant:"h6",color:"text.secondary",children:"No data available for historical analysis"})})},mt=({orders:o,categories:g})=>{const h=["#1976d2","#dc004e","#388e3c","#f57c00","#7b1fa2","#d32f2f","#388e3c","#f57c00","#1976d2","#7b1fa2","#ff9800","#795548","#607d8b","#e91e63","#3f51b5","#009688","#ff5722","#673ab7","#2196f3","#4caf50","#ffeb3b","#9c27b0","#00bcd4","#8bc34a","#ffc107","#9e9e9e","#f44336","#3f51b5","#009688","#ff9800"],l={};g.forEach(a=>{a.id&&(l[a.id]=a.name)});const x={};o.forEach(a=>{var v;const i=(v=a.product)==null?void 0:v.categoryId,p=i&&l[i]||"Uncategorized",C=parseInt(a.quantity)||1;x[p]||(x[p]=0),x[p]+=C});const f=Object.entries(x).map(([a,i],p)=>({name:a,value:i,color:h[p%h.length]})).sort((a,i)=>i.value-a.value).slice(0,30);if(!o.length)return e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"No data available"})});const b=({active:a,payload:i,label:p})=>a&&i&&i.length?e.jsxs(c,{sx:{backgroundColor:"background.paper",border:"1px solid #ccc",borderRadius:1,p:1.5,boxShadow:2},children:[e.jsx(d,{variant:"body2",fontWeight:"bold",mb:.5,children:p}),e.jsxs(d,{variant:"body2",color:"primary",children:["Orders: ",i[0].value.toLocaleString()]})]}):null;return e.jsxs(c,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",mb:2,children:"Top 30 Categories by Order Quantity"}),e.jsx(et,{width:"100%",height:500,children:e.jsxs(it,{data:f,margin:{top:20,right:30,left:20,bottom:100},children:[e.jsx(tt,{strokeDasharray:"3 3"}),e.jsx(rt,{dataKey:"name",angle:-45,textAnchor:"end",height:80,tick:{fontSize:10},interval:0}),e.jsx(at,{label:{value:"Number of Orders",angle:-90,position:"insideLeft",style:{textAnchor:"middle",fontSize:"12px"}},tickFormatter:a=>a.toLocaleString()}),e.jsx(nt,{content:e.jsx(b,{})}),e.jsx(st,{dataKey:"value",name:"Orders",fill:"#1976d2",radius:[4,4,0,0],maxBarSize:50,children:f.map((a,i)=>e.jsx(ot,{fill:a.color},`cell-${i}`))})]})})]})},pt=({orders:o,categories:g,isLoading:h})=>h?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(_,{})}):e.jsx(W,{sx:{p:2},children:e.jsx(A,{container:!0,spacing:3,children:e.jsxs(A,{item:!0,xs:12,children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Orders by Category"}),e.jsx(mt,{orders:o,categories:g})]})})}),yt=({orders:o,returns:g=[]})=>{const h=o.length,l=o.reduce((p,C)=>{var n;const v=((n=C.product)==null?void 0:n.sellingPrice)||0,u=parseInt(C.quantity)||0;return p+v*u},0),x=h?l/h:0,f=g.length,b=h>0?f/h*100:0,a=g.reduce((p,C)=>{var v;return p+(((v=C.financials)==null?void 0:v.refundAmount)||0)},0),i=l-a;return e.jsxs(A,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(W,{sx:{p:2,height:"100%",background:"transparent"},children:[e.jsxs(c,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(d,{variant:"subtitle2",color:"text.secondary",children:"Revenue Health"}),e.jsx(ae,{title:"Net Revenue = Total Revenue - Refunds",children:e.jsx(ne,{fontSize:"small",color:"action",sx:{opacity:.6}})})]}),e.jsxs(d,{variant:"h4",color:"success.main",gutterBottom:!0,children:["₹",i.toFixed(2)]}),e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(d,{variant:"caption",color:"text.secondary",children:["Gross: ₹",l.toFixed(2)]}),e.jsxs(d,{variant:"caption",color:"error.main",children:["Refunds: -₹",a.toFixed(2)]})]})]})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(W,{sx:{p:2,height:"100%",background:"transparent"},children:[e.jsx(c,{display:"flex",alignItems:"center",gap:1,mb:1,children:e.jsx(d,{variant:"subtitle2",color:"text.secondary",children:"Order Volume"})}),e.jsx(d,{variant:"h4",gutterBottom:!0,children:h}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:[f," Returns (",b.toFixed(1),"%)"]})]})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(W,{sx:{p:2,height:"100%",background:"transparent"},children:[e.jsxs(c,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(d,{variant:"subtitle2",color:"text.secondary",children:"Return Impact"}),e.jsx(ae,{title:"Percentage of orders returned",children:e.jsx(ne,{fontSize:"small",color:"action",sx:{opacity:.6}})})]}),e.jsxs(d,{variant:"h4",color:b>10?"error.main":"text.primary",children:[b.toFixed(1),"%"]}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"of total orders"})]})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(W,{sx:{p:2,height:"100%",background:"transparent"},children:[e.jsx(c,{display:"flex",alignItems:"center",gap:1,mb:1,children:e.jsx(d,{variant:"subtitle2",color:"text.secondary",children:"Average Order Value"})}),e.jsxs(d,{variant:"h4",children:["₹",x.toFixed(2)]}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Gross Revenue / Total Orders"})]})})]})},wt=()=>{const o=Be(),g=$e(),{items:h,loading:l,error:x}=K(j=>j.allOrdersForAnalytics),{items:f,loading:b,error:a}=K(j=>j.products),{items:i,loading:p,error:C}=K(j=>j.categories),{returns:v,loading:u,error:n}=K(j=>j.flipkartReturns),[S,r]=m.useState(null),[P,s]=m.useState(null),{filterState:t,skuOptions:y,platformOptions:I,productOptions:D,filteredOrders:O,updateFilter:R,clearFilters:L}=ct({allOrders:h,categories:i,products:f}),M=m.useMemo(()=>l||b||p||u,[l,b,p,u]),k=m.useMemo(()=>x||a||C||n,[x,a,C,n]);m.useEffect(()=>{(async()=>{const z=[];h.length===0&&!l&&!x&&z.push(o(He())),f.length===0&&!b&&!a&&z.push(o(Ke({}))),i.length===0&&!p&&!C&&z.push(o(Ve())),v.length===0&&!u&&!n&&z.push(o(Qe())),z.length>0&&await Promise.all(z)})()},[]);const N=m.useCallback(j=>{r(j.currentTarget)},[]),Q=m.useCallback(()=>{r(null)},[]),U=m.useCallback(j=>{s(j.currentTarget)},[]),he=m.useCallback(()=>{s(null)},[]),Z=m.useMemo(()=>[t.selectedCategory,t.selectedSku,t.selectedPlatform,t.selectedProduct].filter(Boolean).length,[t]),ge=m.useMemo(()=>`${oe(t.dateRange.startDate,"dd MMM yyyy")} - ${oe(t.dateRange.endDate,"dd MMM yyyy")}`,[t.dateRange.startDate,t.dateRange.endDate]),xe=m.useMemo(()=>v.filter(j=>{const z=j.dates.returnDeliveredDate||j.dates.returnApprovedDate||j.dates.returnInitiatedDate,ee=new Date(z);if(isNaN(ee.getTime())||!V(ee,{start:t.dateRange.startDate,end:t.dateRange.endDate})||t.selectedSku&&j.sku!==t.selectedSku||t.selectedProduct&&j.productTitle!==t.selectedProduct)return!1;if(t.selectedCategory)if(j.categoryId){const w=i.find(E=>E.id===j.categoryId);if((w==null?void 0:w.name)!==t.selectedCategory)return!1}else{const w=f.find(E=>E.sku===j.sku);if(w!=null&&w.categoryId){const E=i.find(fe=>fe.id===w.categoryId);if((E==null?void 0:E.name)!==t.selectedCategory)return!1}else if(t.selectedCategory!=="Uncategorized")return!1}return!0}),[v,t,i,f]);if(k){const j=e.jsx(se,{maxWidth:"xl",sx:{mt:4,mb:4},children:e.jsxs(d,{color:"error",variant:"h6",children:["Error: ",k]})});return g?e.jsx(ie,{pageTitle:"Order Analytics",children:j}):j}const J=e.jsx(_e,{dateAdapter:Ze,children:e.jsxs(se,{maxWidth:!1,sx:{mt:g?2:4,mb:g?2:4},children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(d,{variant:"h4",children:"Order Analytics"}),e.jsxs(c,{display:"flex",gap:2,children:[e.jsx(ce,{variant:"outlined",startIcon:e.jsx(Ee,{}),onClick:U,sx:{textTransform:"none"},children:ge}),e.jsx(Le,{onClick:N,color:Z>0?"primary":"default",sx:{ml:1},children:e.jsx(Ne,{badgeContent:Z,color:"primary",children:e.jsx(Ue,{})})})]})]}),e.jsx(Ge,{dateRange:t.dateRange,onDateRangeChange:(j,z)=>R("dateRange",{startDate:j,endDate:z}),anchorEl:P,onClose:he}),e.jsx(lt,{anchorEl:S,onClose:Q,categories:i,selectedCategory:t.selectedCategory,selectedSku:t.selectedSku,selectedPlatform:t.selectedPlatform,selectedProduct:t.selectedProduct,skuOptions:y,platformOptions:I,productOptions:D,onCategoryChange:j=>R("selectedCategory",j),onSkuChange:j=>R("selectedSku",j),onPlatformChange:j=>R("selectedPlatform",j),onProductChange:j=>R("selectedProduct",j),onClearFilters:L}),e.jsx(yt,{orders:O,returns:xe,products:f,categories:i}),e.jsx(ft,{orders:O,products:f,categories:i,filterState:t,onFilterUpdate:R,isLoading:M}),e.jsx(c,{mt:4,children:e.jsx(pt,{orders:O,products:f,categories:i,filterState:t,onFilterUpdate:R,isLoading:M})})]})});return g?e.jsx(ie,{pageTitle:"Order Analytics",children:J}):J};export{wt as default};
