const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MobileTransactionAnalytics-0XSa3Ehq.js","assets/mui-vendor-DlldRxor.js","assets/react-vendor-C0s_J9t-.js","assets/MobileAppShell-dHUJWRrR.js","assets/index-D4QRAU_W.js","assets/redux-vendor-tKFe_QvA.js","assets/firebase-vendor-40dJGoDN.js","assets/utils-vendor-CFocuF-S.js","assets/pdf-vendor-DisdNAgy.js","assets/MobileCard-BmxjauOU.js","assets/usePullToRefresh-C2FNOxJ5.js","assets/transactionAnalysis.service-DrepQx6p.js","assets/DataTable-CqcHOsap.js","assets/FormattedCurrency-CWfs6hb7.js"])))=>i.map(i=>d[i]);
var q=Object.defineProperty;var K=(o,e,r)=>e in o?q(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r;var x=(o,e,r)=>K(o,typeof e!="symbol"?e+"":e,r);import{_ as B}from"./pdf-vendor-DisdNAgy.js";import{j as t,T as j,ai as S,aS as $,ae as G,O as H,aT as Q,ad as N,a9 as u,a3 as I,h as m,B as g,G as X,ak as Y,C as U,Q as J,z as Z,D as ee,V as te,ay as re,aU as se,k as M,aV as ae,aW as oe,A as ie,aX as ne,aY as O}from"./mui-vendor-DlldRxor.js";import{a as y,i as ce}from"./react-vendor-C0s_J9t-.js";import{T as le}from"./transactionAnalysis.service-DrepQx6p.js";import{T as de,u as ue,i as he,j as E,D as pe,A as fe,U as xe}from"./index-D4QRAU_W.js";import{D as W}from"./DataTable-CqcHOsap.js";import{F as P}from"./FormattedCurrency-CWfs6hb7.js";import{a as me,u as D}from"./utils-vendor-CFocuF-S.js";const ge=({transactions:o})=>{const e=s=>`₹${s.toFixed(2)}`,r=o.map(s=>({transactionId:s.transactionId||"",sku:s.sku||"",productName:s.product.name||s.description||"Unknown Product",platform:s.platform||"",sellingPrice:s.sellingPrice||0,total:s.total||0,productCost:0,costPriceSource:"none",type:s.type||""})),a=[{id:"transactionId",label:"#",filter:!0},{id:"sku",label:"SKU",filter:!0},{id:"productName",label:"Product Name",filter:!0},{id:"platform",label:"Platform",filter:!0},{id:"sellingPrice",label:"Selling Price",align:"right",filter:!0,format:s=>e(s)},{id:"total",label:"Earnings",align:"right",format:s=>e(s)},{id:"productCost",label:"Product Cost",align:"right",format:s=>e(s)},{id:"costPriceSource",label:"Price Source",filter:!0,format:s=>{const n=s;let h="inherit";return n==="product"&&(h="#1976d2"),n==="category"&&(h="#9c27b0"),t.jsx("span",{style:{fontWeight:n==="default"?"normal":"bold",color:h},children:n})}},{id:"type",label:"Type",filter:!0}];return t.jsx(W,{columns:a,data:r,defaultSortColumn:"transactionId",defaultSortDirection:"asc",rowsPerPageOptions:[15,30,50],defaultRowsPerPage:30})},ye=({transactions:o,summary:e})=>{const r=i=>`₹${i.toFixed(2)}`,a=i=>{switch(i){case"product":return"success";case"category":return"primary";case"default":default:return"warning"}},s=i=>{switch(i){case"product":return"Custom cost price defined directly on the product";case"category":return"Cost price inherited from product category";case"default":default:return"Default cost price (no custom price or category price available)"}},n=y.useMemo(()=>{const i=new Map;return e?Object.entries(e.salesByProduct).forEach(([c,l])=>{i.set(c,{sku:c,description:l.description||l.name||c,units:l.units,sales:l.amount,cost:e.totalCost*(l.units/e.totalUnits),profit:l.profit,costPriceSource:l.costPriceSource})}):o.forEach(c=>{const l=c.sku,b=i.get(l)||{sku:l,description:c.description||l,units:0,sales:0,cost:0,profit:0};b.units+=c.quantity,b.sales+=c.sellingPrice*c.quantity;const w=0;b.cost+=w*c.quantity;const T=c.expenses.shippingFee+c.expenses.marketplaceFee+c.expenses.otherFees,v=c.sellingPrice*c.quantity-w*c.quantity-T;b.profit+=v,i.set(l,b)}),Array.from(i.values())},[o,e]),h=[{id:"sku",label:"SKU",filter:!0},{id:"description",label:"Description",filter:!0},{id:"units",label:"Units",align:"right",format:i=>String(i)},{id:"sales",label:"Sales",align:"right",format:i=>r(i)},{id:"cost",label:"Cost",align:"right",format:i=>r(i)},{id:"profit",label:"Profit",align:"right",format:i=>r(i)},{id:"costPriceSource",label:"Price Source",format:i=>{const c=i||"default";return t.jsx(j,{title:s(c),children:t.jsx(S,{size:"small",label:c.charAt(0).toUpperCase()+c.slice(1),color:a(c),variant:"outlined"})})}}];return t.jsx(W,{columns:h,data:n,defaultSortColumn:"sku",defaultSortDirection:"asc",rowsPerPageOptions:[10,25,50],defaultRowsPerPage:25})},be=({summary:o})=>{const e=o.costPriceSources||{product:0,category:0,default:0},r=e.product+e.category+e.default,a=[{label:"Total Sales",value:t.jsx(P,{value:o.totalSales}),color:"primary",icon:t.jsx($,{color:"primary",fontSize:"large"})},{label:"Total Expenses",value:t.jsx(P,{value:Math.abs(o.totalExpenses)}),color:"error",icon:t.jsx(G,{color:"error",fontSize:"large"})},{label:"Total Units Sold",value:o.totalUnits,color:"secondary",icon:t.jsx(H,{color:"secondary",fontSize:"large"})},{label:"Profit Before Cost",value:t.jsx(P,{value:o.profitBeforeCost}),color:"info",icon:t.jsx(Q,{color:"info",fontSize:"large"})},{label:"Total Cost",value:t.jsx(P,{value:o.totalCost}),color:"success",icon:t.jsx(N,{color:"success",fontSize:"large"})},{label:"Total Profit",value:t.jsx(P,{value:o.totalProfit}),color:"success",icon:t.jsx(N,{color:"success",fontSize:"large"})}];return t.jsxs(u,{container:!0,spacing:2,children:[t.jsx(u,{item:!0,xs:12,children:t.jsx(u,{container:!0,spacing:2,children:a.map((s,n)=>t.jsx(u,{item:!0,xs:12,sm:6,md:4,lg:2,children:t.jsx(I,{sx:{p:2,textAlign:"center",borderLeft:"5px solid",borderColor:s.color,boxShadow:3,"flex-grow":1,width:"100%"},children:t.jsxs(u,{container:!0,spacing:2,alignItems:"center",justifyContent:"center",children:[t.jsx(u,{item:!0,md:3,children:s.icon}),t.jsxs(u,{item:!0,children:[t.jsx(m,{variant:"subtitle1",color:"textSecondary",children:s.label}),t.jsx(m,{variant:"h5",color:s.color,children:s.value})]})]})})},n))})}),t.jsx(u,{item:!0,xs:12,children:t.jsxs(I,{sx:{p:2,boxShadow:3},children:[t.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2},children:[t.jsx(X,{color:"primary",sx:{mr:1}}),t.jsx(m,{variant:"h6",children:"Cost Price Sources"}),t.jsx(j,{title:"Shows how many products are using different cost price sources",children:t.jsx(Y,{fontSize:"small",sx:{ml:1,color:"text.secondary"}})})]}),t.jsxs(u,{container:!0,spacing:2,children:[t.jsx(u,{item:!0,children:t.jsx(j,{title:"Products with custom cost prices defined",children:t.jsx(S,{label:`Product: ${e.product}`,color:"success",sx:{fontWeight:"bold"}})})}),t.jsx(u,{item:!0,children:t.jsx(j,{title:"Products inheriting cost price from category",children:t.jsx(S,{label:`Category: ${e.category}`,color:"primary",sx:{fontWeight:"bold"}})})}),t.jsx(u,{item:!0,children:t.jsx(j,{title:"Products using default cost price (no custom or category price)",children:t.jsx(S,{label:`Default: ${e.default}`,color:"warning",sx:{fontWeight:"bold"}})})}),t.jsx(u,{item:!0,children:t.jsx(j,{title:"Total products analyzed",children:t.jsx(S,{label:`Total: ${r}`,variant:"outlined",sx:{fontWeight:"bold"}})})})]})]})})]})};class je{constructor(e){x(this,"file");x(this,"transactions",[]);x(this,"ordersData");this.file=e,this.rowToTransaction=this.rowToTransaction.bind(this),this.transformTransactions=this.transformTransactions.bind(this),this.parseCsvData=this.parseCsvData.bind(this),this.reponseAdapter=this.reponseAdapter.bind(this),this.process=this.process.bind(this)}parseCurrencyValue(e){if(!e)return 0;const r=e.replace(/[₹,\s]/g,"").trim(),a=parseFloat(r);return isNaN(a)?0:a}async parseCsvData(){this.ordersData=await new Promise((e,r)=>{de.parse(this.file,{complete:e,header:!0,skipEmptyLines:!0,beforeFirstChunk:function(a){let n=a.indexOf(`
`);for(let h=1;h<11&&n>0;++h)n=a.indexOf(`
`,n+1);return a.substring(n+1)},error:r})})}transformTransactions(){if(!this.ordersData)throw new Error("No data to transform");this.transactions=this.ordersData.data.filter(e=>e&&typeof e=="object"&&e.type).map(this.rowToTransaction).filter(e=>!!e&&!!e.type&&!!e.sku)}rowToTransaction(e){var l;const r=e.Sku||e.sku||"",a=(l=e.type)==null?void 0:l.toLowerCase();if(!a||!["order","shipped","refund"].includes(a))return null;const s=this.parseCurrencyValue(e["product sales"]),n=this.parseCurrencyValue(e["selling fees"]),h=this.parseCurrencyValue(e["fba fees"]),i=this.parseCurrencyValue(e["other transaction fees"]),c=this.parseCurrencyValue(e.total);return{transactionId:e["order id"],platform:"amazon",orderDate:e["date/time"],sku:r,quantity:Number(e.quantity)||0,sellingPrice:s,description:e.description||"",type:a,marketplace:"Amazon",total:c,productSales:e["product sales"]||"0",sellingFees:Math.abs(n).toString(),fbaFees:Math.abs(h).toString(),otherTransactionFees:Math.abs(i).toString(),other:e.other||"0",expenses:{shippingFee:0,marketplaceFee:Math.abs(n),otherFees:Math.abs(h)+Math.abs(i)},product:{name:e.description||"",sku:r,description:e.description||"",platform:"amazon",metadata:{},visibility:"visible",sellingPrice:s},metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},hash:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}}reponseAdapter(){return this.transactions}async process(){return await this.parseCsvData(),this.transformTransactions(),this.reponseAdapter()}}class Se{constructor(e){x(this,"file");x(this,"workbook");x(this,"ordersData",[]);x(this,"transactions",[]);x(this,"categoryMapping",new Map);this.file=e,this.rowToTransaction=this.rowToTransaction.bind(this),this.transformOrdersData=this.transformOrdersData.bind(this),this.parseOrdersSheet=this.parseOrdersSheet.bind(this),this.readWorkbook=this.readWorkbook.bind(this),this.reponseAdapter=this.reponseAdapter.bind(this),this.process=this.process.bind(this),this.extractCategoryInfo=this.extractCategoryInfo.bind(this)}parseCurrencyValue(e){return e?typeof e=="number"?e:Number(e.replace(/[^\d.-]/g,""))||0:0}async readWorkbook(){try{const e=await this.file.arrayBuffer();this.workbook=me(e,{type:"array"});const r="Orders P&L";if(!this.workbook.SheetNames.includes(r))throw new Error("Required sheet 'Orders P&L' not found");const a=this.workbook.Sheets[r];if(!a||D.sheet_to_json(a).length===0)throw new Error("No data found in Orders P&L sheet");this.workbook.SheetNames.includes("Categories")&&await this.extractCategoryInfo()}catch(e){throw e instanceof Error?e:new Error("Failed to read workbook")}}async extractCategoryInfo(){if(!(!this.workbook||!this.workbook.SheetNames.includes("Categories")))try{const e=this.workbook.Sheets.Categories,r=D.sheet_to_json(e);r&&r.length>0&&r.forEach(a=>{a.SKU&&a.CategoryID&&this.categoryMapping.set(a.SKU,a.CategoryID)})}catch(e){console.error("Error extracting category information:",e)}}parseOrdersSheet(){var r;const e=(r=this.workbook)==null?void 0:r.Sheets["Orders P&L"];if(!e)throw new Error("Required sheet 'Orders P&L' not found");if(this.ordersData=D.sheet_to_json(e),!this.ordersData||this.ordersData.length===0)throw new Error("No data found in Orders P&L sheet")}transformOrdersData(){if(!this.ordersData)throw new Error("No orders data to transform");this.transactions=this.ordersData.map(this.rowToTransaction).filter(e=>!!e)}getCategoryId(e){if(e["SKU Name"]&&this.categoryMapping.has(e["SKU Name"]))return this.categoryMapping.get(e["SKU Name"]);if(e["Product Category"])return e["Product Category"]}rowToTransaction(e){if(!e["Order ID"])return null;const r=this.getCategoryId(e),a=this.parseCurrencyValue(e["Final Selling Price (incl. seller opted in default offers)"]);return{transactionId:e["Order ID"],sku:e["SKU Name"],description:e["SKU Name"],platform:"flipkart",marketplace:"Flipkart",type:"delivered",orderDate:e["Order Date"],quantity:e["Gross Units"],sellingPrice:a,orderStatus:e["Order Status"],total:this.parseCurrencyValue(e["Net Earnings (INR)"]),productSales:this.parseCurrencyValue(e["Accounted Net Sales (INR)"]),accNetSales:this.parseCurrencyValue(e["Bank Settlement [Projected] (INR)"]),expenses:{shippingFee:this.parseCurrencyValue(e["Shipping Fee (INR)"]),marketplaceFee:this.parseCurrencyValue(e["Commission (INR)"]),otherFees:this.parseCurrencyValue(e["Total Expenses (INR)"])},product:{name:e["SKU Name"]||"",sku:e["SKU Name"],description:e["SKU Name"]||"",platform:"flipkart",categoryId:r,metadata:{lastImportedFrom:"flipkart",listingStatus:"active",moq:"1"},visibility:"visible",sellingPrice:a},metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},hash:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}}reponseAdapter(){return this.transactions}async process(){return await this.readWorkbook(),this.parseOrdersSheet(),this.transformOrdersData(),this.reponseAdapter()}}class Ce{constructor(e){x(this,"reportType");x(this,"file");if(!e)throw new Error("No file selected!");this.file=e,this.identify()}identify(){var e;(e=this.file)!=null&&e.name.endsWith(".xlsx")?this.reportType="Flipkart":this.reportType="Amazon"}async extract(){if(!this.file)throw new Error("No file selected!");switch(this.reportType){case"Flipkart":return await new Se(this.file).process();case"Amazon":return await new je(this.file).process();default:throw new Error("Unsupported file type")}}}const Pe=y.lazy(()=>B(()=>import("./MobileTransactionAnalytics-0XSa3Ehq.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])).then(o=>({default:o.MobileTransactionAnalytics})));function z(o){const{children:e,value:r,index:a,...s}=o;return t.jsx("div",{hidden:r!==a,...s,children:r===a&&t.jsx(g,{sx:{p:0},children:e})})}const we=()=>ue()?t.jsx(y.Suspense,{fallback:t.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:t.jsx(U,{})}),children:t.jsx(Pe,{})}):t.jsx(Te,{}),Te=()=>{var A,F;const o=he(),{items:e,loading:r,error:a}=E(p=>p.transactions),{items:s}=E(p=>p.products),[n,h]=y.useState(null),[i,c]=y.useState(0),[l,b]=y.useState({minDate:null,maxDate:null}),[w,T]=y.useState(!1),v=ce();y.useEffect(()=>{(async()=>{try{await Promise.all([o(pe()),o(fe({}))])}catch{}})()},[o]),y.useEffect(()=>{(async()=>{if(e.length>0&&s.length>0)try{T(!0);const d=new Map(s.map(f=>[f.sku.toLowerCase(),f])),C=e.map(f=>({...f,product:{...f.product,...d.get(f.sku.toLowerCase())}})),k=C.map(f=>new Date(f.orderDate));b({minDate:new Date(Math.min(...k.map(f=>f.getTime()))),maxDate:new Date(Math.max(...k.map(f=>f.getTime())))});const L=await new le(C,d).analyze();h(L)}catch(d){console.error("Error analyzing transactions:",d)}finally{T(!1)}})()},[e,s]);const R=(p,d)=>{c(d)},V=y.useMemo(()=>{if(!e.length)return[];const p=new Map;return e.forEach(d=>{d.sku&&(p.has(d.sku)||p.set(d.sku,{sku:d.sku,description:d.description||d.sku}))}),Array.from(p.values())},[e]),_=async p=>{var d;try{const C=(d=p.target.files)==null?void 0:d[0];if(!C)throw new Error("No file selected");const k=await new Ce(C).extract();await o(xe(k)).unwrap(),p.target.value=""}catch{}};return t.jsx(J,{maxWidth:!1,sx:{py:3},children:t.jsxs(I,{sx:{p:3,mb:4,borderRadius:2},children:[t.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:3},children:[t.jsx(Z,{sx:{fontSize:32,mr:2,color:"primary.main"}}),t.jsx(m,{variant:"h4",component:"h1",sx:{fontWeight:"bold",color:"primary.dark"},children:"Transaction Analytics"}),e.length>0&&t.jsx(S,{label:`${e.length} Transactions`,color:"primary",size:"medium",sx:{ml:2}}),t.jsx(g,{sx:{flexGrow:1}}),(r||w)&&t.jsxs(g,{sx:{display:"flex",alignItems:"center",mr:2},children:[t.jsx(U,{size:24,sx:{mr:1},color:"primary"}),t.jsx(m,{color:"primary.main",children:r?"Processing...":"Analyzing prices..."})]})]}),t.jsx(ee,{sx:{mb:3}}),t.jsx(te,{sx:{mb:3,borderRadius:2,border:"1px solid",borderColor:l.minDate?"info.light":"divider"},children:t.jsxs(re,{children:[t.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2},children:[t.jsx(se,{sx:{color:"info.main",mr:1}}),t.jsx(m,{variant:"h6",sx:{fontWeight:"bold",color:"info.dark"},children:l.minDate?t.jsx(t.Fragment,{children:"Transaction Period"}):t.jsx(t.Fragment,{children:"No Transactions Available"})})]}),l.minDate?t.jsxs(m,{variant:"body1",children:["Analyzing transactions from"," ",t.jsx("strong",{children:(A=l.minDate)==null?void 0:A.toDateString()})," to"," ",t.jsx("strong",{children:(F=l.maxDate)==null?void 0:F.toDateString()})]}):t.jsx(m,{variant:"body1",color:"text.secondary",children:"Upload a transaction file to begin analysis"})]})}),t.jsxs(u,{container:!0,spacing:2,sx:{mb:3},children:[t.jsx(u,{item:!0,xs:12,sm:6,children:t.jsxs(M,{variant:"contained",component:"label",disabled:r,startIcon:t.jsx(ae,{}),fullWidth:!0,sx:{py:1.5,fontWeight:"medium"},children:["Upload Transaction File",t.jsx("input",{type:"file",hidden:!0,accept:".csv,.xlsx",onChange:_})]})}),t.jsx(u,{item:!0,xs:12,sm:6,children:t.jsx(M,{variant:"contained",color:"secondary",onClick:()=>v("/products"),disabled:!V.length,startIcon:t.jsx(oe,{}),fullWidth:!0,sx:{py:1.5,fontWeight:"medium"},children:"Manage Product Prices"})})]}),a&&t.jsx(ie,{severity:"error",sx:{mb:3},children:a}),n&&t.jsxs(t.Fragment,{children:[t.jsx(be,{summary:n}),t.jsx(g,{sx:{mt:4,mb:2},children:t.jsx(g,{sx:{borderBottom:1,borderColor:"divider"},children:t.jsxs(ne,{value:i,onChange:R,sx:{"& .MuiTab-root":{fontWeight:"bold"},"& .Mui-selected":{color:"primary.main"},"& .MuiTabs-indicator":{backgroundColor:"primary.main"}},children:[t.jsx(O,{label:"Orders"}),t.jsx(O,{label:"Product Details"})]})})}),t.jsx(z,{value:i,index:0,children:t.jsx(ge,{transactions:(n==null?void 0:n.analyzedTransactions)||[]})}),t.jsx(z,{value:i,index:1,children:t.jsx(ye,{transactions:e,summary:n})})]}),!n&&!r&&t.jsxs(g,{sx:{textAlign:"center",py:5},children:[t.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No transaction data available"}),t.jsx(m,{variant:"body1",color:"text.secondary",children:"Upload a transaction file to view analytics"})]})]})})},ze=Object.freeze(Object.defineProperty({__proto__:null,TransactionAnalytics:we},Symbol.toStringTag,{value:"Module"}));export{ge as O,ye as P,Ce as R,be as S,ze as t};
