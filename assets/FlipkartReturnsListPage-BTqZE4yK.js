import{bU as ne,bV as Z,bW as We,bX as ie,j as e,s as re,bY as oe,bZ as ae,h as i,b_ as mt,al as ft,am as bt,B as h,k as W,a as vt,an as Ct,a9 as C,D as K,ai as V,c as ze,E as Rt,a3 as Fe,a$ as Ne,b4 as Qe,b1 as P,b2 as c,ap as Dt,ac as $e,aD as St,I as je,aB as Ie,at as I,bK as fe,b$ as be,a1 as ve,a2 as Ce,c0 as Tt,C as Ee,Y as Ve,Z as Mt,as as Be,A as He,ah as Ge,ab as Ke,bJ as _e,aq as kt,bd as qe,u as Pt,d as At,aK as wt,au as ce,av as de,aw as te,a_ as Ot,b0 as Ft,b3 as G,T as Et,bq as Wt}from"./mui-vendor-DlldRxor.js";import{a as l,b as Lt,i as Ye}from"./react-vendor-C0s_J9t-.js";import{H as T,aU as L,aV as w,aW as Je,i as Xe,j as Ze,F as Ue,aO as Ut,aX as se,aY as zt,aZ as Ae,a_ as Nt}from"./index-D4QRAU_W.js";import{M as Qt}from"./MobileAppShell-dHUJWRrR.js";import{M as $t}from"./MobileFAB-bvPFLu1R.js";import{M as It}from"./MobileCard-BmxjauOU.js";import{M as Vt}from"./MobileModal-BBoQbQka.js";import{u as Bt,g as Ht,a as Gt}from"./usePullToRefresh-C2FNOxJ5.js";import{D as Kt}from"./DateRangeFilter-COuz8j7O.js";import{s as we,L as _t,A as qt}from"./AdapterDateFns-Cwp-64Ap.js";import{e as Oe}from"./endOfMonth-CxaODxht.js";import"./redux-vendor-tKFe_QvA.js";import"./firebase-vendor-40dJGoDN.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-DisdNAgy.js";const De=l.createContext({});function Yt(s){return ne("MuiTimeline",s)}Z("MuiTimeline",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]);function le(s){return s==="alternate-reverse"?"positionAlternateReverse":`position${We(s)}`}const Jt=s=>{const{position:t,classes:r}=s,o={root:["root",t&&le(t)]};return ae(o,Yt,r)},Xt=re("ul",{name:"MuiTimeline",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:r}=s;return[t.root,r.position&&t[le(r.position)]]}})({display:"flex",flexDirection:"column",padding:"6px 16px",flexGrow:1}),Zt=l.forwardRef(function(t,r){const o=ie({props:t,name:"MuiTimeline"}),{position:a="right",className:y,...m}=o,p={...o,position:a},f=Jt(p),b=l.useMemo(()=>({position:a}),[a]);return e.jsx(De.Provider,{value:b,children:e.jsx(Xt,{className:oe(f.root,y),ownerState:p,ref:r,...m})})});function es(s){return ne("MuiTimelineConnector",s)}Z("MuiTimelineConnector",["root"]);const ts=s=>{const{classes:t}=s;return ae({root:["root"]},es,t)},ss=re("span",{name:"MuiTimelineConnector",slot:"Root",overridesResolver:(s,t)=>t.root})(({theme:s})=>({width:2,backgroundColor:(s.vars||s).palette.grey[400],flexGrow:1})),Re=l.forwardRef(function(t,r){const o=ie({props:t,name:"MuiTimelineConnector"}),{className:a,...y}=o,m=o,p=ts(m);return e.jsx(ss,{className:oe(p.root,a),ownerState:m,ref:r,...y})});function ns(s){return ne("MuiTimelineContent",s)}const is=Z("MuiTimelineContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]),rs=s=>{const{position:t,classes:r}=s,o={root:["root",le(t)]};return ae(o,ns,r)},os=re(i,{name:"MuiTimelineContent",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:r}=s;return[t.root,t[le(r.position)]]}})(({ownerState:s})=>({flex:1,padding:"6px 16px",textAlign:"left",...s.position==="left"&&{textAlign:"right"}})),xe=l.forwardRef(function(t,r){const o=ie({props:t,name:"MuiTimelineContent"}),{className:a,...y}=o,{position:m}=l.useContext(De),p={...o,position:m||"right"},f=rs(p);return e.jsx(os,{component:"div",className:oe(f.root,a),ownerState:p,ref:r,...y})});function as(s){return ne("MuiTimelineDot",s)}Z("MuiTimelineDot",["root","filled","outlined","filledGrey","outlinedGrey","filledPrimary","outlinedPrimary","filledSecondary","outlinedSecondary"]);const ls=s=>{const{color:t,variant:r,classes:o}=s,a={root:["root",r,t!=="inherit"&&`${r}${We(t)}`]};return ae(a,as,o)},cs=re("span",{name:"MuiTimelineDot",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:r}=s;return[t.root,t[r.color!=="inherit"&&`${r.variant}${We(r.color)}`],t[r.variant]]}})(({ownerState:s,theme:t})=>({display:"flex",alignSelf:"baseline",borderStyle:"solid",borderWidth:2,padding:4,borderRadius:"50%",boxShadow:(t.vars||t).shadows[1],margin:"11.5px 0",...s.variant==="filled"&&{borderColor:"transparent",...s.color!=="inherit"&&{...s.color==="grey"?{color:(t.vars||t).palette.grey[50],backgroundColor:(t.vars||t).palette.grey[400]}:{color:(t.vars||t).palette[s.color].contrastText,backgroundColor:(t.vars||t).palette[s.color].main}}},...s.variant==="outlined"&&{boxShadow:"none",backgroundColor:"transparent",...s.color!=="inherit"&&{...s.color==="grey"?{borderColor:(t.vars||t).palette.grey[400]}:{borderColor:(t.vars||t).palette[s.color].main}}}})),ue=l.forwardRef(function(t,r){const o=ie({props:t,name:"MuiTimelineDot"}),{className:a,color:y="grey",variant:m="filled",...p}=o,f={...o,color:y,variant:m},b=ls(f);return e.jsx(cs,{className:oe(b.root,a),ownerState:f,ref:r,...p})}),ds=Z("MuiTimelineOppositeContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]);function xs(s){return ne("MuiTimelineItem",s)}Z("MuiTimelineItem",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse","missingOppositeContent"]);const us=s=>{const{position:t,classes:r,hasOppositeContent:o}=s,a={root:["root",le(t),!o&&"missingOppositeContent"]};return ae(a,xs,r)},hs=re("li",{name:"MuiTimelineItem",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:r}=s;return[t.root,t[le(r.position)]]}})(({ownerState:s})=>({listStyle:"none",display:"flex",position:"relative",minHeight:70,...s.position==="left"&&{flexDirection:"row-reverse"},...(s.position==="alternate"||s.position==="alternate-reverse")&&{[`&:nth-of-type(${s.position==="alternate"?"even":"odd"})`]:{flexDirection:"row-reverse",[`& .${is.root}`]:{textAlign:"right"},[`& .${ds.root}`]:{textAlign:"left"}}},...!s.hasOppositeContent&&{"&::before":{content:'""',flex:1,padding:"6px 16px"}}})),he=l.forwardRef(function(t,r){const o=ie({props:t,name:"MuiTimelineItem"}),{position:a,className:y,...m}=o,{position:p}=l.useContext(De);let f=!1;l.Children.forEach(o.children,M=>{mt(M,["TimelineOppositeContent"])&&(f=!0)});const b={...o,position:a||p||"right",hasOppositeContent:f},S=us(b),F=l.useMemo(()=>({position:b.position}),[b.position]);return e.jsx(De.Provider,{value:F,children:e.jsx(hs,{className:oe(S.root,y),ownerState:b,ref:r,...m})})});function ps(s){return ne("MuiTimelineSeparator",s)}Z("MuiTimelineSeparator",["root"]);const js=s=>{const{classes:t}=s;return ae({root:["root"]},ps,t)},gs=re("div",{name:"MuiTimelineSeparator",slot:"Root",overridesResolver:(s,t)=>t.root})({display:"flex",flexDirection:"column",flex:0,alignItems:"center"}),pe=l.forwardRef(function(t,r){const o=ie({props:t,name:"MuiTimelineSeparator"}),{className:a,...y}=o,m=o,p=js(m);return e.jsx(gs,{className:oe(p.root,a),ownerState:m,ref:r,...y})}),et=({open:s,returnItem:t,onClose:r})=>{var o,a;return t?e.jsxs(ft,{open:s,onClose:r,maxWidth:"md",fullWidth:!0,children:[e.jsx(bt,{children:e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h6",children:"Return Details"}),e.jsx(W,{onClick:r,startIcon:e.jsx(vt,{}),children:"Close"})]})}),e.jsxs(Ct,{dividers:!0,children:[e.jsxs(h,{sx:{mb:3},children:[e.jsx(i,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"Order Information"}),e.jsxs(C,{container:!0,spacing:2,children:[e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Return ID"}),e.jsx(i,{variant:"body1",fontWeight:"medium",children:t.returnId})]}),e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Order ID"}),e.jsx(i,{variant:"body1",fontWeight:"medium",children:t.orderId})]}),e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"SKU"}),e.jsx(i,{variant:"body1",children:t.sku})]}),e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"FSN"}),e.jsx(i,{variant:"body1",children:t.fsn})]}),e.jsxs(C,{item:!0,xs:12,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Product Title"}),e.jsx(i,{variant:"body1",children:t.productTitle})]}),e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Quantity"}),e.jsx(i,{variant:"body1",children:t.quantity})]}),e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Order Date"}),e.jsx(i,{variant:"body1",children:T(t.dates.orderDate,"dd MMM yyyy")})]})]})]}),e.jsx(K,{sx:{my:3}}),e.jsxs(h,{sx:{mb:3},children:[e.jsx(i,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"Return Details"}),e.jsxs(C,{container:!0,spacing:2,children:[e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Return Reason"}),e.jsx(i,{variant:"body1",children:t.returnReason})]}),e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Reason Category"}),e.jsx(V,{label:t.returnReasonCategory,color:t.returnReasonCategory==="Defective"||t.returnReasonCategory==="Quality Issue"?"error":"default"})]}),e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Return Type"}),e.jsx(V,{label:t.returnType})]}),e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Return Status"}),e.jsx(V,{label:t.returnStatus,color:t.returnStatus==="Refunded"?"success":t.returnStatus==="Rejected"?"error":"primary"})]}),t.qcStatus&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"QC Status"}),e.jsx(V,{label:t.qcStatus,color:t.resaleable?"success":"default",icon:t.resaleable?e.jsx(ze,{}):e.jsx(Rt,{})})]}),e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Resaleable"}),e.jsx(i,{variant:"body1",color:t.resaleable?"success.main":"error.main",children:t.resaleable?"Yes":"No"})]})]})]})]}),e.jsx(K,{sx:{my:3}}),e.jsxs(h,{sx:{mb:3},children:[e.jsx(i,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"Return Timeline"}),e.jsxs(Zt,{children:[e.jsxs(he,{children:[e.jsxs(pe,{children:[e.jsx(ue,{color:"primary"}),e.jsx(Re,{})]}),e.jsxs(xe,{children:[e.jsx(i,{variant:"body2",fontWeight:"medium",children:"Return Initiated"}),e.jsx(i,{variant:"caption",color:"text.secondary",children:T(t.dates.returnInitiatedDate,"dd MMM yyyy, HH:mm")})]})]}),t.dates.returnApprovedDate&&e.jsxs(he,{children:[e.jsxs(pe,{children:[e.jsx(ue,{color:"success"}),e.jsx(Re,{})]}),e.jsxs(xe,{children:[e.jsx(i,{variant:"body2",fontWeight:"medium",children:"Return Approved"}),e.jsx(i,{variant:"caption",color:"text.secondary",children:T(t.dates.returnApprovedDate,"dd MMM yyyy, HH:mm")})]})]}),t.dates.pickupDate&&e.jsxs(he,{children:[e.jsxs(pe,{children:[e.jsx(ue,{color:"info"}),e.jsx(Re,{})]}),e.jsxs(xe,{children:[e.jsx(i,{variant:"body2",fontWeight:"medium",children:"Picked Up"}),e.jsx(i,{variant:"caption",color:"text.secondary",children:T(t.dates.pickupDate,"dd MMM yyyy, HH:mm")})]})]}),t.dates.returnDeliveredDate&&e.jsxs(he,{children:[e.jsxs(pe,{children:[e.jsx(ue,{color:"warning"}),e.jsx(Re,{})]}),e.jsxs(xe,{children:[e.jsx(i,{variant:"body2",fontWeight:"medium",children:"Delivered to Warehouse"}),e.jsx(i,{variant:"caption",color:"text.secondary",children:T(t.dates.returnDeliveredDate,"dd MMM yyyy, HH:mm")})]})]}),t.dates.refundProcessedDate&&e.jsxs(he,{children:[e.jsx(pe,{children:e.jsx(ue,{color:"success"})}),e.jsxs(xe,{children:[e.jsx(i,{variant:"body2",fontWeight:"medium",children:"Refund Processed"}),e.jsx(i,{variant:"caption",color:"text.secondary",children:T(t.dates.refundProcessedDate,"dd MMM yyyy, HH:mm")})]})]})]})]}),e.jsx(K,{sx:{my:3}}),e.jsxs(h,{sx:{mb:3},children:[e.jsx(i,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"Financial Breakdown"}),e.jsx(Fe,{variant:"outlined",sx:{p:2},children:e.jsx(Ne,{size:"small",children:e.jsxs(Qe,{children:[t.pricing&&e.jsxs(e.Fragment,{children:[t.pricing.sellingPrice!==void 0&&e.jsxs(P,{children:[e.jsx(c,{children:"Product Selling Price"}),e.jsxs(c,{align:"right",children:["₹",t.pricing.sellingPrice.toFixed(2)]})]}),t.pricing.costPrice!==void 0&&e.jsxs(P,{children:[e.jsx(c,{children:"Product Cost Price"}),e.jsxs(c,{align:"right",children:["₹",t.pricing.costPrice.toFixed(2)]})]}),t.pricing.profitMargin!==void 0&&e.jsxs(P,{children:[e.jsx(c,{children:"Product Profit Margin"}),e.jsxs(c,{align:"right",sx:{color:t.pricing.profitMargin>=0?"success.main":"error.main"},children:["₹",t.pricing.profitMargin.toFixed(2)]})]}),e.jsx(P,{children:e.jsx(c,{colSpan:2,children:e.jsx(K,{sx:{my:1}})})})]}),e.jsxs(P,{children:[e.jsx(c,{children:"Refund Amount"}),e.jsxs(c,{align:"right",children:["₹",t.financials.refundAmount.toFixed(2)]})]}),e.jsxs(P,{children:[e.jsx(c,{children:"Reverse Pickup Charges"}),e.jsxs(c,{align:"right",children:["₹",t.financials.reversePickupCharges.toFixed(2)]})]}),e.jsxs(P,{children:[e.jsx(c,{children:"Commission Reversal"}),e.jsxs(c,{align:"right",sx:{color:"success.main"},children:["-₹",t.financials.commissionReversal.toFixed(2)]})]}),t.financials.restockingFee>0&&e.jsxs(P,{children:[e.jsx(c,{children:"Restocking Fee"}),e.jsxs(c,{align:"right",children:["₹",t.financials.restockingFee.toFixed(2)]})]}),e.jsxs(P,{children:[e.jsx(c,{children:"Settlement Amount"}),e.jsxs(c,{align:"right",children:["₹",t.financials.settlementAmount.toFixed(2)]})]}),e.jsxs(P,{children:[e.jsx(c,{children:e.jsx(i,{variant:"body1",fontWeight:"bold",children:"Net Loss"})}),e.jsx(c,{align:"right",children:e.jsxs(i,{variant:"body1",fontWeight:"bold",color:t.financials.netLoss>0?"error":"success",children:["₹",t.financials.netLoss.toFixed(2)]})})]})]})})})]}),(((o=t.location)==null?void 0:o.returnLocation)||((a=t.location)==null?void 0:a.warehouseLocation))&&e.jsxs(e.Fragment,{children:[e.jsx(K,{sx:{my:3}}),e.jsxs(h,{children:[e.jsx(i,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"Location Information"}),e.jsxs(C,{container:!0,spacing:2,children:[t.location.returnLocation&&e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Return Location"}),e.jsx(i,{variant:"body1",children:t.location.returnLocation})]}),t.location.warehouseLocation&&e.jsxs(C,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Warehouse Location"}),e.jsx(i,{variant:"body1",children:t.location.warehouseLocation})]})]})]})]})]}),e.jsx(Dt,{children:e.jsx(W,{onClick:r,variant:"contained",children:"Close"})})]}):null},ys=({returnItem:s,onView:t})=>{const r=()=>{const a=s.returnReasonCategory;return a===L.DEFECTIVE||a===L.QUALITY_ISSUE?"error":a===L.DAMAGED||a===L.WRONG_ITEM?"warning":"default"},o=()=>{const a=s.returnStatus;return a===w.REFUNDED?"success":a===w.REJECTED||a===w.CANCELLED?"error":a===w.APPROVED||a===w.QC_COMPLETED?"primary":"default"};return e.jsx(It,{contentPadding:2,sx:{mb:1.5,border:"1px solid",borderColor:"divider","&:active":{bgcolor:"action.selected"}},children:e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsxs(h,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"subtitle2",fontWeight:"bold",noWrap:!0,children:s.returnId}),e.jsxs(i,{variant:"caption",color:"text.secondary",noWrap:!0,children:["Order: ",s.orderId]})]}),s.resaleable&&e.jsx(V,{icon:e.jsx(ze,{}),label:"Resaleable",size:"small",color:"success",sx:{ml:1,height:24,fontSize:"0.7rem"}})]}),e.jsx(i,{variant:"body2",sx:{mb:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:s.productTitle}),e.jsxs(h,{sx:{display:"flex",gap:2,mb:1},children:[e.jsxs(i,{variant:"caption",color:"text.secondary",children:["SKU: ",e.jsx("strong",{children:s.sku})]}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:["Qty: ",e.jsx("strong",{children:s.quantity})]})]}),e.jsxs($e,{direction:"row",spacing:.5,sx:{mb:1.5,flexWrap:"wrap",gap:.5},children:[e.jsx(V,{label:s.returnReasonCategory,size:"small",color:r(),sx:{height:24,fontSize:"0.7rem"}}),e.jsx(V,{label:s.returnStatus,size:"small",color:o(),variant:"outlined",sx:{height:24,fontSize:"0.7rem"}})]}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(St,{sx:{fontSize:16,color:"error.main"}}),e.jsxs(i,{variant:"body2",fontWeight:"bold",color:"error.main",children:["₹",s.financials.netLoss.toLocaleString(void 0,{maximumFractionDigits:0})]})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:T(s.dates.returnInitiatedDate,"dd MMM yy")}),e.jsx(je,{size:"small",onClick:()=>t(s.returnId),sx:{minWidth:40,minHeight:40},"aria-label":`View details for return ${s.returnId}`,children:e.jsx(Ie,{fontSize:"small"})})]})]})]})})},ms=({open:s,onClose:t,statusFilter:r,reasonFilter:o,qcFilter:a,resaleableOnly:y,onApply:m,onClear:p})=>{const[f,b]=l.useState(r),[S,F]=l.useState(o),[M,U]=l.useState(a),[k,z]=l.useState(y);Lt.useEffect(()=>{b(r),F(o),U(a),z(y)},[r,o,a,y]);const O=()=>{m({status:f,reason:S,qc:M,resaleableOnly:k}),t()},_=()=>{b([]),F([]),U([]),z(!1),p(),t()},N=x=>{b(j=>j.includes(x)?j.filter(E=>E!==x):[...j,x])},q=x=>{F(j=>j.includes(x)?j.filter(E=>E!==x):[...j,x])},Q=x=>{U(j=>j.includes(x)?j.filter(E=>E!==x):[...j,x])};return e.jsx(Vt,{open:s,onClose:t,title:"Filter Returns",children:e.jsxs(h,{sx:{pb:2,px:2},children:[e.jsxs($e,{direction:"row",spacing:2,sx:{width:"100%",mb:3},children:[e.jsx(W,{variant:"outlined",onClick:_,fullWidth:!0,children:"Clear All"}),e.jsx(W,{variant:"contained",onClick:O,fullWidth:!0,children:"Apply Filters"})]}),e.jsxs(I,{component:"fieldset",sx:{width:"100%",mb:2},children:[e.jsx(fe,{component:"legend",sx:{mb:1,fontWeight:"bold"},children:"Return Status"}),e.jsx(be,{children:Object.values(w).map(x=>e.jsx(ve,{control:e.jsx(Ce,{checked:f.includes(x),onChange:()=>N(x),sx:{"& .MuiSvgIcon-root":{fontSize:28}}}),label:x,sx:{minHeight:48}},x))})]}),e.jsx(K,{sx:{my:2}}),e.jsxs(I,{component:"fieldset",sx:{width:"100%",mb:2},children:[e.jsx(fe,{component:"legend",sx:{mb:1,fontWeight:"bold"},children:"Return Reason"}),e.jsx(be,{children:Object.values(L).map(x=>e.jsx(ve,{control:e.jsx(Ce,{checked:S.includes(x),onChange:()=>q(x),sx:{"& .MuiSvgIcon-root":{fontSize:28}}}),label:x,sx:{minHeight:48}},x))})]}),e.jsx(K,{sx:{my:2}}),e.jsxs(I,{component:"fieldset",sx:{width:"100%",mb:2},children:[e.jsx(fe,{component:"legend",sx:{mb:1,fontWeight:"bold"},children:"QC Status"}),e.jsx(be,{children:Object.values(Je).map(x=>e.jsx(ve,{control:e.jsx(Ce,{checked:M.includes(x),onChange:()=>Q(x),sx:{"& .MuiSvgIcon-root":{fontSize:28}}}),label:x,sx:{minHeight:48}},x))})]}),e.jsx(K,{sx:{my:2}}),e.jsxs(I,{component:"fieldset",sx:{width:"100%"},children:[e.jsx(fe,{component:"legend",sx:{mb:1,fontWeight:"bold"},children:"Additional Filters"}),e.jsx(be,{children:e.jsx(ve,{control:e.jsx(Ce,{checked:k,onChange:x=>z(x.target.checked),sx:{"& .MuiSvgIcon-root":{fontSize:28}}}),label:"Resaleable Only",sx:{minHeight:48}})})]})]})})},fs=()=>{const s=Xe(),t=Ye(),r=Ut(),{filteredReturns:o,loading:a,error:y}=Ze(d=>d.flipkartReturns),[m,p]=l.useState(!1),[f,b]=l.useState(""),[S,F]=l.useState([]),[M,U]=l.useState([]),[k,z]=l.useState([]),[O,_]=l.useState(!1),[N,q]=l.useState(null),[Q,x]=l.useState(!1),{state:j,containerRef:E}=Bt(async()=>{await s(Ue()).unwrap()},{threshold:80,enabled:!0}),Y=[f!==""?1:0,S.length>0?1:0,M.length>0?1:0,k.length>0?1:0,O?1:0].reduce((d,$)=>d+$,0);l.useEffect(()=>{s(Ue())},[s]);const ge=d=>{F(d.status),U(d.reason),z(d.qc),_(d.resaleableOnly),s(se({searchQuery:f||void 0,status:d.status.length>0?d.status:void 0,returnReasonCategory:d.reason.length>0?d.reason:void 0,qcStatus:d.qc.length>0?d.qc:void 0,resaleableOnly:d.resaleableOnly||void 0}))},Se=()=>{b(""),F([]),U([]),z([]),_(!1),s(zt())},ye=d=>{b(d),s(se({searchQuery:d||void 0,status:S.length>0?S:void 0,returnReasonCategory:M.length>0?M:void 0,qcStatus:k.length>0?k:void 0,resaleableOnly:O||void 0}))},Te=d=>{const $=o.find(g=>g.returnId===d);$&&(q($),x(!0))},me=()=>{const d=["Return ID","Order ID","SKU","Product Title","Reason","Status","QC Status","Refund Amount","Net Loss","Return Date","Resaleable"],$=o.map(D=>[D.returnId,D.orderId,D.sku,D.productTitle,D.returnReasonCategory,D.returnStatus,D.qcStatus||"",D.financials.refundAmount,D.financials.netLoss,T(D.dates.returnInitiatedDate,"yyyy-MM-dd"),D.resaleable?"Yes":"No"]),g=[d.join(","),...$.map(D=>D.map(Pe=>`"${String(Pe).replace(/"/g,'""')}"`).join(","))].join(`
`),Me=new Blob([g],{type:"text/csv;charset=utf-8;"}),R=document.createElement("a"),ke=URL.createObjectURL(Me);R.setAttribute("href",ke),R.setAttribute("download",`flipkart-returns-${T(new Date,"yyyy-MM-dd")}.csv`),R.style.visibility="hidden",document.body.appendChild(R),R.click(),document.body.removeChild(R)};return e.jsxs(Qt,{pageTitle:"Returns",showBackButton:!1,topBarActions:e.jsxs(e.Fragment,{children:[e.jsx(je,{color:"inherit",onClick:()=>t("/flipkart-returns/analytics"),disabled:o.length===0,"aria-label":"View analytics",children:e.jsx(Ke,{})}),e.jsx(je,{color:"inherit",onClick:me,disabled:o.length===0,"aria-label":"Export CSV",children:e.jsx(_e,{})}),e.jsx(je,{color:"inherit",onClick:()=>p(!0),"aria-label":"Open filters",children:e.jsx(kt,{badgeContent:Y,color:"error",children:e.jsx(qe,{})})})]}),children:[e.jsx(h,{sx:{position:"absolute",top:r.top,left:"50%",transform:"translateX(-50%)",zIndex:1100,pointerEvents:"none",...Ht(j.pullDistance)},children:j.pullDistance>0&&(j.isPulling&&!j.isRefreshing?e.jsx(Tt,{sx:{fontSize:32,color:"primary.main",transform:`rotate(${Gt(j.progress,j.shouldRefresh)}deg)`,transition:"transform 0.2s"}}):e.jsx(Ee,{size:32}))}),e.jsxs(h,{ref:E,sx:{flex:1,overflow:"auto",px:2,pt:2,pb:`calc(${r.bottom}px + 80px)`},children:[e.jsx(Ve,{fullWidth:!0,placeholder:"Search by Return ID, Order ID, SKU, or Product",value:f,onChange:d=>ye(d.target.value),size:"small",sx:{mb:2},InputProps:{startAdornment:e.jsx(Mt,{position:"start",children:e.jsx(Be,{})})}}),e.jsx(h,{sx:{mb:2},children:e.jsxs(i,{variant:"body2",color:"text.secondary",children:[o.length," return",o.length!==1?"s":"",Y>0&&` (${Y} filter${Y!==1?"s":""} active)`]})}),y&&e.jsx(He,{severity:"error",sx:{mb:2},children:y}),a&&o.length===0&&e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Ee,{})}),!a&&o.length===0&&e.jsxs(h,{sx:{textAlign:"center",py:6},children:[e.jsx(i,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"No returns found"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:Y>0?"Try adjusting your filters":"Upload returns to get started"})]}),o.map(d=>e.jsx(ys,{returnItem:d,onView:Te},d.returnId))]}),e.jsx($t,{"aria-label":"Upload Returns",onClick:()=>t("/flipkart-returns/upload"),color:"primary",children:e.jsx(Ge,{})}),e.jsx(ms,{open:m,onClose:()=>p(!1),statusFilter:S,reasonFilter:M,qcFilter:k,resaleableOnly:O,onApply:ge,onClear:Se}),e.jsx(et,{open:Q,returnItem:N,onClose:()=>{x(!1),q(null)}})]})},Ls=()=>{const s=Pt();if(At(s.breakpoints.down("sm")))return e.jsx(fs,{});const r=Xe(),o=Ye(),{filteredReturns:a,loading:y,error:m,filters:p}=Ze(n=>n.flipkartReturns),[f,b]=l.useState(0),[S,F]=l.useState(25),[M,U]=l.useState(""),[k,z]=l.useState([]),[O,_]=l.useState([]),[N,q]=l.useState([]),[Q,x]=l.useState([]),[j,E]=l.useState(!1),[Y,ge]=l.useState(null),[Se,ye]=l.useState(!1),[Te,me]=l.useState(null),[d,$]=l.useState({startDate:we(new Date),endDate:Oe(new Date)}),[g,Me]=l.useState("returnId"),[R,ke]=l.useState("desc");l.useEffect(()=>{const n=we(new Date),u=Oe(new Date);r(Ae({startDate:n,endDate:u})).then(()=>{r(se({dateRange:{start:n,end:u}}))})},[r]);const D=()=>{r(se({searchQuery:M||void 0,status:k.length>0?k:void 0,returnType:O.length>0?O:void 0,returnReasonCategory:N.length>0?N:void 0,qcStatus:Q.length>0?Q:void 0,resaleableOnly:j||void 0,dateRange:{start:d.startDate,end:d.endDate}})),b(0)},Pe=(n,u)=>{$({startDate:n,endDate:u})},tt=n=>{me(n.currentTarget)},st=()=>{me(null),r(Ae({startDate:d.startDate,endDate:d.endDate})).then(()=>{r(se({searchQuery:M||void 0,status:k.length>0?k:void 0,returnType:O.length>0?O:void 0,returnReasonCategory:N.length>0?N:void 0,qcStatus:Q.length>0?Q:void 0,resaleableOnly:j||void 0,dateRange:{start:d.startDate,end:d.endDate}}))})},nt=()=>{U(""),z([]),_([]),q([]),x([]),E(!1);const n={startDate:we(new Date),endDate:Oe(new Date)};$(n),r(Ae({startDate:n.startDate,endDate:n.endDate})).then(()=>{r(se({dateRange:{start:n.startDate,end:n.endDate}}))}),b(0)},it=n=>{const u=n.target.value;z(typeof u=="string"?[]:u)},rt=n=>{const u=n.target.value;_(typeof u=="string"?[]:u)},ot=n=>{const u=n.target.value;q(typeof u=="string"?[]:u)},at=n=>{const u=n.target.value;x(typeof u=="string"?[]:u)},lt=(n,u)=>{b(u)},ct=n=>{F(parseInt(n.target.value,10)),b(0)},dt=n=>{const u=a.find(H=>H.returnId===n);u&&(ge(u),ye(!0))},xt=()=>{ye(!1),ge(null)},ut=()=>{const n=["Return ID","Order ID","SKU","Product Title","Selling Price","Reason","Type","Status","Reverse Pickup Charges","Commission Reversal","Completion Date","Resaleable"],u=a.map(v=>{var X;return[v.returnId,v.orderId,v.sku,v.productTitle,((X=v.pricing)==null?void 0:X.sellingPrice)!==void 0?v.pricing.sellingPrice:"N/A",v.returnReasonCategory,v.returnType,v.returnStatus,v.financials.reversePickupCharges,v.financials.commissionReversal,v.dates.returnDeliveredDate?T(v.dates.returnDeliveredDate,"yyyy-MM-dd"):"-",v.resaleable?"Yes":"No"]}),H=[n.join(","),...u.map(v=>v.map(X=>`"${String(X).replace(/"/g,'""')}"`).join(","))].join(`
`),ee=new Blob([H],{type:"text/csv;charset=utf-8;"}),A=document.createElement("a"),J=URL.createObjectURL(ee);A.setAttribute("href",J),A.setAttribute("download",`flipkart-returns-${T(new Date,"yyyy-MM-dd")}.csv`),A.style.visibility="hidden",document.body.appendChild(A),A.click(),document.body.removeChild(A)},B=n=>{ke(g===n&&R==="asc"?"desc":"asc"),Me(n)},ht=(n,u)=>(H,ee)=>{var v,X;let A,J;if(u==="completionDate")A=H.dates.returnDeliveredDate?new Date(H.dates.returnDeliveredDate).getTime():0,J=ee.dates.returnDeliveredDate?new Date(ee.dates.returnDeliveredDate).getTime():0;else if(u==="sellingPrice")A=((v=H.pricing)==null?void 0:v.sellingPrice)||0,J=((X=ee.pricing)==null?void 0:X.sellingPrice)||0;else{const gt=H,yt=ee;A=gt[u]||"",J=yt[u]||""}return J<A?n==="desc"?-1:1:J>A?n==="desc"?1:-1:0},pt=n=>{switch(n){case w.REFUNDED:return"success";case w.REJECTED:case w.CANCELLED:return"error";case w.APPROVED:case w.QC_COMPLETED:return"primary";default:return"default"}},jt=n=>n===L.DEFECTIVE||n===L.QUALITY_ISSUE?"error":n===L.DAMAGED||n===L.WRONG_ITEM?"warning":"default",Le=[...a].sort(ht(R,g)).slice(f*S,f*S+S);return e.jsx(_t,{dateAdapter:qt,children:e.jsxs(h,{sx:{p:3},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(i,{variant:"h4",children:"Flipkart Returns"}),e.jsxs(h,{sx:{display:"flex",gap:2},children:[e.jsxs(W,{variant:"outlined",startIcon:e.jsx(wt,{}),onClick:tt,sx:{textTransform:"none"},children:[T(d.startDate,"dd MMM yyyy")," - ",T(d.endDate,"dd MMM yyyy")]}),e.jsx(W,{variant:"outlined",startIcon:e.jsx(Ke,{}),onClick:()=>o("/flipkart-returns/analytics"),disabled:a.length===0,children:"Analytics"}),e.jsx(W,{variant:"contained",startIcon:e.jsx(Ge,{}),onClick:()=>o("/flipkart-returns/upload"),children:"Upload Returns"}),e.jsx(W,{variant:"outlined",startIcon:e.jsx(_e,{}),onClick:ut,disabled:a.length===0,children:"Export CSV"})]})]}),m&&e.jsx(He,{severity:"error",sx:{mb:2},children:m}),e.jsxs(Fe,{sx:{p:2,mb:2},children:[e.jsxs(h,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[e.jsx(Ve,{label:"Search",placeholder:"Return ID, Order ID, SKU, or Product",value:M,onChange:n=>U(n.target.value),onKeyPress:n=>n.key==="Enter"&&D(),size:"small",sx:{minWidth:300},InputProps:{endAdornment:e.jsx(Be,{})}}),e.jsxs(I,{size:"small",sx:{minWidth:150},children:[e.jsx(ce,{children:"Status"}),e.jsx(de,{multiple:!0,value:k,onChange:it,label:"Status",renderValue:n=>`${n.length} selected`,children:Object.values(w).map(n=>e.jsx(te,{value:n,children:n},n))})]}),e.jsxs(I,{size:"small",sx:{minWidth:150},children:[e.jsx(ce,{children:"Return Type"}),e.jsx(de,{multiple:!0,value:O,onChange:rt,label:"Return Type",renderValue:n=>`${n.length} selected`,children:Object.values(Nt).map(n=>e.jsx(te,{value:n,children:n},n))})]}),e.jsxs(I,{size:"small",sx:{minWidth:150},children:[e.jsx(ce,{children:"Reason"}),e.jsx(de,{multiple:!0,value:N,onChange:ot,label:"Reason",renderValue:n=>`${n.length} selected`,children:Object.values(L).map(n=>e.jsx(te,{value:n,children:n},n))})]}),e.jsxs(I,{size:"small",sx:{minWidth:150},children:[e.jsx(ce,{children:"QC Status"}),e.jsx(de,{multiple:!0,value:Q,onChange:at,label:"QC Status",renderValue:n=>`${n.length} selected`,children:Object.values(Je).map(n=>e.jsx(te,{value:n,children:n},n))})]}),e.jsxs(I,{size:"small",sx:{minWidth:150},children:[e.jsx(ce,{children:"Resaleable"}),e.jsxs(de,{value:j?"yes":"all",onChange:n=>E(n.target.value==="yes"),label:"Resaleable",children:[e.jsx(te,{value:"all",children:"All"}),e.jsx(te,{value:"yes",children:"Resaleable Only"})]})]}),e.jsx(W,{variant:"contained",onClick:D,startIcon:e.jsx(qe,{}),children:"Apply Filters"}),e.jsx(W,{variant:"outlined",onClick:nt,children:"Clear"})]}),(p.searchQuery||p.status||p.returnReasonCategory||p.qcStatus||p.resaleableOnly)&&e.jsx(h,{sx:{mt:2},children:e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Showing ",a.length," of ",a.length," returns"]})})]}),y&&e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Ee,{})}),!y&&e.jsxs(e.Fragment,{children:[e.jsx(Ot,{component:Fe,children:e.jsxs(Ne,{size:"small",children:[e.jsx(Ft,{children:e.jsxs(P,{children:[e.jsx(c,{children:e.jsx(G,{active:g==="returnId",direction:g==="returnId"?R:"asc",onClick:()=>B("returnId"),children:"Return ID"})}),e.jsx(c,{children:e.jsx(G,{active:g==="orderId",direction:g==="orderId"?R:"asc",onClick:()=>B("orderId"),children:"Order ID"})}),e.jsx(c,{children:e.jsx(G,{active:g==="sku",direction:g==="sku"?R:"asc",onClick:()=>B("sku"),children:"SKU"})}),e.jsx(c,{children:e.jsx(G,{active:g==="productTitle",direction:g==="productTitle"?R:"asc",onClick:()=>B("productTitle"),children:"Product"})}),e.jsx(c,{align:"right",children:e.jsx(G,{active:g==="sellingPrice",direction:g==="sellingPrice"?R:"asc",onClick:()=>B("sellingPrice"),children:"Selling Price"})}),e.jsx(c,{children:e.jsx(G,{active:g==="returnReasonCategory",direction:g==="returnReasonCategory"?R:"asc",onClick:()=>B("returnReasonCategory"),children:"Reason"})}),e.jsx(c,{children:e.jsx(G,{active:g==="returnStatus",direction:g==="returnStatus"?R:"asc",onClick:()=>B("returnStatus"),children:"Status"})}),e.jsx(c,{children:e.jsx(G,{active:g==="completionDate",direction:g==="completionDate"?R:"asc",onClick:()=>B("completionDate"),children:"Completion Date"})}),e.jsx(c,{align:"center",children:"Actions"})]})}),e.jsx(Qe,{children:Le.length===0?e.jsx(P,{children:e.jsx(c,{colSpan:9,align:"center",children:e.jsx(i,{variant:"body2",color:"text.secondary",sx:{py:4},children:"No returns found. Try adjusting your filters or upload a returns file."})})}):Le.map(n=>{var u;return e.jsxs(P,{hover:!0,children:[e.jsx(c,{children:n.returnId}),e.jsx(c,{children:n.orderId}),e.jsx(c,{children:n.sku}),e.jsx(c,{children:e.jsx(i,{variant:"body2",noWrap:!0,sx:{maxWidth:250},children:n.productTitle})}),e.jsx(c,{align:"right",children:((u=n.pricing)==null?void 0:u.sellingPrice)!==void 0?`₹${n.pricing.sellingPrice.toFixed(2)}`:e.jsx(i,{variant:"body2",color:"text.secondary",children:"N/A"})}),e.jsx(c,{children:e.jsx(V,{label:n.returnReasonCategory,size:"small",color:jt(n.returnReasonCategory)})}),e.jsx(c,{children:e.jsx(V,{label:n.returnStatus,size:"small",color:pt(n.returnStatus)})}),e.jsx(c,{children:n.dates.returnDeliveredDate?T(n.dates.returnDeliveredDate,"dd MMM yyyy"):e.jsx(i,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(c,{align:"center",children:e.jsx(Et,{title:"View Details",children:e.jsx(je,{size:"small",onClick:()=>dt(n.returnId),children:e.jsx(Ie,{fontSize:"small"})})})})]},n.returnId)})})]})}),e.jsx(Wt,{rowsPerPageOptions:[10,25,50,100],component:"div",count:a.length,rowsPerPage:S,page:f,onPageChange:lt,onRowsPerPageChange:ct})]}),e.jsx(et,{open:Se,returnItem:Y,onClose:xt}),e.jsx(Kt,{dateRange:d,onDateRangeChange:Pe,anchorEl:Te,onClose:st})]})})};export{Ls as default};
