import{u as E,cl as te,br as se,j as e,B as s,h as i,I as L,c as le,a2 as ae,ai as m,bS as oe,bT as ne,bd as $,D as A,at as re,au as ie,av as ce,aw as M,k as R,ar as de,c0 as pe,C as H,aq as P,A as xe,bN as he,bO as fe,w as me,bP as ue,b as ge}from"./mui-vendor-DlldRxor.js";import{a as u,i as be}from"./react-vendor-C0s_J9t-.js";import{M as je}from"./MobileAppShell-dHUJWRrR.js";import{M as ye}from"./MobileDatePicker-CdEtDmOk.js";import{M as Ce}from"./MobileFAB-bvPFLu1R.js";import{M as Se}from"./MobileCard-BmxjauOU.js";import{i as N,j as d,aO as K,a5 as ke,a8 as ve,a7 as Fe,a6 as Be,a4 as we,bh as Oe,H as O,a2 as T,a3 as I,B as W}from"./index-D4QRAU_W.js";import{u as ze,g as Ie,a as De}from"./usePullToRefresh-C2FNOxJ5.js";import"./AdapterDateFns-Cwp-64Ap.js";import"./endOfMonth-CxaODxht.js";import"./redux-vendor-tKFe_QvA.js";import"./firebase-vendor-40dJGoDN.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-DisdNAgy.js";const Ae=({order:l,onComplete:g,onTap:y,className:b})=>{const x=E(),o=l.isCompleted===!0,h=k=>{k.stopPropagation(),g&&!o&&g(l)},j=()=>{y&&y(l)},n={amazon:{label:"Amazon",color:"#FF9900",icon:se},flipkart:{label:"Flipkart",color:"#2874F0",icon:te}}[l.type],C=n.icon;return e.jsx(Se,{onClick:j,className:b,sx:{minHeight:88,opacity:o?.6:1,cursor:y?"pointer":"default",transition:"opacity 0.2s ease",position:"relative",...o&&{backgroundColor:x.palette.action.hover}},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1,p:2},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:1},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,fontSize:"16px",flex:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.3,textDecoration:o?"line-through":"none"},children:l.name}),o?e.jsx(L,{disabled:!0,sx:{minWidth:44,minHeight:44,color:x.palette.success.main},"aria-label":"Order completed",children:e.jsx(le,{})}):e.jsx(ae,{checked:!1,onChange:h,disabled:!g,sx:{minWidth:44,minHeight:44,"& .MuiSvgIcon-root":{fontSize:28}},"aria-label":"Mark order as complete"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(s,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[l.SKU&&e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"14px"},children:[e.jsx("strong",{children:"SKU:"})," ",l.SKU]}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"14px",fontWeight:600},children:[e.jsx("strong",{children:"Qty:"})," ",l.quantity]})]}),e.jsxs(s,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap",mt:.5},children:[e.jsx(m,{icon:e.jsx(C,{sx:{fontSize:"16px"}}),label:n.label,size:"small",sx:{backgroundColor:n.color,color:"#ffffff",fontWeight:600,fontSize:"12px",height:28,"& .MuiChip-icon":{color:"#ffffff"}}}),l.batchInfo&&e.jsx(m,{label:`Batch: ${l.batchInfo.batchId.slice(0,8)}`,size:"small",variant:"outlined",sx:{fontSize:"12px",height:28}}),l.category&&e.jsx(m,{label:l.category,size:"small",variant:"outlined",color:"primary",sx:{fontSize:"12px",height:28}})]}),o&&l.completedAt&&e.jsxs(i,{variant:"caption",color:"text.secondary",sx:{fontSize:"12px",mt:.5},children:["Completed: ",new Date(l.completedAt).toLocaleString()]})]})]})})},Me=({open:l,onClose:g,onOpen:y})=>{const b=N(),x=K(),o=d(a=>a.orders.platformFilter),h=d(a=>a.orders.batchFilter),j=d(a=>a.orders.completionFilter),w=d(a=>a.orders.batches),[n,C]=u.useState(o),[k,p]=u.useState(h),[f,F]=u.useState(j);u.useEffect(()=>{C(o),p(h),F(j)},[o,h,j]);const B=()=>{b(ve(n)),b(Fe(k)),b(Be(f)),g()},z=()=>{C("all"),p(null),F("all"),b(ke())},v=a=>{C(a)},c=a=>{F(a)};return e.jsx(oe,{anchor:"bottom",open:l,onClose:g,onOpen:y,swipeAreaWidth:20,disableSwipeToOpen:!1,transitionDuration:300,sx:{"& .MuiDrawer-paper":{borderTopLeftRadius:16,borderTopRightRadius:16,paddingBottom:x.bottom,maxHeight:"80vh"}},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",minHeight:400,maxHeight:"80vh"},children:[e.jsx(s,{sx:{display:"flex",justifyContent:"center",pt:1,pb:.5},children:e.jsx(ne,{sx:{color:"text.disabled",fontSize:32}})}),e.jsx(s,{sx:{px:2,py:1},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($,{}),e.jsx(i,{variant:"h6",children:"Filter Orders"})]})}),e.jsx(A,{}),e.jsxs(s,{sx:{flex:1,overflow:"auto",px:2,py:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(s,{children:[e.jsx(i,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Platform"}),e.jsxs(s,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(m,{label:"All",onClick:()=>v("all"),color:n==="all"?"primary":"default",variant:n==="all"?"filled":"outlined",sx:{minHeight:44,px:2,fontSize:"14px"}}),e.jsx(m,{label:"Amazon",onClick:()=>v("amazon"),color:n==="amazon"?"primary":"default",variant:n==="amazon"?"filled":"outlined",sx:{minHeight:44,px:2,fontSize:"14px"}}),e.jsx(m,{label:"Flipkart",onClick:()=>v("flipkart"),color:n==="flipkart"?"primary":"default",variant:n==="flipkart"?"filled":"outlined",sx:{minHeight:44,px:2,fontSize:"14px"}})]})]}),e.jsx(s,{children:e.jsxs(re,{fullWidth:!0,children:[e.jsx(ie,{id:"batch-filter-label",children:"Batch"}),e.jsxs(ce,{labelId:"batch-filter-label",value:k||"",label:"Batch",onChange:a=>p(a.target.value||null),sx:{minHeight:56},children:[e.jsx(M,{value:"",children:e.jsx("em",{children:"All Batches"})}),w.map(a=>e.jsxs(M,{value:a.batchId,children:[a.fileName," (",new Date(a.uploadedAt).toLocaleDateString(),")"]},a.batchId))]})]})}),e.jsxs(s,{children:[e.jsx(i,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Status"}),e.jsxs(s,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(m,{label:"All",onClick:()=>c("all"),color:f==="all"?"primary":"default",variant:f==="all"?"filled":"outlined",sx:{minHeight:44,px:2,fontSize:"14px"}}),e.jsx(m,{label:"Pending",onClick:()=>c("pending"),color:f==="pending"?"warning":"default",variant:f==="pending"?"filled":"outlined",sx:{minHeight:44,px:2,fontSize:"14px"}}),e.jsx(m,{label:"Completed",onClick:()=>c("completed"),color:f==="completed"?"success":"default",variant:f==="completed"?"filled":"outlined",sx:{minHeight:44,px:2,fontSize:"14px"}})]})]})]}),e.jsx(A,{}),e.jsxs(s,{sx:{display:"flex",gap:2,p:2},children:[e.jsx(R,{variant:"outlined",onClick:z,fullWidth:!0,sx:{minHeight:48,fontSize:"16px"},children:"Clear"}),e.jsx(R,{variant:"contained",onClick:B,fullWidth:!0,sx:{minHeight:48,fontSize:"16px"},children:"Apply"})]})]})})},Je=()=>{const l=N(),g=be(),y=E(),b=K(),x=d(we),o=d(Oe),h=d(t=>t.orders.loading),j=d(t=>t.orders.error),w=d(t=>t.orders.batches),n=d(t=>t.orders.platformFilter),C=d(t=>t.orders.completionFilter),k=d(t=>t.orders.batchFilter),[p,f]=u.useState(new Date),[F,B]=u.useState(!1),[z,v]=u.useState([]),{state:c,containerRef:a}=ze(async()=>{await U()},{threshold:80,enabled:!0}),D=[n!=="all"?1:0,k!==null?1:0,C!=="all"?1:0].reduce((t,r)=>t+r,0);u.useEffect(()=>{if(p){const t=O(p,"yyyy-MM-dd");l(T(t)),l(I(t))}else l(W()),l(I(O(new Date,"yyyy-MM-dd")))},[l,p]),u.useEffect(()=>{o&&Object.keys(o).length>0&&v(Object.keys(o))},[o]);const U=async()=>{if(p){const t=O(p,"yyyy-MM-dd");await Promise.all([l(T(t)).unwrap(),l(I(t)).unwrap()])}else await l(W()).unwrap()},q=t=>{t&&f(t)},Q=t=>{console.log("Complete order:",t)},G=t=>{console.log("Tap order:",t)},J=()=>{g("/todays-orders/scanner")},V=t=>{v(r=>r.includes(t)?r.filter(S=>S!==t):[...r,t])},X=t=>{if(t==="no-batch")return"No Batch";const r=w.find(S=>S.batchId===t);return r?r.fileName:`Batch ${t.slice(0,8)}`},Y=t=>{var r;return((r=o[t])==null?void 0:r.length)||0},Z=Ie(c.pullDistance),_=De(c.progress,c.shouldRefresh);return e.jsx(je,{pageTitle:"Today's Orders",children:e.jsxs(s,{ref:a,sx:{display:"flex",flexDirection:"column",flex:1,overflow:"auto",backgroundColor:"background.default"},children:[c.isPulling&&e.jsx(s,{sx:{position:"absolute",top:0,left:0,right:0,display:"flex",justifyContent:"center",paddingTop:b.top,zIndex:1,pointerEvents:"none"},style:Z,children:e.jsx(s,{sx:{display:"flex",alignItems:"center",gap:1,p:1,backgroundColor:"background.paper",borderRadius:2,boxShadow:2},children:c.shouldRefresh?e.jsxs(e.Fragment,{children:[e.jsx(de,{sx:{color:"primary.main"}}),e.jsx(i,{variant:"body2",color:"primary",children:"Release to refresh"})]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{sx:{color:"text.secondary",transform:`rotate(${_}deg)`,transition:"transform 0.2s"}}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"Pull to refresh"})]})})}),c.isRefreshing&&e.jsx(s,{sx:{position:"sticky",top:0,display:"flex",justifyContent:"center",p:2,backgroundColor:"background.paper",zIndex:1},children:e.jsx(H,{size:24})}),e.jsxs(s,{sx:{position:"sticky",top:c.isRefreshing?56:0,zIndex:1,backgroundColor:"background.paper",borderBottom:`1px solid ${y.palette.divider}`,px:2,py:2},children:[e.jsx(s,{sx:{mb:2},children:e.jsx(ye,{value:p,onChange:q,label:"Order Date",showTodayButton:!0})}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(i,{variant:"h6",sx:{fontWeight:600},children:[x.length," ",x.length===1?"Order":"Orders"]}),e.jsx(L,{onClick:()=>B(!0),sx:{minWidth:44,minHeight:44},"aria-label":"Open filters",children:e.jsx(P,{badgeContent:D,color:"primary",children:e.jsx($,{})})})]})]}),j&&e.jsx(xe,{severity:"error",sx:{m:2},children:j}),h&&!c.isRefreshing&&e.jsx(s,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(H,{})}),!h&&x.length===0&&e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,p:4,textAlign:"center"},children:[e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No orders found"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:D>0?"Try adjusting your filters":`No orders for ${O(p,"MMM dd, yyyy")}`})]}),!h&&x.length>0&&e.jsx(s,{sx:{px:2,py:2},children:Object.entries(o).map(([t,r])=>e.jsxs(he,{expanded:z.includes(t),onChange:()=>V(t),elevation:0,sx:{mb:2,"&:before":{display:"none"},backgroundColor:"transparent"},children:[e.jsx(fe,{expandIcon:e.jsx(me,{}),sx:{backgroundColor:"background.paper",borderRadius:2,minHeight:56,"&.Mui-expanded":{borderBottomLeftRadius:0,borderBottomRightRadius:0}},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",pr:1},children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},children:X(t)}),e.jsx(P,{badgeContent:Y(t),color:"primary"})]})}),e.jsx(ue,{sx:{backgroundColor:"background.paper",borderBottomLeftRadius:2,borderBottomRightRadius:2,pt:0,pb:2,px:0},children:e.jsx(s,{sx:{display:"flex",flexDirection:"column",gap:2,px:2},children:r.map((S,ee)=>e.jsx(Ae,{order:S,onComplete:Q,onTap:G},`${S.name}-${S.SKU}-${ee}`))})})]},t))}),e.jsx(Me,{open:F,onClose:()=>B(!1),onOpen:()=>B(!0)}),e.jsx(Ce,{onClick:J,position:"bottom-right",bottomOffset:80,"aria-label":"Open barcode scanner",children:e.jsx(ge,{})})]})})};export{Je as MobileTodaysOrdersPage,Je as default};
