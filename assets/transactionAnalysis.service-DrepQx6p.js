var C=Object.defineProperty;var g=(n,e,s)=>e in n?C(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var d=(n,e,s)=>g(n,typeof e!="symbol"?e+"":e,s);class m{constructor(e,s){d(this,"transactions");d(this,"productPrices");this.transactions=e.filter(r=>!!r&&!!r.type),this.productPrices=s}isExpense(e){return e?["adjustment","refund","service fee","shipping services","returned","return_requested"].includes(e.toLowerCase()):!1}isSale(e){return e?["order","delivered","in_transit","return_cancelled"].includes(e.toLowerCase()):!1}getCostPrice(){return 0}async analyze(){var r;const e={totalSales:0,totalExpenses:0,expensesByCategory:{},salesByProduct:{},totalProfit:0,totalUnits:0,totalCost:0,profitBeforeCost:0,costPriceSources:{product:0,category:0,default:0},analyzedTransactions:[]},s=[];for(const t of this.transactions){const a=t.type||"",i=t.sku,u=t.quantity,P=t.sellingPrice,p=t.total||0;if(s.push({...t}),this.isExpense(a)){const c=a==null?void 0:a.toLowerCase(),l=t.expenses.shippingFee+t.expenses.marketplaceFee+t.expenses.otherFees;e.expensesByCategory[c]=(e.expensesByCategory[c]||0)+l,e.totalExpenses+=l}if(this.isSale(a)){e.totalSales+=P;const c=t.expenses.shippingFee+t.expenses.marketplaceFee+t.expenses.otherFees;e.totalExpenses+=c;const l=0;if(!e.salesByProduct[i]){const f=(r=this.productPrices)==null?void 0:r.get(i.toLowerCase());e.salesByProduct[i]={units:0,amount:0,profit:0,profitPerUnit:0,name:(f==null?void 0:f.name)||i,costPriceSource:"default"}}const o=e.salesByProduct[i];o.units+=u,o.amount+=p,e.totalUnits+=u;const y=l*u;e.totalCost+=y;const x=p-y;o.profit+=x,o.units>0&&(o.profitPerUnit=o.profit/o.units),e.profitBeforeCost+=p,e.totalProfit+=x}}return e.analyzedTransactions=s,e}}export{m as T};
