import{j as e,B as o,k as P,aF as E,h as a,ai as O,p as he,D as pe,r as ue,ci as fe,o as me,cj as ge,I as Y,aO as je,al as ye,am as be,a as ve,an as Fe,A,a1 as Ce,ck as De,i as Pe,C as B,aK as we,ag as T,c as ke,aB as Ie,S as G}from"./mui-vendor-DlldRxor.js";import{a as x,b as ze}from"./react-vendor-C0s_J9t-.js";import{M as Se}from"./MobileAppShell-dHUJWRrR.js";import{M as U}from"./MobileCard-BmxjauOU.js";import{M as Ae}from"./MobileDatePicker-CdEtDmOk.js";import{u as Me}from"./usePullToRefresh-C2FNOxJ5.js";import{i as We,j as $,z as Re,H as Be,A as K,I as _,J as N,G as Te,K as Q,L as J,M as Ue,N as $e,O as Ee,Q as Oe,R as He,S as Le}from"./index-D4QRAU_W.js";import{d as Ve,p as Ge}from"./pdfStorageService-DGuhzLre.js";import"./AdapterDateFns-Cwp-64Ap.js";import"./endOfMonth-CxaODxht.js";import"./redux-vendor-tKFe_QvA.js";import"./firebase-vendor-40dJGoDN.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-DisdNAgy.js";const Ke=({amazonFiles:s,flipkartFiles:i,onAmazonAdd:c,onFlipkartAdd:n,onAmazonRemove:p,onFlipkartRemove:m,onAmazonClear:w,onFlipkartClear:u})=>{const y=x.useRef(null),h=x.useRef(null),k=t=>{const l=t.target.files;if(l){for(let d=0;d<l.length;d++)c(l[d]);t.target.value=""}},I=t=>{const l=t.target.files;if(l){for(let d=0;d<l.length;d++)n(l[d]);t.target.value=""}},b=t=>t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`,v=(t,l,d,z)=>t.length===0?null:e.jsxs(o,{sx:{mt:2},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(a,{variant:"body2",color:"text.secondary",children:[t.length," ",t.length===1?"file":"files"," selected"]}),t.length>1&&e.jsx(O,{label:"Clear All",size:"small",color:"error",variant:"outlined",onClick:d,sx:{height:24}})]}),e.jsx(he,{dense:!0,sx:{backgroundColor:"background.paper",borderRadius:1},children:t.map((F,f)=>e.jsxs(ze.Fragment,{children:[f>0&&e.jsx(pe,{}),e.jsxs(ue,{sx:{py:1,px:2,minHeight:48},children:[e.jsx(fe,{sx:{mr:2,color:`${z}.main`,fontSize:20}}),e.jsx(me,{primary:e.jsx(a,{variant:"body2",sx:{fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:F.name}),secondary:e.jsx(a,{variant:"caption",color:"text.secondary",children:b(F.size)})}),e.jsx(ge,{children:e.jsx(Y,{edge:"end","aria-label":"delete",onClick:()=>l(f),size:"small",sx:{minWidth:44,minHeight:44},children:e.jsx(je,{fontSize:"small",color:"error"})})})]})]},f))})]});return e.jsxs(o,{children:[e.jsxs(o,{sx:{mb:2},children:[e.jsx("input",{ref:y,type:"file",accept:"application/pdf",multiple:!0,onChange:k,style:{display:"none"},id:"amazon-file-input"}),e.jsx(P,{variant:"outlined",color:"primary",fullWidth:!0,onClick:()=>{var t;return(t=y.current)==null?void 0:t.click()},startIcon:e.jsx(E,{}),sx:{py:1.5,textTransform:"none",fontWeight:600,borderWidth:2,"&:hover":{borderWidth:2}},children:"Upload Amazon PDFs"}),v(s,p,w,"primary")]}),e.jsxs(o,{children:[e.jsx("input",{ref:h,type:"file",accept:"application/pdf",multiple:!0,onChange:I,style:{display:"none"},id:"flipkart-file-input"}),e.jsx(P,{variant:"outlined",color:"secondary",fullWidth:!0,onClick:()=>{var t;return(t=h.current)==null?void 0:t.click()},startIcon:e.jsx(E,{}),sx:{py:1.5,textTransform:"none",fontWeight:600,borderWidth:2,"&:hover":{borderWidth:2}},children:"Upload Flipkart PDFs"}),v(i,m,u,"secondary")]})]})},_e=({open:s,onClose:i,pdfUrl:c})=>e.jsxs(ye,{open:s,onClose:i,fullScreen:!0,sx:{"& .MuiDialog-paper":{backgroundColor:"background.default"}},children:[e.jsxs(be,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:1,borderColor:"divider",py:1.5},children:[e.jsx(a,{variant:"h6",sx:{fontWeight:600},children:"PDF Preview"}),e.jsx(Y,{edge:"end",onClick:i,"aria-label":"close",sx:{minWidth:44,minHeight:44},children:e.jsx(ve,{})})]}),e.jsxs(Fe,{sx:{p:0,display:"flex",flexDirection:"column"},children:[e.jsx(A,{severity:"info",sx:{m:2,borderRadius:2},children:e.jsx(a,{variant:"body2",children:"Tap and hold to save the PDF to your device, or use the share button in your browser."})}),e.jsx(o,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"auto",backgroundColor:"#525659"},children:c?e.jsx("iframe",{src:c,title:"PDF Preview",style:{width:"100%",height:"100%",border:"none",flex:1}}):e.jsx(o,{sx:{display:"flex",alignItems:"center",justifyContent:"center",flex:1},children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"No PDF available to preview"})})})]})]}),Ne=({enabled:s,onChange:i,disabled:c=!1})=>e.jsx(o,{sx:{p:2,backgroundColor:"background.paper",borderRadius:1,border:1,borderColor:"divider"},children:e.jsx(Ce,{control:e.jsx(Pe,{checked:s,onChange:n=>i(n.target.checked),disabled:c,color:"primary"}),label:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(De,{sx:{fontSize:20}}),e.jsxs(o,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:600},children:"Enable Barcodes"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Include barcodes in the generated PDF"})]})]}),sx:{m:0,width:"100%"}})}),ct=()=>{const s=We(),{amazonFiles:i,flipkartFiles:c,finalPdf:n,summary:p,loading:m,error:w,selectedDate:u,enableBarcodes:y}=$(r=>r.pdfMerger),{categories:h,items:k}=$(r=>r.products),I=$(Re),[b,v]=x.useState(!1),[t,l]=x.useState(null),[d,z]=x.useState(!1),[F,f]=x.useState(null),[H,C]=x.useState(void 0),[L,S]=x.useState(void 0),{state:q,containerRef:X}=Me(async()=>{await Promise.all([s(K({})).unwrap(),s(_()).unwrap()])},{threshold:80,enabled:!0});x.useEffect(()=>{(async()=>{k.length===0&&await s(K({})).unwrap(),h.length===0&&await s(_()).unwrap()})().catch(console.error)},[s,k.length,h.length]),x.useEffect(()=>{if(!n||b||t||!I||n===F)return;f(n);const r=async()=>{var V;try{if(!n)return;const ce=await(await fetch(n)).blob(),de=`sorted_labels_${new Date().toISOString().replace(/[:.-]/g,"_")}.pdf`,xe={...Ve,expiryDays:7,description:`Auto-saved PDF with ${p.length} products across ${h.filter(R=>!!R.name).length} categories`},D=await Ge.uploadPdfForDate(ce,de,u,{categoryCount:h.length,productCount:p.length,sortConfig:N,description:`Auto-saved PDF with ${p.length} products across ${h.filter(R=>!!R.name).length} categories`},xe);D.success?(l(D),S("PDF saved to cloud successfully!")):(console.error("Error auto-uploading PDF:",D.error),(V=D.error)!=null&&V.includes("authenticated")||C(D.error||"Failed to auto-save PDF"))}catch(j){console.error("Error auto-uploading PDF:",j),j instanceof Error&&j.message.includes("authenticated")||C(j instanceof Error?j.message:"Failed to auto-save PDF")}};v(!0),r().finally(()=>{v(!1)})},[n,b,t,p.length,h,I,F,u]);const Z=async()=>{if(!(i.length===0&&c.length===0)){l(null),f(null);try{await s(Le({amazonFiles:i,flipkartFiles:c,sortConfig:N,selectedDate:u,enableBarcodes:y})).unwrap(),s(J()),s(Q()),S("PDF generated successfully!")}catch(r){console.error(r),C("Failed to generate PDF. Please try again.")}}},ee=r=>{s(Oe(r)),g()},te=r=>{s(Ee(r)),g()},se=r=>{s($e(r)),g()},re=r=>{s(Ue(r)),g()},oe=()=>{s(J()),g()},ae=()=>{s(Q()),g()},g=()=>{l(null),f(null)},ne=r=>{r&&s(Te(r))},le=r=>{s(He(r))},ie=()=>{z(!0)},M=i.length+c.length,W=M>0;return e.jsx(Se,{pageTitle:"PDF Merger",children:e.jsxs(o,{ref:X,sx:{display:"flex",flexDirection:"column",flex:1,overflow:"auto",backgroundColor:"background.default",px:2,py:2},children:[q.isRefreshing&&e.jsx(o,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(B,{size:24})}),e.jsxs(U,{sx:{mb:2},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(we,{sx:{mr:1,color:"primary.main"}}),e.jsx(a,{variant:"h6",sx:{fontWeight:600},children:"Processing Date"})]}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Choose the date for processing PDF files. Orders will be saved to this date."}),e.jsx(Ae,{label:"Processing Date",value:u,onChange:ne,minDate:new Date}),e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Orders will be saved to ",Be(u,"MMMM dd, yyyy")]})]}),e.jsxs(U,{sx:{mb:2},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(T,{sx:{mr:1,color:"primary.main"}}),e.jsx(a,{variant:"h6",sx:{fontWeight:600},children:"Upload PDF Files"})]}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Upload PDF files from Amazon and/or Flipkart. The tool will merge them into a unified PDF document."}),e.jsx(Ke,{amazonFiles:i,flipkartFiles:c,onAmazonAdd:ee,onFlipkartAdd:te,onAmazonRemove:se,onFlipkartRemove:re,onAmazonClear:oe,onFlipkartClear:ae}),W&&e.jsxs(o,{sx:{mt:2,p:2,backgroundColor:"primary.light",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(a,{variant:"body2",sx:{fontWeight:600},children:[M," file",M!==1?"s":""," selected"]}),e.jsx(O,{label:`${i.length} Amazon | ${c.length} Flipkart`,size:"small",color:"primary"})]}),e.jsx(o,{sx:{mt:2},children:e.jsx(Ne,{enabled:y,onChange:le,disabled:m})}),e.jsx(P,{variant:"contained",color:"primary",size:"large",fullWidth:!0,disabled:!W||m,onClick:Z,startIcon:m?e.jsx(B,{size:20}):e.jsx(T,{}),sx:{mt:3,py:1.5,borderRadius:2,textTransform:"none",fontWeight:600,fontSize:"1rem"},children:m?"Processing...":"Generate PDF"}),w&&e.jsx(A,{severity:"error",sx:{mt:2},children:w})]}),n&&e.jsxs(U,{sx:{mb:2,borderColor:"success.main",backgroundColor:"success.lightest"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ke,{sx:{color:"success.main",mr:1}}),e.jsx(a,{variant:"h6",sx:{fontWeight:600,color:"success.main"},children:"PDF Ready!"})]}),e.jsx(O,{label:`${p.length} Products`,color:"success",size:"small"})]}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Your PDF has been generated and saved to cloud storage."}),e.jsxs(o,{sx:{display:"flex",gap:1},children:[e.jsx(P,{variant:"outlined",color:"primary",fullWidth:!0,onClick:ie,startIcon:e.jsx(Ie,{}),sx:{textTransform:"none",fontWeight:600},children:"View PDF"}),(t==null?void 0:t.downloadUrl)&&e.jsx(P,{variant:"contained",color:"primary",fullWidth:!0,component:"a",href:t.downloadUrl,download:!0,startIcon:e.jsx(E,{}),sx:{textTransform:"none",fontWeight:600},children:"Download"})]}),b&&e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mt:2,gap:1},children:[e.jsx(B,{size:16}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Saving to cloud..."})]})]}),!W&&e.jsxs(o,{sx:{textAlign:"center",py:4,color:"text.secondary"},children:[e.jsx(T,{sx:{fontSize:48,opacity:.3,mb:1}}),e.jsx(a,{variant:"body2",children:"Upload Amazon or Flipkart PDF files to get started"})]}),n&&e.jsx(_e,{open:d,onClose:()=>z(!1),pdfUrl:n}),e.jsx(G,{open:!!L,autoHideDuration:3e3,onClose:()=>S(void 0),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(A,{onClose:()=>S(void 0),severity:"success",sx:{width:"100%"},children:L})}),e.jsx(G,{open:!!H,autoHideDuration:6e3,onClose:()=>C(void 0),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(A,{onClose:()=>C(void 0),severity:"error",sx:{width:"100%"},children:H})})]})})};export{ct as MobileHomePage};
