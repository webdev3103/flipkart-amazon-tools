import{j as e,al as Ge,am as We,B as o,h as s,an as $e,a9 as A,a1 as oe,a2 as xt,at as ae,au as ye,av as pe,aw as Z,ai as R,bh as mt,Y as N,a3 as X,k as K,v as yt,w as Se,x as Pe,V as ne,ay as se,A as le,W as re,p as we,r as Te,o as Ae,T as B,D as Ye,ap as De,C as ie,bE as Je,bF as pt,I as V,ar as Xe,aE as et,ax as tt,bG as rt,a as Fe,aZ as Re,bb as gt,bc as Ue,bH as jt,bI as ft,a_ as vt,a$ as bt,b0 as It,b1 as de,b2 as q,b3 as ue,b4 as Ct,bq as kt,S as nt,b8 as be,be as St,u as st,bd as wt,bJ as Tt,q as _e,bK as At,bL as zt,bM as ke,aF as Mt,i as Oe,aC as ot,c as me,E as te,bN as qe,bO as Ne,bP as Ve,ah as at,aT as ze,bQ as Gt,ba as Wt,ad as $t,aD as Pt,ac as Dt,bk as Ft,aX as Rt,aY as He,N as Lt}from"./mui-vendor-DlldRxor.js";import{a as g,b as ve}from"./react-vendor-C0s_J9t-.js";import{i as ee,j as F,o as Ie,aa as lt,aA as Ce,m as Le,ai as it,t as ge,aB as J,aC as Bt,aD as Me,n as ct,aE as Et,aF as Ut,aG as _t,aH as Ot,aI as qt,p as Nt,aJ as Qe,aK as Vt,aL as Ht,u as Qt,aM as Kt,aN as Zt}from"./index-D4QRAU_W.js";import{u as dt,c as ut,b as Yt,d as Jt,e as ht,a as xe}from"./index.esm-HlV1qfyK.js";import{I as he}from"./InventoryStatusChip-Dd2kFZgD.js";import{D as Xt}from"./DataTable-CqcHOsap.js";import{L as er,A as tr,D as Ke}from"./AdapterDateFns-Cwp-64Ap.js";import{M as rr}from"./MobileAppShell-dHUJWRrR.js";import"./redux-vendor-tKFe_QvA.js";import"./firebase-vendor-40dJGoDN.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-DisdNAgy.js";import"./endOfMonth-CxaODxht.js";const nr=ut({categoryGroupId:xe().when("bulkMode",{is:!1,then:t=>t.required("Category Group is required"),otherwise:t=>t}),newThreshold:ht().required("Threshold is required").min(0,"Threshold must be non-negative").test("reasonable-threshold","Threshold seems unreasonably high",function(t){return t&&t>1e4?this.createError({message:"Threshold above 10,000 units seems excessive. Please verify."}):!0}),bulkMode:Jt(),selectedCategoryGroups:Yt().when("bulkMode",{is:!0,then:t=>t.min(1,"Select at least one category group for bulk update"),otherwise:t=>t})}),Ze=(t,p)=>t<=0?"zero_stock":t<0?"negative_stock":t<=p?"low_stock":"healthy",sr=(t,p)=>{const x=t/p;return x<=0?"high":x<=.5?"medium":"low"},or=({open:t,onClose:p,onSuccess:x,selectedCategoryGroupId:C})=>{const u=ee(),I=F(Ie),k=F(lt),j=F(Ce),z=F(Le),[M,c]=g.useState(!1),[v,l]=g.useState([]),[$,m]=g.useState(!1),[T,P]=g.useState(!1),r=dt({initialValues:{categoryGroupId:C||"",newThreshold:0,bulkMode:!1,selectedCategoryGroups:[]},validationSchema:nr,onSubmit:async i=>{try{if($&&!T){P(!0);return}const G=(i.bulkMode?i.selectedCategoryGroups:[i.categoryGroupId]).map(y=>u(it({id:y,groupData:{minimumThreshold:i.newThreshold}})).unwrap());await Promise.all(G),await u(ge()).unwrap(),u(J()),h(),x==null||x()}catch(d){console.error("Failed to update thresholds:",d)}}});g.useEffect(()=>{t&&(I.length===0&&!k&&u(ge()),j.length===0&&!z.inventoryLevels&&u(J()))},[t,I.length,k,j.length,z.inventoryLevels,u]),g.useEffect(()=>{C&&r.values.categoryGroupId!==C&&r.setFieldValue("categoryGroupId",C)},[C]),g.useEffect(()=>{r.values.newThreshold>0&&n()},[r.values.newThreshold,r.values.categoryGroupId,r.values.selectedCategoryGroups,r.values.bulkMode]);const n=()=>{const d=(r.values.bulkMode?r.values.selectedCategoryGroups:[r.values.categoryGroupId].filter(Boolean)).map(y=>{const b=I.find(L=>L.id===y),a=j.find(L=>L.categoryGroupId===y);if(!b||!a)return null;const w=Ze(a.currentInventory,a.minimumThreshold),D=Ze(a.currentInventory,r.values.newThreshold),H=r.values.newThreshold>a.currentInventory,ce=sr(a.currentInventory,r.values.newThreshold);return{categoryGroupId:y,categoryGroupName:b.name,currentLevel:a.currentInventory,currentThreshold:a.minimumThreshold,newThreshold:r.values.newThreshold,unit:a.inventoryUnit,currentStatus:w,newStatus:D,wouldTriggerAlert:H,alertSeverity:ce}}).filter(Boolean);l(d);const G=d.some(y=>y.wouldTriggerAlert);m(G),P(!1)},h=()=>{r.resetForm(),c(!1),l([]),m(!1),P(!1),p()},W=i=>{r.setFieldValue("bulkMode",i),i?r.setFieldValue("categoryGroupId",""):r.setFieldValue("selectedCategoryGroups",[])},_=()=>{if(r.values.bulkMode)return null;const i=I.find(d=>d.id===r.values.categoryGroupId);return(i==null?void 0:i.minimumThreshold)||null},O=()=>r.values.bulkMode?null:j.find(i=>i.categoryGroupId===r.values.categoryGroupId)||null,E=v.filter(i=>i.wouldTriggerAlert).length,Q=_(),f=O();return e.jsx(Ge,{open:t,onClose:h,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:e.jsxs("form",{onSubmit:r.handleSubmit,children:[e.jsx(We,{children:e.jsxs(o,{children:[e.jsx(s,{variant:"h6",fontWeight:"bold",children:"Configure Inventory Thresholds"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Set minimum inventory thresholds that trigger automatic alerts when stock levels are low"})]})}),e.jsx($e,{dividers:!0,children:e.jsxs(A,{container:!0,spacing:3,children:[e.jsxs(A,{item:!0,xs:12,children:[e.jsx(oe,{control:e.jsx(xt,{checked:r.values.bulkMode,onChange:i=>W(i.target.checked)}),label:"Bulk Update Mode"}),e.jsx(s,{variant:"caption",color:"text.secondary",display:"block",children:"Enable to set the same threshold for multiple category groups"})]}),!r.values.bulkMode&&e.jsx(A,{item:!0,xs:12,children:e.jsxs(ae,{fullWidth:!0,error:r.touched.categoryGroupId&&!!r.errors.categoryGroupId,children:[e.jsx(ye,{children:"Category Group *"}),e.jsx(pe,{name:"categoryGroupId",value:r.values.categoryGroupId,onChange:r.handleChange,onBlur:r.handleBlur,label:"Category Group *",disabled:k,children:I.map(i=>{const d=j.find(G=>G.categoryGroupId===i.id);return e.jsx(Z,{value:i.id,children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,width:"100%",children:[e.jsx(o,{sx:{width:16,height:16,backgroundColor:i.color,borderRadius:"50%"}}),e.jsx(s,{children:i.name}),e.jsxs(o,{sx:{ml:"auto",display:"flex",gap:1},children:[e.jsx(R,{label:`${i.currentInventory} ${i.inventoryUnit}`,size:"small",variant:"outlined"}),d&&e.jsx(he,{status:d.status,size:"small"})]})]})},i.id)})}),r.touched.categoryGroupId&&r.errors.categoryGroupId&&e.jsx(s,{variant:"caption",color:"error",sx:{mt:1,ml:2},children:r.errors.categoryGroupId})]})}),r.values.bulkMode&&e.jsx(A,{item:!0,xs:12,children:e.jsx(mt,{multiple:!0,options:I,getOptionLabel:i=>i.name,value:I.filter(i=>r.values.selectedCategoryGroups.includes(i.id||"")),onChange:(i,d)=>{r.setFieldValue("selectedCategoryGroups",d.map(G=>G.id).filter(Boolean))},renderInput:i=>e.jsx(N,{...i,label:"Select Category Groups *",error:r.touched.selectedCategoryGroups&&!!r.errors.selectedCategoryGroups,helperText:r.touched.selectedCategoryGroups&&r.errors.selectedCategoryGroups}),renderOption:(i,d)=>{const G=j.find(y=>y.categoryGroupId===d.id);return e.jsx("li",{...i,children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,width:"100%",children:[e.jsx(o,{sx:{width:16,height:16,backgroundColor:d.color,borderRadius:"50%"}}),e.jsx(s,{children:d.name}),e.jsxs(o,{sx:{ml:"auto",display:"flex",gap:1},children:[e.jsx(R,{label:`${d.currentInventory} ${d.inventoryUnit}`,size:"small",variant:"outlined"}),G&&e.jsx(he,{status:G.status,size:"small"})]})]})})},disabled:k})}),!r.values.bulkMode&&Q!==null&&f&&e.jsx(A,{item:!0,xs:12,children:e.jsxs(X,{sx:{p:2,bgcolor:"grey.30"},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Current Configuration"}),e.jsxs(o,{display:"flex",flexWrap:"wrap",gap:2,children:[e.jsxs(o,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Current Inventory"}),e.jsxs(s,{variant:"h6",children:[f.currentInventory," ",f.inventoryUnit]})]}),e.jsxs(o,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Current Threshold"}),e.jsxs(s,{variant:"body1",children:[Q," ",f.inventoryUnit]})]}),e.jsxs(o,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Current Status"}),e.jsx(he,{status:f.status})]})]})]})}),e.jsx(A,{item:!0,xs:12,sm:6,children:e.jsx(N,{fullWidth:!0,label:"New Minimum Threshold",name:"newThreshold",type:"number",value:r.values.newThreshold,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.newThreshold&&!!r.errors.newThreshold,helperText:r.touched.newThreshold&&r.errors.newThreshold,inputProps:{min:0,step:"any"},InputProps:{endAdornment:!r.values.bulkMode&&f&&e.jsx(s,{variant:"body2",color:"text.secondary",sx:{ml:1},children:f.inventoryUnit})}})}),e.jsx(A,{item:!0,xs:12,sm:6,children:e.jsx(o,{display:"flex",alignItems:"center",height:"100%",children:e.jsx(K,{variant:"outlined",onClick:()=>c(!M),disabled:!r.values.newThreshold||v.length===0,startIcon:M?e.jsx(yt,{}):e.jsx(Se,{}),fullWidth:!0,sx:{height:"56px"},children:M?"Hide Preview":"Preview Impact"})})}),e.jsx(A,{item:!0,xs:12,children:e.jsx(Pe,{in:M,children:e.jsx(ne,{sx:{mt:2},children:e.jsxs(se,{children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:"Threshold Impact Analysis"}),E>0&&e.jsx(le,{severity:"warning",sx:{mb:2,"& .MuiAlert-message":{color:"rgba(51, 51, 51, 1)"},"& .MuiAlert-icon":{color:"rgba(51, 51, 51, 1)"},backgroundColor:"rgba(255, 248, 225, 1)",border:"2px solid rgba(255, 193, 7, 1)"},children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(re,{sx:{color:"rgba(51, 51, 51, 1)"}}),e.jsxs(s,{sx:{color:"rgba(51, 51, 51, 1)",fontWeight:500},children:["This threshold will trigger immediate alerts for ",E," category group",E>1?"s":""]})]})}),e.jsx(we,{children:v.map((i,d)=>e.jsxs(ve.Fragment,{children:[e.jsx(Te,{children:e.jsx(Ae,{primary:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(s,{variant:"subtitle2",children:i.categoryGroupName}),i.wouldTriggerAlert&&e.jsx(B,{title:`Would trigger ${i.alertSeverity} severity alert`,children:e.jsx(re,{color:i.alertSeverity==="high"?"error":i.alertSeverity==="medium"?"warning":"info",fontSize:"small"})})]}),secondary:e.jsxs(A,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(A,{item:!0,xs:12,sm:4,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Current Level"}),e.jsxs(s,{variant:"body2",children:[i.currentLevel," ",i.unit]})]}),e.jsxs(A,{item:!0,xs:12,sm:4,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Threshold Change"}),e.jsxs(s,{variant:"body2",children:[i.currentThreshold," → ",i.newThreshold," ",i.unit]})]}),e.jsxs(A,{item:!0,xs:12,sm:4,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Status Change"}),e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(he,{status:i.currentStatus,size:"small"}),e.jsx(s,{variant:"caption",children:"→"}),e.jsx(he,{status:i.newStatus,size:"small"})]})]})]})})}),d<v.length-1&&e.jsx(Ye,{})]},i.categoryGroupId))})]})})})}),T&&e.jsx(A,{item:!0,xs:12,children:e.jsxs(le,{severity:"warning",sx:{"& .MuiAlert-message":{color:"rgba(51, 51, 51, 1)"},"& .MuiAlert-icon":{color:"rgba(51, 51, 51, 1)"},backgroundColor:"rgba(255, 248, 225, 1)",border:"2px solid rgba(255, 193, 7, 1)"},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,sx:{color:"rgba(51, 51, 51, 1)",fontWeight:600},children:"Confirmation Required"}),e.jsxs(s,{variant:"body2",sx:{color:"rgba(51, 51, 51, 1)",fontWeight:500},children:["The new threshold will trigger immediate alerts for ",E," category group",E>1?"s":"",". This means the current inventory levels are below the new threshold you're setting."]}),e.jsx(s,{variant:"body2",sx:{mt:1,color:"rgba(51, 51, 51, 1)",fontWeight:500},children:"Are you sure you want to proceed? These alerts will be created immediately."})]})})]})}),e.jsxs(De,{sx:{p:2},children:[e.jsx(K,{onClick:h,disabled:k,children:"Cancel"}),T?e.jsxs(e.Fragment,{children:[e.jsx(K,{onClick:()=>P(!1),color:"inherit",children:"Back"}),e.jsx(K,{type:"submit",variant:"contained",color:"warning",disabled:k,children:k?e.jsx(ie,{size:20}):"Confirm & Update Thresholds"})]}):e.jsx(K,{type:"submit",variant:"contained",disabled:k||!r.isValid||!r.dirty,children:k?e.jsx(ie,{size:20}):"Update Threshold"+(r.values.bulkMode&&r.values.selectedCategoryGroups.length>1?"s":"")})]})]})})},ar=48,lr=8,ir={PaperProps:{style:{maxHeight:ar*4.5+lr,width:250}}},cr=({filters:t={},onFilterChange:p,onClearFilters:x,inventoryLevels:C=[],onThresholdConfigSuccess:u,onRefresh:I})=>{const[k,j]=g.useState((t==null?void 0:t.searchTerm)||""),[z,M]=g.useState(!1),c=[{value:"healthy",label:"Healthy",color:"#2e7d32"},{value:"low_stock",label:"Low Stock",color:"#e65100"},{value:"zero_stock",label:"Zero Stock",color:"#c62828"},{value:"negative_stock",label:"Negative",color:"#6a1b9a"}],v=[{value:"kg",label:"Kilogram (kg)"},{value:"g",label:"Gram (g)"},{value:"pcs",label:"Pieces (pcs)"}],l=[{value:"weight",label:"Weight-based"},{value:"qty",label:"Quantity-based"}],$=f=>{const i=f.target.value;j(i),p({searchTerm:i||void 0})},m=f=>{const i=f.target.value,d=typeof i=="string"?i.split(","):i,G={lowStock:d.includes("low_stock"),zeroStock:d.includes("zero_stock"),negativeStock:d.includes("negative_stock"),healthyStock:d.includes("healthy")};d.length===0&&(G.lowStock=void 0,G.zeroStock=void 0,G.negativeStock=void 0,G.healthyStock=void 0),p(G)},T=f=>{const i=f.target.value;p({unit:i||void 0})},P=f=>{const i=f.target.value;p({inventoryType:i||void 0})},r=()=>{j(""),x()},n=()=>{I==null||I()},h=()=>{M(!0)},W=()=>{M(!1)},_=()=>{M(!1),u==null||u()},O=()=>{const i=[["Category Group Name","Current Inventory","Unit","Inventory Type","Minimum Threshold","Status","Last Updated"].join(","),...C.map(b=>[`"${b.name}"`,b.currentInventory,b.inventoryUnit,b.inventoryType,b.minimumThreshold,b.status,b.lastInventoryUpdate?new Date(b.lastInventoryUpdate.toDate()).toISOString():"Never"].join(","))].join(`
`),d=new Blob([i],{type:"text/csv;charset=utf-8;"}),G=document.createElement("a"),y=URL.createObjectURL(d);G.setAttribute("href",y),G.setAttribute("download",`inventory-levels-${new Date().toISOString().split("T")[0]}.csv`),G.style.visibility="hidden",document.body.appendChild(G),G.click(),document.body.removeChild(G)},E=()=>{const f=[];return t.lowStock&&f.push("low_stock"),t.zeroStock&&f.push("zero_stock"),t.negativeStock&&f.push("negative_stock"),t.healthyStock&&f.push("healthy"),f},Q=()=>!!(t.searchTerm||t.unit||t.inventoryType||t.lowStock||t.zeroStock||t.negativeStock||t.healthyStock);return e.jsxs(o,{sx:{mb:2,display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,alignItems:"center"},children:[e.jsx(N,{label:"Search by Name",value:k,onChange:$,placeholder:"Enter category group name...",sx:{minWidth:{xs:"100%",sm:250},flexGrow:1}}),e.jsxs(ae,{sx:{minWidth:{xs:"100%",sm:200}},children:[e.jsx(ye,{children:"Status"}),e.jsx(pe,{multiple:!0,value:E(),onChange:m,input:e.jsx(Je,{label:"Status"}),renderValue:f=>e.jsx(o,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:f.map(i=>{const d=c.find(G=>G.value===i);return e.jsx(R,{label:(d==null?void 0:d.label)||i,size:"small",sx:{backgroundColor:(d==null?void 0:d.color)||"#757575",color:"#ffffff",fontWeight:"medium","&:hover":{backgroundColor:(d==null?void 0:d.color)||"#757575",filter:"brightness(0.9)"}}},i)})}),MenuProps:ir,children:c.map(f=>e.jsx(Z,{value:f.value,children:e.jsx(R,{label:f.label,size:"small",sx:{backgroundColor:f.color,color:"white",fontWeight:"medium"}})},f.value))})]}),e.jsxs(N,{select:!0,label:"Unit",value:t.unit||"",onChange:T,sx:{minWidth:{xs:"100%",sm:150}},children:[e.jsx(Z,{value:"",children:"All Units"}),v.map(f=>e.jsx(Z,{value:f.value,children:f.label},f.value))]}),e.jsxs(N,{select:!0,label:"Type",value:t.inventoryType||"",onChange:P,sx:{minWidth:{xs:"100%",sm:150}},children:[e.jsx(Z,{value:"",children:"All Types"}),l.map(f=>e.jsx(Z,{value:f.value,children:f.label},f.value))]}),e.jsxs(o,{sx:{display:"flex",gap:1},children:[e.jsx(B,{title:"Configure Thresholds",children:e.jsx(K,{variant:"outlined",onClick:h,startIcon:e.jsx(pt,{}),size:"medium",sx:{minWidth:{xs:"auto",sm:"auto"},px:{xs:1,sm:2}},children:e.jsx(o,{sx:{display:{xs:"none",sm:"block"}},children:"Thresholds"})})}),e.jsx(B,{title:"Refresh Data",children:e.jsx(V,{onClick:n,color:"primary",sx:{border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white"}},children:e.jsx(Xe,{})})}),e.jsx(B,{title:"Export to CSV",children:e.jsx(V,{onClick:O,color:"primary",disabled:C.length===0,sx:{border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white"}},children:e.jsx(et,{})})}),Q()&&e.jsx(B,{title:"Clear All Filters",children:e.jsx(V,{onClick:r,color:"secondary",sx:{border:"1px solid",borderColor:"secondary.main","&:hover":{backgroundColor:"secondary.light",color:"white"}},children:e.jsx(tt,{})})})]}),e.jsx(or,{open:z,onClose:W,onSuccess:_})]})},dr=({inventoryLevel:t,onUpdateSuccess:p,onUpdateError:x})=>{const C=ee(),[u,I]=g.useState(!1),[k,j]=g.useState(t.minimumThreshold.toString()),[z,M]=g.useState(!1),[c,v]=g.useState(null);g.useEffect(()=>{j(t.minimumThreshold.toString())},[t.minimumThreshold]);const l=(r,n)=>n==="g"&&r>=1e3?`${(r/1e3).toFixed(2)} kg`:`${r.toFixed(2)} ${n}`,$=()=>{I(!0),v(null)},m=()=>{I(!1),j(t.minimumThreshold.toString()),v(null)},T=async()=>{const r=parseFloat(k);if(isNaN(r)||r<0){v("Please enter a valid non-negative number");return}if(r>1e4){v("Threshold seems unreasonably high. Please verify.");return}if(r===t.minimumThreshold){I(!1),v(null);return}M(!0),v(null);try{await C(it({id:t.categoryGroupId,groupData:{minimumThreshold:r}})).unwrap(),C(J()),I(!1),p==null||p(t.categoryGroupId,r)}catch(n){const h=n instanceof Error?n.message:"Failed to update threshold";v(h),x==null||x(t.categoryGroupId,h)}finally{M(!1)}},P=r=>{r.key==="Enter"?T():r.key==="Escape"&&m()};return u?e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(N,{size:"small",type:"number",value:k,onChange:r=>j(r.target.value),onKeyDown:P,error:!!c,helperText:c,placeholder:`0 ${t.inventoryUnit}`,inputProps:{min:0,step:"any",style:{textAlign:"right"}},InputProps:{endAdornment:e.jsx(s,{variant:"caption",color:"text.secondary",children:t.inventoryUnit})},sx:{width:100,"& .MuiOutlinedInput-root":{fontSize:"0.875rem"}},autoFocus:!0,disabled:z}),e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(B,{title:"Save changes",children:e.jsx("span",{children:e.jsx(V,{size:"small",onClick:T,disabled:z,sx:{color:"success.main"},children:z?e.jsx(ie,{size:16}):e.jsx(rt,{fontSize:"small"})})})}),e.jsx(B,{title:"Cancel editing",children:e.jsx("span",{children:e.jsx(V,{size:"small",onClick:m,disabled:z,sx:{color:"error.main"},children:e.jsx(Fe,{fontSize:"small"})})})})]})]}):e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",borderRadius:1,px:1,py:.5,transition:"all 0.2s","&:hover":{backgroundColor:"action.hover","& .edit-button":{opacity:1}}},onClick:$,children:[e.jsx(s,{variant:"body2",children:l(t.minimumThreshold,t.inventoryUnit)}),e.jsx(B,{title:"Click to edit threshold",children:e.jsx(V,{size:"small",onClick:r=>{r.stopPropagation(),$()},className:"edit-button",sx:{opacity:0,transition:"opacity 0.2s",ml:1,p:.25,color:"primary.main"},children:e.jsx(Re,{fontSize:"small"})})})]})},ur=({inventoryLevel:t,onUpdateSuccess:p,onUpdateError:x})=>{const C=ee(),[u,I]=g.useState(!1),[k,j]=g.useState(t.currentInventory.toString()),[z,M]=g.useState(!1),[c,v]=g.useState(null);g.useEffect(()=>{j(t.currentInventory.toString())},[t.currentInventory]);const l=(r,n)=>n==="g"&&r>=1e3?`${(r/1e3).toFixed(2)} kg`:`${r.toFixed(2)} ${n}`,$=()=>{I(!0),v(null)},m=()=>{I(!1),j(t.currentInventory.toString()),v(null)},T=async()=>{const r=parseFloat(k);if(isNaN(r)||r<0){v("Please enter a valid non-negative number");return}if(r>1e5){v("Inventory level seems unreasonably high. Please verify.");return}if(r===t.currentInventory){I(!1),v(null);return}M(!0),v(null);try{await new Bt().adjustInventoryManually({categoryGroupId:t.categoryGroupId,adjustmentType:"set",quantity:r,reason:"correction",notes:`Set inventory level to ${r} ${t.inventoryUnit}`,adjustedBy:"current-user"}),C(J()),I(!1),p==null||p(t.categoryGroupId,r)}catch(n){const h=n instanceof Error?n.message:"Failed to update inventory level";v(h),x==null||x(t.categoryGroupId,h)}finally{M(!1)}},P=r=>{r.key==="Enter"?T():r.key==="Escape"&&m()};return u?e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(N,{size:"small",type:"number",value:k,onChange:r=>j(r.target.value),onKeyDown:P,error:!!c,helperText:c,placeholder:`0 ${t.inventoryUnit}`,inputProps:{min:0,step:"any",style:{textAlign:"right"}},InputProps:{endAdornment:e.jsx(s,{variant:"caption",color:"text.secondary",children:t.inventoryUnit})},sx:{width:120,"& .MuiOutlinedInput-root":{fontSize:"0.875rem"}},autoFocus:!0,disabled:z}),e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(B,{title:"Set inventory level",children:e.jsx("span",{children:e.jsx(V,{size:"small",onClick:T,disabled:z,sx:{color:"success.main"},children:z?e.jsx(ie,{size:16}):e.jsx(rt,{fontSize:"small"})})})}),e.jsx(B,{title:"Cancel editing",children:e.jsx("span",{children:e.jsx(V,{size:"small",onClick:m,disabled:z,sx:{color:"error.main"},children:e.jsx(Fe,{fontSize:"small"})})})})]})]}):e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",borderRadius:1,px:1,py:.5,transition:"all 0.2s","&:hover":{backgroundColor:"action.hover","& .edit-button":{opacity:1}}},onClick:$,children:[e.jsx(s,{variant:"body2",sx:{fontWeight:"medium",color:t.currentInventory<=0?"error.main":"text.primary"},children:l(t.currentInventory,t.inventoryUnit)}),e.jsx(B,{title:"Click to set inventory level",children:e.jsx(V,{size:"small",onClick:r=>{r.stopPropagation(),$()},className:"edit-button",sx:{opacity:0,transition:"opacity 0.2s",ml:1,p:.25,color:"primary.main"},children:e.jsx(Re,{fontSize:"small"})})})]})},hr=({categoryGroupId:t,onClose:p})=>{const x=ee(),[C,u]=g.useState(!1),I=F(Ie),k=F(n=>n.inventory.inventoryMovements),j=F(n=>n.inventory.loading.inventoryMovements),z=g.useMemo(()=>k.filter(n=>n.categoryGroupId===t),[k,t]),M=g.useMemo(()=>{const n=I.find(h=>h.id===t);return(n==null?void 0:n.name)||t},[I,t]);g.useEffect(()=>{x(Me({categoryGroupId:t})),x(ge())},[x,t]);const c=n=>{switch(n){case"addition":return"#2e7d32";case"deduction":return"#c62828";case"adjustment":return"#1565c0";case"initial":return"#616161";default:return"#616161"}},v=n=>{switch(n){case"addition":return"Addition";case"deduction":return"Deduction";case"adjustment":return"Adjustment";case"initial":return"Initial";default:return"Unknown"}},l=n=>{if(!n)return"Unknown";try{const h=n,W=h!=null&&h.toDate?h.toDate():new Date(n);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(W)}catch{return"Invalid Date"}},$=n=>{if(!n)return"Unknown";try{const h=n,W=h!=null&&h.toDate?h.toDate():new Date(n);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(W)}catch{return"Invalid Date"}},m=n=>{const h=n.movementType==="deduction"?"-":"+",W=n.unit==="g"&&n.quantity>=1e3?`${(n.quantity/1e3).toFixed(2)} kg`:`${n.quantity.toFixed(2)} ${n.unit}`;return`${h}${W}`},T=(n,h)=>h==="g"&&n>=1e3?`${(n/1e3).toFixed(2)} kg`:`${n.toFixed(2)} ${h}`,P=g.useMemo(()=>{if(!C)return null;const n={};return z.forEach(h=>{const W=$(h.createdAt);n[W]||(n[W]=[]),n[W].push(h)}),Object.entries(n).sort(([h],[W])=>{const _=new Date(h).getTime();return new Date(W).getTime()-_})},[z,C]),r=n=>e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,p:1.5,borderRadius:1,"&:hover":{backgroundColor:"action.hover"}},children:[e.jsx(R,{label:v(n.movementType),size:"small",sx:{backgroundColor:c(n.movementType),color:"#ffffff",fontWeight:"medium",minWidth:80,"&:hover":{backgroundColor:c(n.movementType),filter:"brightness(0.9)"}}}),e.jsxs(o,{sx:{flex:1},children:[e.jsx(s,{variant:"body2",sx:{fontWeight:"medium"},children:m(n)}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:[!C&&l(n.createdAt),C&&n.createdAt&&new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit"}).format(typeof n.createdAt=="object"&&"toDate"in n.createdAt?n.createdAt.toDate():new Date(n.createdAt))]})]}),e.jsxs(o,{sx:{textAlign:"right"},children:[e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Previous: ",T(n.previousInventory,n.unit)]}),e.jsxs(s,{variant:"body2",sx:{fontWeight:"medium"},children:["New: ",T(n.newInventory,n.unit)]})]})]},n.id);return e.jsxs(X,{elevation:0,sx:{p:2,backgroundColor:"transparent",borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(o,{children:[e.jsxs(s,{variant:"subtitle1",sx:{fontWeight:"bold"},children:["Historical Activity: ",M]}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:[z.length," ",z.length===1?"movement":"movements"]})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(gt,{value:C?"date":"list",exclusive:!0,onChange:(n,h)=>{h!==null&&u(h==="date")},size:"small",children:[e.jsx(Ue,{value:"list",children:e.jsx(B,{title:"List View",children:e.jsx(jt,{fontSize:"small"})})}),e.jsx(Ue,{value:"date",children:e.jsx(B,{title:"Group by Date",children:e.jsx(ft,{fontSize:"small"})})})]}),e.jsx(B,{title:"Close",children:e.jsx(V,{size:"small",onClick:p,children:e.jsx(Fe,{})})})]})]}),e.jsx(Ye,{sx:{mb:2}}),j&&e.jsx(o,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(ie,{size:24})}),!j&&z.length===0&&e.jsx(o,{sx:{textAlign:"center",p:3},children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"No historical activity found for this category group"})}),!j&&z.length>0&&!C&&e.jsx(o,{sx:{display:"flex",flexDirection:"column",gap:1,maxHeight:400,overflow:"auto"},children:z.map(r)}),!j&&z.length>0&&C&&P&&e.jsx(o,{sx:{display:"flex",flexDirection:"column",gap:2,maxHeight:400,overflow:"auto"},children:P.map(([n,h])=>e.jsxs(o,{children:[e.jsx(s,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1,color:"primary.main"},children:n}),e.jsx(o,{sx:{display:"flex",flexDirection:"column",gap:1,pl:2},children:h.map(r)})]},n))})]})},xr=({onManualAdjustment:t})=>{const p=ee(),x=F(Ce),C=F(Le),u=F(ct),I=F(Et),[k,j]=g.useState(!1),[z,M]=g.useState(""),[c,v]=g.useState("success"),[l,$]=g.useState(null),[m,T]=g.useState("name"),[P,r]=g.useState("asc"),[n,h]=g.useState(0),[W,_]=g.useState(25);g.useEffect(()=>{p(J())},[p]);const O=()=>{p(J())};g.useEffect(()=>{u.inventoryLevels&&(M(u.inventoryLevels),v("error"),j(!0))},[u.inventoryLevels]);const E=S=>{p(_t(S))},Q=()=>{p(Ut())},f=()=>{j(!1)},i=S=>{$(U=>U===S?null:S)},d=S=>{r(m===S&&P==="asc"?"desc":"asc"),T(S)},G=(S,U)=>{h(U)},y=S=>{_(parseInt(S.target.value,10)),h(0)},b=ve.useMemo(()=>[...x].sort((U,Y)=>{const je=U[m],fe=Y[m];if(je===fe)return 0;if(je==null)return 1;if(fe==null)return-1;const Ee=je<fe?-1:1;return P==="asc"?Ee:-Ee}),[x,m,P]),a=ve.useMemo(()=>b.slice(n*W,n*W+W),[b,n,W]),w=S=>{switch(S){case"healthy":return"#2e7d32";case"low_stock":return"#e65100";case"zero_stock":return"#c62828";case"negative_stock":return"#6a1b9a";default:return"#757575"}},D=S=>{switch(S){case"healthy":return"Healthy";case"low_stock":return"Low Stock";case"zero_stock":return"Zero Stock";case"negative_stock":return"Negative";default:return"Unknown"}},H=(S,U)=>U==="g"&&S>=1e3?`${(S/1e3).toFixed(2)} kg`:`${S.toFixed(2)} ${U}`,ce=S=>{if(!S)return"Never";try{const U=S&&typeof S=="object"&&"toDate"in S?S.toDate():new Date(S);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(U)}catch{return"Invalid Date"}},L=S=>e.jsxs(o,{sx:{display:"flex",gap:.5,justifyContent:"center"},children:[e.jsx(B,{title:"View History",children:e.jsx(V,{size:"small","aria-label":`history-${S.categoryGroupId}`,onClick:U=>{U.stopPropagation(),i(S.categoryGroupId)},color:l===S.categoryGroupId?"primary":"default",children:e.jsx(be,{})})}),t&&e.jsx(B,{title:"Adjust Inventory",children:e.jsx(V,{size:"small","aria-label":`adjust-${S.categoryGroupId}`,onClick:U=>{U.stopPropagation(),t(S)},color:"primary",children:e.jsx(St,{})})})]});return e.jsxs(o,{sx:{width:"100%"},children:[e.jsx(cr,{filters:I.inventory,onFilterChange:E,onClearFilters:Q,inventoryLevels:x,onRefresh:O}),e.jsxs(X,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(vt,{children:e.jsxs(bt,{stickyHeader:!0,children:[e.jsx(It,{children:e.jsxs(de,{children:[e.jsx(q,{children:e.jsx(ue,{active:m==="name",direction:m==="name"?P:"asc",onClick:()=>d("name"),children:"Category Group"})}),e.jsx(q,{align:"right",children:e.jsx(ue,{active:m==="currentInventory",direction:m==="currentInventory"?P:"asc",onClick:()=>d("currentInventory"),children:"Current Inventory"})}),e.jsx(q,{children:"Type"}),e.jsx(q,{align:"right",children:e.jsx(ue,{active:m==="minimumThreshold",direction:m==="minimumThreshold"?P:"asc",onClick:()=>d("minimumThreshold"),children:"Min Threshold"})}),e.jsx(q,{children:e.jsx(ue,{active:m==="status",direction:m==="status"?P:"asc",onClick:()=>d("status"),children:"Status"})}),e.jsx(q,{children:e.jsx(ue,{active:m==="lastInventoryUpdate",direction:m==="lastInventoryUpdate"?P:"asc",onClick:()=>d("lastInventoryUpdate"),children:"Last Updated"})}),e.jsx(q,{align:"center",children:"Actions"})]})}),e.jsx(Ct,{children:C.inventoryLevels&&x.length===0?e.jsx(de,{children:e.jsx(q,{colSpan:7,align:"center",children:e.jsx(s,{variant:"body2",color:"text.secondary",sx:{py:3},children:"Loading inventory levels..."})})}):!C.inventoryLevels&&x.length===0?e.jsx(de,{children:e.jsx(q,{colSpan:7,align:"center",children:e.jsx(s,{variant:"body2",color:"text.secondary",sx:{py:3},children:"No inventory levels found."})})}):a.map(S=>e.jsxs(ve.Fragment,{children:[e.jsxs(de,{hover:!0,onClick:()=>i(S.categoryGroupId),sx:{cursor:"pointer","& > *":{borderBottom:"unset"}},children:[e.jsx(q,{children:e.jsx(s,{variant:"body2",sx:{fontWeight:"medium"},children:S.name})}),e.jsx(q,{align:"right",children:e.jsx(ur,{inventoryLevel:S,onUpdateSuccess:(U,Y)=>{M(`Successfully updated inventory to ${H(Y,S.inventoryUnit)}`),v("success"),j(!0),O()},onUpdateError:(U,Y)=>{M(`Failed to update inventory: ${Y}`),v("error"),j(!0)}})}),e.jsx(q,{children:e.jsx(R,{label:S.inventoryType==="weight"?"Weight":"Quantity",size:"small",color:S.inventoryType==="weight"?"primary":"secondary",variant:"outlined"})}),e.jsx(q,{align:"right",children:e.jsx(dr,{inventoryLevel:S,onUpdateSuccess:(U,Y)=>{M(`Successfully updated threshold to ${Y} ${S.inventoryUnit}`),v("success"),j(!0),O()},onUpdateError:(U,Y)=>{M(`Failed to update threshold: ${Y}`),v("error"),j(!0)}})}),e.jsx(q,{children:e.jsx(R,{label:D(S.status),size:"small",sx:{backgroundColor:w(S.status),color:"#ffffff",fontWeight:"medium","&:hover":{backgroundColor:w(S.status),filter:"brightness(0.9)"}}})}),e.jsx(q,{children:e.jsx(s,{variant:"body2",color:"text.secondary",children:ce(S.lastInventoryUpdate)})}),e.jsx(q,{align:"center",children:L(S)})]}),e.jsx(de,{children:e.jsx(q,{style:{paddingBottom:0,paddingTop:0},colSpan:7,children:e.jsx(Pe,{in:l===S.categoryGroupId,timeout:"auto",unmountOnExit:!0,children:e.jsx(o,{sx:{margin:1},children:e.jsx(hr,{categoryGroupId:S.categoryGroupId,onClose:()=>$(null)})})})})})]},S.categoryGroupId))})]})}),e.jsx(kt,{rowsPerPageOptions:[10,25,50,100],component:"div",count:b.length,rowsPerPage:W,page:n,onPageChange:G,onRowsPerPageChange:y})]}),e.jsx(nt,{open:k,autoHideDuration:6e3,onClose:f,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(le,{onClose:f,severity:c,sx:{width:"100%"},children:z})})]})},Be=["stock_received","stock_damaged","stock_expired","stock_returned","stock_counted","stock_transferred","stock_lost","correction","other"],mr=48,yr=8,pr={PaperProps:{style:{maxHeight:mr*4.5+yr,width:250}}},gr=({filters:t={},onFilterChange:p})=>{var i,d,G;const[x,C]=g.useState(t.categoryGroupId||""),[u,I]=g.useState(t.orderReference||""),[k,j]=g.useState(t.transactionReference||""),[z,M]=g.useState(t.productSku||""),[c,v]=g.useState(t.adjustedBy||""),l=[{value:"addition",label:"Addition",color:"#4caf50"},{value:"deduction",label:"Deduction",color:"#f44336"},{value:"adjustment",label:"Adjustment",color:"#2196f3"},{value:"initial",label:"Initial",color:"#757575"}],$=[{value:"amazon",label:"Amazon"},{value:"flipkart",label:"Flipkart"}],m=Be.map(y=>({value:y,label:y.replace(/_/g," ").replace(/\b\w/g,b=>b.toUpperCase())})),T=y=>{const b=y.target.value;C(b),p({categoryGroupId:b||void 0})},P=y=>{const b=y.target.value,a=typeof b=="string"?b.split(","):b;a.length===1?p({movementType:a[0]}):p({movementType:void 0})},r=y=>{const b=y.target.value;p({platform:b||void 0})},n=y=>{const b=y.target.value;p({reason:b||void 0})},h=y=>{p({startDate:y||void 0})},W=y=>{p({endDate:y||void 0})},_=y=>{const b=y.target.value;I(b),p({orderReference:b||void 0})},O=y=>{const b=y.target.value;j(b),p({transactionReference:b||void 0})},E=y=>{const b=y.target.value;M(b),p({productSku:b||void 0})},Q=y=>{const b=y.target.value;v(b),p({adjustedBy:b||void 0})},f=()=>t.movementType?[t.movementType]:[];return e.jsx(er,{dateAdapter:tr,children:e.jsxs(o,{sx:{width:"100%"},children:[e.jsx(s,{variant:"subtitle2",sx:{mb:2,fontWeight:"medium"},children:"Filter Inventory Movements"}),e.jsxs(A,{container:!0,spacing:2,children:[e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsx(Ke,{label:"Start Date",value:t.startDate||null,onChange:h,slotProps:{textField:{fullWidth:!0,size:"small"}}})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsx(Ke,{label:"End Date",value:t.endDate||null,onChange:W,slotProps:{textField:{fullWidth:!0,size:"small"}}})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ae,{fullWidth:!0,size:"small",children:[e.jsx(ye,{children:"Movement Type"}),e.jsx(pe,{multiple:!0,value:f(),onChange:P,input:e.jsx(Je,{label:"Movement Type"}),renderValue:y=>e.jsx(o,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:y.map(b=>{const a=l.find(w=>w.value===b);return e.jsx(R,{label:(a==null?void 0:a.label)||b,size:"small",sx:{backgroundColor:(a==null?void 0:a.color)||"#757575",color:"white",fontWeight:"medium"}},b)})}),MenuProps:pr,children:l.map(y=>e.jsx(Z,{value:y.value,children:e.jsx(R,{label:y.label,size:"small",sx:{backgroundColor:y.color,color:"white",fontWeight:"medium"}})},y.value))})]})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(N,{select:!0,label:"Platform",value:t.platform||"",onChange:r,fullWidth:!0,size:"small",children:[e.jsx(Z,{value:"",children:"All Platforms"}),$.map(y=>e.jsx(Z,{value:y.value,children:y.label},y.value))]})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsx(N,{label:"Category Group",value:x,onChange:T,placeholder:"Search by category name...",fullWidth:!0,size:"small"})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsx(N,{label:"Order Reference",value:u,onChange:_,placeholder:"Enter order reference...",fullWidth:!0,size:"small"})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsx(N,{label:"Transaction Reference",value:k,onChange:O,placeholder:"Enter transaction reference...",fullWidth:!0,size:"small"})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsx(N,{label:"Product SKU",value:z,onChange:E,placeholder:"Enter product SKU...",fullWidth:!0,size:"small"})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(N,{select:!0,label:"Adjustment Reason",value:t.reason||"",onChange:n,fullWidth:!0,size:"small",children:[e.jsx(Z,{value:"",children:"All Reasons"}),m.map(y=>e.jsx(Z,{value:y.value,children:y.label},y.value))]})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsx(N,{label:"Adjusted By",value:c,onChange:Q,placeholder:"Enter user identifier...",fullWidth:!0,size:"small"})}),e.jsx(A,{item:!0,xs:12,children:e.jsx(X,{sx:{p:1.5,backgroundColor:"grey.50"},children:e.jsxs(s,{variant:"caption",color:"text.secondary",children:[e.jsx("strong",{children:"Filter Summary:"}),t.startDate&&` From ${t.startDate.toLocaleDateString()}`,t.endDate&&` To ${t.endDate.toLocaleDateString()}`,t.movementType&&` • Type: ${(i=l.find(y=>y.value===t.movementType))==null?void 0:i.label}`,t.platform&&` • Platform: ${(d=$.find(y=>y.value===t.platform))==null?void 0:d.label}`,t.categoryGroupId&&` • Category: ${t.categoryGroupId}`,t.orderReference&&` • Order: ${t.orderReference}`,t.transactionReference&&` • Transaction: ${t.transactionReference}`,t.productSku&&` • SKU: ${t.productSku}`,t.reason&&` • Reason: ${(G=m.find(y=>y.value===t.reason))==null?void 0:G.label}`,t.adjustedBy&&` • User: ${t.adjustedBy}`,!Object.values(t).some(y=>y)&&" No filters applied - showing all movements"]})})})]})]})})},jr=({onOrderClick:t,onTransactionClick:p})=>{const x=st(),C=ee(),u=F(a=>a.inventory.filteredInventoryMovements),I=F(a=>a.inventory.loading.inventoryMovements),k=F(a=>a.inventory.error.inventoryMovements),j=F(a=>a.inventory.filters.movements),z=F(Ie),[M,c]=g.useState(!1),[v,l]=g.useState(""),[$,m]=g.useState("success"),[T,P]=g.useState(!1);g.useEffect(()=>{C(Me(j))},[C,j]),g.useEffect(()=>{C(ge())},[C]),g.useEffect(()=>{k&&(l(k),m("error"),c(!0))},[k]);const r=a=>{const w=z.find(D=>D.id===a);return(w==null?void 0:w.name)||a},n=a=>{C(qt(a))},h=()=>{C(Ot())},W=()=>{C(Me(j)),l("Movements data refreshed"),m("success"),c(!0)},_=()=>{c(!1)},O=a=>{switch(a){case"addition":return x.palette.success.main;case"deduction":return x.palette.error.main;case"adjustment":return x.palette.primary.main;case"initial":return x.palette.grey[500];default:return x.palette.grey[500]}},E=a=>{switch(a){case"addition":return"Addition";case"deduction":return"Deduction";case"adjustment":return"Adjustment";case"initial":return"Initial";default:return"Unknown"}},Q=a=>{const w=a.movementType==="deduction"?"-":"+",D=a.unit==="g"&&a.quantity>=1e3?`${(a.quantity/1e3).toFixed(2)} kg`:`${a.quantity.toFixed(2)} ${a.unit}`;return`${w}${D}`},f=(a,w)=>w==="g"&&a>=1e3?`${(a/1e3).toFixed(2)} kg`:`${a.toFixed(2)} ${w}`,i=a=>{if(!a)return"Unknown";try{const w=a,D=w!=null&&w.toDate?w.toDate():new Date(a);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(D)}catch{return"Invalid Date"}},d=a=>{const w=[];return a.platform&&w.push(e.jsx(R,{label:a.platform.charAt(0).toUpperCase()+a.platform.slice(1),size:"small",variant:"outlined",sx:{fontSize:"0.75rem",color:"rgba(25, 30, 55, 1)",borderColor:"rgba(25, 30, 55, 0.5)",backgroundColor:"rgba(245, 247, 250, 1)"}},"platform")),a.orderReference&&w.push(e.jsxs(_e,{component:"button",variant:"body2",onClick:D=>{D.stopPropagation(),t==null||t(a.orderReference)},sx:{textDecoration:"underline",cursor:"pointer",color:"rgba(25, 118, 210, 1)",fontSize:"0.75rem",fontWeight:500,"&:hover":{color:"rgba(21, 101, 192, 1)",backgroundColor:"rgba(25, 118, 210, 0.04)"},"&:focus":{outline:"2px solid rgba(25, 118, 210, 0.5)",outlineOffset:"2px"}},children:["Order: ",a.orderReference]},"order")),a.transactionReference&&w.push(e.jsxs(_e,{component:"button",variant:"body2",onClick:D=>{D.stopPropagation(),p==null||p(a.transactionReference)},sx:{textDecoration:"underline",cursor:"pointer",color:"rgba(25, 118, 210, 1)",fontSize:"0.75rem",fontWeight:500,"&:hover":{color:"rgba(21, 101, 192, 1)",backgroundColor:"rgba(25, 118, 210, 0.04)"},"&:focus":{outline:"2px solid rgba(25, 118, 210, 0.5)",outlineOffset:"2px"}},children:["Txn: ",a.transactionReference]},"transaction")),a.productSku&&w.push(e.jsxs(s,{variant:"caption",sx:{fontFamily:"monospace",backgroundColor:"rgba(245, 245, 245, 1)",color:"rgba(33, 33, 33, 1)",px:.5,py:.25,borderRadius:.5,fontSize:"0.7rem",fontWeight:500,border:"1px solid rgba(189, 189, 189, 1)"},children:["SKU: ",a.productSku]},"sku")),a.reason&&w.push(e.jsxs(s,{variant:"caption",sx:{color:"rgba(97, 97, 97, 1)",fontStyle:"italic",fontSize:"0.75rem",fontWeight:500},children:["Reason: ",a.reason.replace(/_/g," ").replace(/\b\w/g,D=>D.toUpperCase())]},"reason")),a.adjustedBy&&w.push(e.jsxs(s,{variant:"caption",sx:{color:"rgba(97, 97, 97, 1)",fontSize:"0.75rem",fontWeight:500},children:["By: ",a.adjustedBy]},"adjustedBy")),w.length===0?e.jsx(s,{variant:"caption",sx:{color:"rgba(97, 97, 97, 1)"},children:"—"}):e.jsx(o,{sx:{display:"flex",flexDirection:"column",gap:.5},children:w})},G=()=>{const w=[["Date/Time","Category Group","Movement Type","Quantity Change","Previous Level","New Level","Unit","Platform","Order Reference","Transaction Reference","Product SKU","Reason","Adjusted By","Notes"].join(","),...u.map(L=>[`"${i(L.createdAt)}"`,`"${r(L.categoryGroupId)}"`,`"${E(L.movementType)}"`,`"${Q(L)}"`,L.previousInventory,L.newInventory,L.unit,L.platform||"",L.orderReference||"",L.transactionReference||"",L.productSku||"",L.reason||"",L.adjustedBy||"",`"${L.notes||""}"`].join(","))].join(`
`),D=new Blob([w],{type:"text/csv;charset=utf-8;"}),H=document.createElement("a"),ce=URL.createObjectURL(D);H.setAttribute("href",ce),H.setAttribute("download",`inventory-movements-${new Date().toISOString().split("T")[0]}.csv`),H.style.visibility="hidden",document.body.appendChild(H),H.click(),document.body.removeChild(H),l("Movements exported to CSV"),m("success"),c(!0)},y=()=>!!(j.categoryGroupId||j.movementType||j.startDate||j.endDate||j.platform||j.adjustedBy||j.transactionReference||j.orderReference||j.productSku||j.reason),b=[{id:"createdAt",label:"Date/Time",priorityOnMobile:!0,format:a=>e.jsx(s,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.85rem"},children:i(a)})},{id:"categoryGroupId",label:"Category Group",filter:!0,priorityOnMobile:!0,format:a=>e.jsx(s,{variant:"body2",sx:{fontWeight:"medium"},children:r(a)})},{id:"movementType",label:"Type",filter:!0,align:"center",format:a=>{const w=a;return e.jsx(R,{label:E(w),size:"small",sx:{backgroundColor:O(w),color:"white",fontWeight:"medium",minWidth:"80px"}})},priorityOnMobile:!0},{id:"quantity",label:"Quantity Change",align:"right",format:(a,w)=>{const D=w,H=D.movementType==="deduction";return e.jsx(s,{variant:"body2",sx:{fontWeight:"medium",fontFamily:"monospace",color:H?"error.main":"success.main"},children:Q(D)})}},{id:"previousInventory",label:"Previous Level",align:"right",format:(a,w)=>{const D=a,H=(w==null?void 0:w.unit)||"";return e.jsx(s,{variant:"body2",sx:{fontFamily:"monospace"},children:f(D,H)})}},{id:"newInventory",label:"New Level",align:"right",format:(a,w)=>{const D=a,H=(w==null?void 0:w.unit)||"";return e.jsx(s,{variant:"body2",sx:{fontFamily:"monospace",fontWeight:"medium",color:D<=0?"error.main":"text.primary"},children:f(D,H)})}},{id:"context",label:"Context",format:(a,w)=>d(w)}];return e.jsxs(o,{sx:{width:"100%"},children:[e.jsxs(o,{sx:{mb:2,display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,alignItems:{xs:"stretch",sm:"center"},justifyContent:"space-between"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(be,{color:"primary"}),e.jsx(s,{variant:"h6",sx:{fontWeight:"medium"},children:"Inventory Movements"}),u.length>0&&e.jsx(R,{label:`${u.length} movements`,size:"small",variant:"outlined"})]}),e.jsxs(o,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(B,{title:"Toggle Filters",children:e.jsx(V,{onClick:()=>P(!T),color:T?"primary":"default",sx:{border:"1px solid",borderColor:T?"primary.main":"grey.300"},children:e.jsx(wt,{})})}),e.jsx(B,{title:"Refresh Data",children:e.jsx(V,{onClick:W,color:"primary",sx:{border:"1px solid",borderColor:"primary.main"},children:e.jsx(Xe,{})})}),e.jsx(B,{title:"Export to CSV",children:e.jsx(V,{onClick:G,color:"primary",disabled:u.length===0,sx:{border:"1px solid",borderColor:"primary.main"},children:e.jsx(Tt,{})})}),y()&&e.jsx(B,{title:"Clear All Filters",children:e.jsx(V,{onClick:h,color:"secondary",sx:{border:"1px solid",borderColor:"secondary.main"},children:e.jsx(tt,{})})})]})]}),e.jsx(Pe,{in:T,children:e.jsx(X,{sx:{p:2,mb:2},children:e.jsx(gr,{filters:j,onFilterChange:n,onClearFilters:h})})}),e.jsx(Xt,{columns:b,data:u,defaultSortColumn:"createdAt",defaultSortDirection:"desc",rowsPerPageOptions:[10,25,50,100],defaultRowsPerPage:25,getRowId:a=>a.id||`${a.categoryGroupId}-${a.createdAt}`}),I&&e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:3},children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Loading inventory movements..."})}),!I&&u.length===0&&e.jsxs(o,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",p:3,textAlign:"center"},children:[e.jsx(be,{sx:{fontSize:48,color:"grey.400",mb:2}}),e.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Inventory Movements Found"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:y()?"Try adjusting your filters to see more results.":"Inventory movements will appear here as orders are processed and adjustments are made."})]}),e.jsx(nt,{open:M,autoHideDuration:6e3,onClose:_,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(le,{onClose:_,severity:$,sx:{width:"100%"},children:v})})]})},fr=ut({categoryGroupId:xe().required("Category Group is required"),adjustmentType:xe().oneOf(["increase","decrease","set"],"Invalid adjustment type").required("Adjustment type is required"),quantity:ht().required("Quantity is required").min(0,"Quantity must be non-negative").test("positive-for-increase-decrease","Quantity must be positive for increase/decrease operations",function(t){const{adjustmentType:p}=this.parent;return p==="increase"||p==="decrease"?t>0:!0}),reason:xe().oneOf(Be,"Invalid reason").required("Reason is required"),notes:xe().max(500,"Notes must be 500 characters or less")}),vr=t=>t.split("_").map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(" "),br=t=>{switch(t){case"increase":return"Increase Inventory";case"decrease":return"Decrease Inventory";case"set":return"Set Inventory Level";default:return t}},Ir=({open:t,onClose:p,onSuccess:x,selectedCategoryGroupId:C,initialData:u})=>{const I=ee(),k=F(Nt),j=F(Le),z=F(ct),M=F(Ie),c=F(lt),v=F(Ce),l=dt({initialValues:{categoryGroupId:(u==null?void 0:u.categoryGroupId)||C||"",adjustmentType:(u==null?void 0:u.movementType)==="adjustment"?"set":"increase",quantity:(u==null?void 0:u.quantity)||0,reason:(u==null?void 0:u.reason)||"correction",notes:(u==null?void 0:u.notes)||""},validationSchema:fr,onSubmit:async n=>{try{const h={categoryGroupId:n.categoryGroupId,adjustmentType:n.adjustmentType,quantity:n.quantity,reason:n.reason,notes:n.notes||void 0,adjustedBy:(k==null?void 0:k.uid)||(k==null?void 0:k.email)||"unknown"};await I(Vt(h)).unwrap(),$(),x==null||x()}catch(h){console.error("Failed to adjust inventory:",h)}}});g.useEffect(()=>{t&&M.length===0&&!c&&I(ge())},[t,M.length,c,I]),g.useEffect(()=>{C&&l.values.categoryGroupId!==C&&l.setFieldValue("categoryGroupId",C)},[C]),g.useEffect(()=>{t&&I(Qe())},[t,I]);const $=()=>{l.resetForm(),I(Qe()),p()},m=M.find(n=>n.id===l.values.categoryGroupId),T=v.find(n=>n.categoryGroupId===l.values.categoryGroupId),r=(()=>{if(!T||!l.values.quantity)return null;switch(l.values.adjustmentType){case"increase":return T.currentInventory+l.values.quantity;case"decrease":return T.currentInventory-l.values.quantity;case"set":return l.values.quantity;default:return null}})();return e.jsx(Ge,{open:t,onClose:$,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:e.jsxs("form",{onSubmit:l.handleSubmit,children:[e.jsx(We,{children:e.jsxs(o,{children:[e.jsx(s,{variant:"h6",fontWeight:"bold",children:"Manual Inventory Adjustment"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Adjust inventory levels manually with proper tracking and audit trail"})]})}),e.jsxs($e,{dividers:!0,children:[z.adjustment&&e.jsx(le,{severity:"error",sx:{mb:3,bgcolor:"#d32f2f",color:"#ffffff",border:"2px solid #b71c1c",fontWeight:"bold","& .MuiAlert-icon":{color:"#ffffff"}},children:z.adjustment}),e.jsxs(A,{container:!0,spacing:3,children:[e.jsx(A,{item:!0,xs:12,children:e.jsxs(ae,{fullWidth:!0,error:l.touched.categoryGroupId&&!!l.errors.categoryGroupId,children:[e.jsx(ye,{children:"Category Group *"}),e.jsx(pe,{name:"categoryGroupId",value:l.values.categoryGroupId,onChange:l.handleChange,onBlur:l.handleBlur,label:"Category Group *",disabled:c||!!C,children:M.map(n=>e.jsx(Z,{value:n.id,children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(o,{sx:{width:16,height:16,backgroundColor:n.color,borderRadius:"50%"}}),e.jsx(s,{children:n.name}),e.jsx(R,{label:`${n.currentInventory} ${n.inventoryUnit}`,size:"small",variant:"outlined",sx:{ml:"auto"}})]})},n.id))}),l.touched.categoryGroupId&&l.errors.categoryGroupId&&e.jsx(s,{variant:"caption",color:"error",sx:{mt:1,ml:2},children:l.errors.categoryGroupId}),C&&e.jsx(s,{variant:"caption",color:"text.secondary",sx:{mt:1,ml:2},children:"Category is pre-selected for this inventory item"})]})}),m&&T&&e.jsx(A,{item:!0,xs:12,children:e.jsxs(X,{sx:{p:2,bgcolor:"#2e3440",border:"2px solid #434c5e",borderRadius:2},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,sx:{color:"#ffffff",fontWeight:"bold"},children:"Current Inventory Information"}),e.jsxs(o,{display:"flex",flexWrap:"wrap",gap:2,children:[e.jsxs(o,{children:[e.jsx(s,{variant:"body2",sx:{color:"#d8dee9",fontWeight:"medium"},children:"Current Level"}),e.jsxs(s,{variant:"h6",sx:{color:"#ffffff",fontWeight:"bold"},children:[T.currentInventory," ",T.inventoryUnit]})]}),e.jsxs(o,{children:[e.jsx(s,{variant:"body2",sx:{color:"#d8dee9",fontWeight:"medium"},children:"Minimum Threshold"}),e.jsxs(s,{variant:"body1",sx:{color:"#ffffff",fontWeight:"bold"},children:[T.minimumThreshold," ",T.inventoryUnit]})]}),e.jsxs(o,{children:[e.jsx(s,{variant:"body2",sx:{color:"#d8dee9",fontWeight:"medium"},children:"Status"}),e.jsx(R,{label:T.status.replace("_"," ").toUpperCase(),size:"small",sx:{backgroundColor:T.status==="healthy"?"#2e7d32":T.status==="low_stock"?"#f57c00":"#d32f2f",color:"#ffffff",fontWeight:"bold",border:"1px solid #ffffff"}})]})]})]})}),e.jsx(A,{item:!0,xs:12,children:e.jsxs(ae,{component:"fieldset",error:l.touched.adjustmentType&&!!l.errors.adjustmentType,children:[e.jsx(At,{component:"legend",children:"Adjustment Type *"}),e.jsxs(zt,{name:"adjustmentType",value:l.values.adjustmentType,onChange:l.handleChange,row:!0,children:[e.jsx(oe,{value:"increase",control:e.jsx(ke,{}),label:"Increase"}),e.jsx(oe,{value:"decrease",control:e.jsx(ke,{}),label:"Decrease"}),e.jsx(oe,{value:"set",control:e.jsx(ke,{}),label:"Set Level"})]}),l.touched.adjustmentType&&l.errors.adjustmentType&&e.jsx(s,{variant:"caption",color:"error",children:l.errors.adjustmentType})]})}),e.jsx(A,{item:!0,xs:12,sm:6,children:e.jsx(N,{fullWidth:!0,label:`Quantity ${l.values.adjustmentType==="set"?"to Set":`to ${br(l.values.adjustmentType).toLowerCase()}`}`,name:"quantity",type:"number",value:l.values.quantity,onChange:l.handleChange,onBlur:l.handleBlur,error:l.touched.quantity&&!!l.errors.quantity,helperText:l.touched.quantity&&l.errors.quantity,inputProps:{min:0,step:l.values.adjustmentType==="set"?"any":1},InputProps:{endAdornment:m&&e.jsx(s,{variant:"body2",color:"text.secondary",sx:{ml:1},children:m.inventoryUnit})}})}),r!==null&&m&&e.jsx(A,{item:!0,xs:12,sm:6,children:e.jsxs(X,{sx:{p:2,bgcolor:r<0?"#d32f2f":"#2e7d32",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",border:r<0?"2px solid #b71c1c":"2px solid #1b5e20"},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,sx:{color:"#ffffff",fontWeight:"bold"},children:"New Inventory Level"}),e.jsxs(s,{variant:"h6",sx:{color:"#ffffff",fontWeight:"bold"},children:[r," ",m.inventoryUnit]}),r<0&&e.jsx(s,{variant:"caption",sx:{color:"#ffebee",fontWeight:"bold"},children:"⚠️ Warning: Negative inventory level"})]})}),e.jsx(A,{item:!0,xs:12,sm:6,children:e.jsxs(ae,{fullWidth:!0,error:l.touched.reason&&!!l.errors.reason,children:[e.jsx(ye,{children:"Reason *"}),e.jsx(pe,{name:"reason",value:l.values.reason,onChange:l.handleChange,onBlur:l.handleBlur,label:"Reason *",children:Be.map(n=>e.jsx(Z,{value:n,children:vr(n)},n))}),l.touched.reason&&l.errors.reason&&e.jsx(s,{variant:"caption",color:"error",sx:{mt:1,ml:2},children:l.errors.reason})]})}),e.jsx(A,{item:!0,xs:12,sm:6,children:e.jsx(N,{fullWidth:!0,label:"Adjusted By",value:(k==null?void 0:k.email)||(k==null?void 0:k.uid)||"Current User",disabled:!0,helperText:"Automatically filled from current user session"})}),e.jsx(A,{item:!0,xs:12,children:e.jsx(N,{fullWidth:!0,label:"Notes (Optional)",name:"notes",multiline:!0,rows:3,value:l.values.notes,onChange:l.handleChange,onBlur:l.handleBlur,error:l.touched.notes&&!!l.errors.notes,helperText:l.touched.notes&&l.errors.notes,placeholder:"Add any additional details about this adjustment..."})})]})]}),e.jsxs(De,{sx:{p:2},children:[e.jsx(K,{onClick:$,disabled:j.adjustment,children:"Cancel"}),e.jsx(K,{type:"submit",variant:"contained",disabled:j.adjustment||!l.isValid||!l.dirty,children:j.adjustment?e.jsx(ie,{size:20}):"Apply Adjustment"})]})]})})},Cr=({open:t,onClose:p,onSuccess:x})=>{const C=ee(),[u,I]=g.useState(null),[k,j]=g.useState(""),[z,M]=g.useState(!1),[c,v]=g.useState(!1),[l,$]=g.useState(!1),[m,T]=g.useState(null),P=h=>{var _;const W=(_=h.target.files)==null?void 0:_[0];if(W){I(W),T(null);const O=new FileReader;O.onload=E=>{var f;const Q=(f=E.target)==null?void 0:f.result;j(Q)},O.readAsText(W)}},r=async()=>{if(k){$(!0);try{const h=await C(Ht({csvData:k,options:{updateExisting:z,validateOnly:c,skipMovements:!0}})).unwrap();T(h),h.success&&!c&&setTimeout(()=>{x()},2e3)}catch(h){T({success:!1,imported:0,errors:[h instanceof Error?h.message:"Import failed"],warnings:[],skipped:0})}finally{$(!1)}}},n=()=>{I(null),j(""),T(null),$(!1),p()};return e.jsxs(Ge,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[e.jsx(We,{children:"Import Inventory Data"}),e.jsx($e,{children:e.jsxs(o,{sx:{mb:3},children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Import inventory levels from CSV file. The CSV must include columns: CategoryGroupId, CategoryGroupName, CurrentInventory, InventoryUnit, InventoryType, MinimumThreshold, Status, LastUpdated"}),e.jsxs(o,{sx:{border:"2px dashed",borderColor:u?"primary.main":"grey.300",borderRadius:2,p:3,textAlign:"center",backgroundColor:u?"primary.50":"grey.50",cursor:"pointer",transition:"all 0.3s","&:hover":{borderColor:"primary.main",backgroundColor:"primary.50"}},component:"label",children:[e.jsx("input",{type:"file",accept:".csv",onChange:P,style:{display:"none"}}),e.jsx(Mt,{sx:{fontSize:48,color:"primary.main",mb:1}}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:u?u.name:"Select CSV File"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:u?"File loaded successfully":"Click to browse or drag and drop"})]}),u&&e.jsxs(o,{sx:{mt:3},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Import Options"}),e.jsx(oe,{control:e.jsx(Oe,{checked:z,onChange:h=>M(h.target.checked)}),label:"Update existing inventory levels"}),e.jsx(oe,{control:e.jsx(Oe,{checked:c,onChange:h=>v(h.target.checked)}),label:"Validate only (don't import)"})]}),l&&e.jsxs(o,{sx:{mt:3},children:[e.jsx(s,{variant:"body2",gutterBottom:!0,children:c?"Validating...":"Importing..."}),e.jsx(ot,{})]}),m&&e.jsxs(o,{sx:{mt:3},children:[e.jsxs(le,{severity:m.success?"success":"error",icon:m.success?e.jsx(me,{}):e.jsx(te,{}),sx:{mb:2},children:[e.jsx(s,{variant:"subtitle2",children:m.success?c?"Validation completed successfully":"Import completed successfully":"Import failed"}),e.jsxs(o,{sx:{display:"flex",gap:1,mt:1,flexWrap:"wrap"},children:[m.imported>0&&e.jsx(R,{label:`${m.imported} ${c?"validated":"imported"}`,color:"success",size:"small"}),m.skipped>0&&e.jsx(R,{label:`${m.skipped} skipped`,color:"warning",size:"small"}),m.errors.length>0&&e.jsx(R,{label:`${m.errors.length} errors`,color:"error",size:"small"}),m.warnings.length>0&&e.jsx(R,{label:`${m.warnings.length} warnings`,color:"warning",size:"small"})]})]}),m.errors.length>0&&e.jsxs(qe,{sx:{mb:1},children:[e.jsx(Ne,{expandIcon:e.jsx(Se,{}),children:e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(te,{color:"error",sx:{mr:1}}),e.jsxs(s,{color:"error",children:["Errors (",m.errors.length,")"]})]})}),e.jsx(Ve,{children:e.jsx(we,{dense:!0,children:m.errors.map((h,W)=>e.jsx(Te,{children:e.jsx(Ae,{primary:h,primaryTypographyProps:{color:"error",variant:"body2"}})},W))})})]}),m.warnings.length>0&&e.jsxs(qe,{children:[e.jsx(Ne,{expandIcon:e.jsx(Se,{}),children:e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(re,{color:"warning",sx:{mr:1}}),e.jsxs(s,{color:"warning.dark",children:["Warnings (",m.warnings.length,")"]})]})}),e.jsx(Ve,{children:e.jsx(we,{dense:!0,children:m.warnings.map((h,W)=>e.jsx(Te,{children:e.jsx(Ae,{primary:h,primaryTypographyProps:{color:"warning.dark",variant:"body2"}})},W))})})]})]})]})}),e.jsxs(De,{sx:{p:3,pt:0},children:[e.jsx(K,{onClick:n,children:m!=null&&m.success&&!c?"Close":"Cancel"}),e.jsx(K,{variant:"contained",startIcon:e.jsx(at,{}),onClick:r,disabled:!u||l||(m==null?void 0:m.success)&&!c,children:c?"Validate":"Import"})]})]})},kr=({inventoryLevels:t,loading:p=!1,onEdit:x,onManualAdjustment:C})=>{const u=st(),I=c=>{switch(c){case"healthy":return u.palette.success.main;case"low_stock":return u.palette.warning.main;case"zero_stock":return u.palette.error.main;case"negative_stock":return u.palette.error.dark;default:return u.palette.grey[500]}},k=c=>{switch(c){case"healthy":return e.jsx(me,{});case"low_stock":return e.jsx(re,{});case"zero_stock":return e.jsx(te,{});case"negative_stock":return e.jsx(Pt,{});default:return e.jsx(ze,{})}},j=c=>{switch(c){case"healthy":return"Healthy";case"low_stock":return"Low Stock";case"zero_stock":return"Zero Stock";case"negative_stock":return"Negative Stock";default:return"Unknown"}},z=(c,v)=>v===0?c>0?100:0:c<=0?0:Math.min(c/v*100,100),M=(c,v)=>v==="pcs"?`${Math.floor(c)} ${v}`:`${c.toFixed(2)} ${v}`;return p?e.jsx(o,{sx:{p:2},children:e.jsx(s,{variant:"body1",color:"text.secondary",children:"Loading inventory data..."})}):t.length===0?e.jsxs(o,{sx:{p:2,textAlign:"center"},children:[e.jsx(ze,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(s,{variant:"h6",color:"text.secondary",children:"No inventory data available"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Create category groups with inventory tracking to get started"})]}):e.jsx(A,{container:!0,spacing:2,sx:{p:2},children:t.map(c=>{const v=I(c.status),l=k(c.status),$=z(c.currentInventory,c.minimumThreshold);return e.jsx(A,{item:!0,xs:12,children:e.jsxs(ne,{elevation:2,sx:{borderLeft:`4px solid ${v}`,"&:hover":{elevation:4,transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},children:[e.jsx(Gt,{title:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(s,{variant:"h6",component:"span",noWrap:!0,children:c.name}),e.jsx(R,{icon:l,label:j(c.status),size:"small",sx:{backgroundColor:v,color:"#ffffff","& .MuiChip-icon":{color:"#ffffff"},"&:hover":{backgroundColor:v,filter:"brightness(0.9)"}}})]}),subheader:e.jsxs(s,{variant:"body2",color:"text.secondary",children:[c.inventoryType==="weight"?"Weight-based":"Quantity-based"," • ",c.inventoryUnit]}),action:e.jsx(V,{size:"small",onClick:()=>x==null?void 0:x(c),sx:{color:"text.secondary"},children:e.jsx(Re,{fontSize:"small"})}),sx:{pb:1}}),e.jsxs(se,{sx:{pt:0,pb:1},children:[e.jsxs(o,{sx:{mb:2},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Current Inventory"}),e.jsx(s,{variant:"body2",fontWeight:"medium",children:M(c.currentInventory,c.inventoryUnit)})]}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Minimum Threshold"}),e.jsx(s,{variant:"body2",fontWeight:"medium",children:M(c.minimumThreshold,c.inventoryUnit)})]}),e.jsxs(o,{sx:{mt:1},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Inventory Level"}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:[$.toFixed(0),"%"]})]}),e.jsx(ot,{variant:"determinate",value:Math.min($,100),sx:{height:6,borderRadius:3,backgroundColor:u.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:$<25?u.palette.error.main:$<50?u.palette.warning.main:u.palette.success.main,borderRadius:3}}})]})]}),c.status!=="healthy"&&e.jsxs(o,{sx:{p:1.5,borderRadius:1,backgroundColor:u.palette.grey[50],border:`1px solid ${u.palette.grey[200]}`},children:[e.jsx(s,{variant:"caption",color:"text.secondary",display:"block",children:"Status Alert"}),e.jsxs(s,{variant:"body2",sx:{mt:.5},children:[c.status==="low_stock"&&"Inventory is below minimum threshold",c.status==="zero_stock"&&"Inventory is completely depleted",c.status==="negative_stock"&&"Inventory shows negative balance - immediate attention required"]})]})]}),e.jsx(Wt,{sx:{px:2,pb:2,pt:0},children:e.jsx(K,{size:"small",variant:"outlined",startIcon:e.jsx($t,{}),onClick:()=>C==null?void 0:C(c),fullWidth:!0,sx:{textTransform:"none",borderRadius:2,py:1},children:"Adjust Inventory"})})]})},c.categoryGroupId)})})},Lr=()=>{const t=ee(),p=F(Ce),x=Qt(),[C,u]=g.useState(!1),[I,k]=g.useState(),[j,z]=g.useState(0),[M,c]=g.useState(!1);g.useEffect(()=>{t(J()),t(Kt())},[t]);const v=d=>{k(d),u(!0)},l=()=>{u(!1),k(void 0)},$=()=>{t(J()),u(!1),k(void 0)},m=(d,G)=>{z(G)},T=async()=>{try{const d=await t(Zt({includeMovements:!0})).unwrap(),G=new Blob([d],{type:"text/csv"}),y=window.URL.createObjectURL(G),b=document.createElement("a");b.href=y,b.download=`inventory-export-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(b),b.click(),document.body.removeChild(b),window.URL.revokeObjectURL(y)}catch(d){console.error("Export failed:",d)}},P=()=>{c(!0)},r=()=>{c(!1)},n=()=>{t(J()),c(!1)},h=p.length,W=p.filter(d=>d.status==="healthy"),_=p.filter(d=>d.status==="low_stock"),O=p.filter(d=>d.status==="zero_stock"),E=p.filter(d=>d.status==="negative_stock"),Q=d=>{switch(d){case"healthy":return e.jsx(me,{sx:{color:"#2e7d32"}});case"low_stock":return e.jsx(re,{sx:{color:"#e65100"}});case"zero_stock":return e.jsx(te,{sx:{color:"#c62828"}});case"negative_stock":return e.jsx(te,{sx:{color:"#6a1b9a"}});default:return e.jsx(me,{sx:{color:"#757575"}})}},f=[..._,...O,...E],i=e.jsxs(o,{sx:{p:x?2:3},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:x?2:3,flexDirection:x?"column":"row",gap:x?2:0},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ze,{sx:{mr:2,color:"primary.main",fontSize:x?28:32}}),e.jsx(s,{variant:x?"h5":"h4",component:"h1",sx:{fontWeight:"bold",color:"primary.dark"},children:"Inventory Management"})]}),e.jsxs(Dt,{direction:x?"column":"row",spacing:1,sx:{width:x?"100%":"auto"},children:[e.jsx(K,{variant:"outlined",startIcon:e.jsx(et,{}),onClick:T,size:x?"small":"medium",sx:{minWidth:x?"auto":void 0,width:x?"100%":"auto"},children:"Export"}),e.jsx(K,{variant:"outlined",startIcon:e.jsx(at,{}),onClick:P,size:x?"small":"medium",sx:{minWidth:x?"auto":void 0,width:x?"100%":"auto"},children:"Import"}),e.jsx(K,{variant:"contained",startIcon:e.jsx(Ft,{}),onClick:()=>v(),size:x?"small":"medium",sx:{minWidth:x?"auto":void 0,width:x?"100%":"auto"},children:"Manual Adjustment"})]})]}),!x&&e.jsxs(A,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ne,{sx:{height:"100%",borderLeft:"4px solid #2e7d32"},children:e.jsx(se,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{children:[e.jsx(s,{variant:"h4",sx:{fontWeight:"bold",color:"success.dark"},children:W.length}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Healthy Stock"})]}),e.jsx(me,{sx:{fontSize:40,color:"#2e7d32"}})]})})})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ne,{sx:{height:"100%",borderLeft:"4px solid #e65100"},children:e.jsx(se,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{children:[e.jsx(s,{variant:"h4",sx:{fontWeight:"bold",color:"warning.dark"},children:_.length}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Low Stock"})]}),e.jsx(re,{sx:{fontSize:40,color:"#e65100"}})]})})})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ne,{sx:{height:"100%",borderLeft:"4px solid #c62828"},children:e.jsx(se,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{children:[e.jsx(s,{variant:"h4",sx:{fontWeight:"bold",color:"error.dark"},children:O.length}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Zero Stock"})]}),e.jsx(te,{sx:{fontSize:40,color:"#c62828"}})]})})})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ne,{sx:{height:"100%",borderLeft:"4px solid #6a1b9a"},children:e.jsx(se,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{children:[e.jsx(s,{variant:"h4",sx:{fontWeight:"bold",color:"secondary.dark"},children:E.length}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Negative Stock"})]}),e.jsx(te,{sx:{fontSize:40,color:"#6a1b9a"}})]})})})})]}),f.length>0&&e.jsxs(X,{sx:{p:2,mb:3,bgcolor:"#b71c1c",borderRadius:2,border:"2px solid #7f0000"},children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",color:"#ffffff",fontWeight:"bold"},children:[e.jsx(re,{sx:{mr:1,color:"#ffffff"}}),"Inventory Alerts (",f.length,")"]}),e.jsxs(o,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[f.slice(0,6).map(d=>e.jsx(R,{label:`${d.name}: ${d.currentInventory} ${d.inventoryUnit}`,color:d.status==="low_stock"?"warning":"error",size:"small",icon:Q(d.status),sx:{fontSize:"0.75rem"}},d.categoryGroupId)),f.length>6&&e.jsx(R,{label:`+${f.length-6} more`,color:"default",size:"small",sx:{fontSize:"0.75rem"}})]})]}),e.jsxs(X,{sx:{p:0},children:[e.jsx(o,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Rt,{value:j,onChange:m,"aria-label":"inventory sections",children:[e.jsx(He,{icon:e.jsx(Lt,{}),label:"Inventory Levels",iconPosition:"start",sx:{fontWeight:"medium"}}),e.jsx(He,{icon:e.jsx(be,{}),label:"Activity History",iconPosition:"start",sx:{fontWeight:"medium"}})]})}),j===0&&e.jsxs(o,{sx:{p:x?0:2},children:[!x&&e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(s,{variant:"h6",sx:{fontWeight:"bold"},children:"All Inventory Levels"}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[h," category groups"]})]}),x?e.jsx(kr,{inventoryLevels:p,onManualAdjustment:v}):e.jsx(xr,{onManualAdjustment:v})]}),j===1&&e.jsx(o,{sx:{p:2},children:e.jsx(jr,{})})]}),e.jsx(Ir,{open:C,onClose:l,onSuccess:$,selectedCategoryGroupId:I==null?void 0:I.categoryGroupId,initialData:I?{categoryGroupId:I.categoryGroupId,movementType:"adjustment",quantity:I.currentInventory,reason:"correction",notes:`Adjusting inventory for ${I.name}`}:void 0}),e.jsx(Cr,{open:M,onClose:r,onSuccess:n})]});return x?e.jsx(rr,{pageTitle:"Inventory",children:i}):i};export{Lr as InventoryDashboard,Lr as default};
