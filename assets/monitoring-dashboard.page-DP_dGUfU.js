import{j as e,B as t,C as K,h as s,at as Q,au as X,av as Y,aw as d,k as b,ar as Z,bB as ee,a9 as a,V as m,ay as u,U as re,A as S,aa as se,z as te,ad as ne,a3 as C,a_ as ae,a$ as ie,b0 as oe,b1 as L,b2 as i,b4 as le,ai as R,T as ce,I as de,a0 as xe,aC as he}from"./mui-vendor-DlldRxor.js";import{a as o}from"./react-vendor-C0s_J9t-.js";import{u as me,ar as g}from"./index-D4QRAU_W.js";import{M as ue}from"./MobileAppShell-dHUJWRrR.js";import{f as z}from"./formatDistanceToNow-Df0H9vuf.js";import"./redux-vendor-tKFe_QvA.js";import"./firebase-vendor-40dJGoDN.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-DisdNAgy.js";import"./endOfMonth-CxaODxht.js";const Te=()=>{const w=me(),[T,A]=o.useState([]),[D,k]=o.useState([]),[H,N]=o.useState([]),[l,F]=o.useState({errorCount:0,avgPerformance:0,sessionCount:0,criticalErrors:0}),[O,I]=o.useState(!0),[j,U]=o.useState("24h"),[B,E]=o.useState(null);o.useEffect(()=>{p()},[j]);const p=()=>{I(!0);try{const r=g.getStoredErrors(),x=g.getStoredPerformanceMetrics(),q=g.getStoredAnalytics(),y=V(j),v=Date.now(),h=r.filter(n=>v-new Date(n.timestamp).getTime()<=y),c=x.filter(n=>v-new Date(n.timestamp).getTime()<=y),P=q.filter(n=>v-new Date(n.timestamp).getTime()<=y);A(h),k(c),N(P);const J=new Set([...h.map(n=>n.sessionId),...c.map(n=>n.sessionId),...P.map(n=>n.sessionId)]),_=c.length>0?c.reduce((n,$)=>n+$.metrics.pageLoadTime,0)/c.length:0;F({errorCount:h.length,avgPerformance:_,sessionCount:J.size,criticalErrors:h.filter(n=>n.severity==="critical").length})}catch(r){console.error("Failed to load monitoring data:",r)}finally{I(!1)}},V=r=>{switch(r){case"1h":return 60*60*1e3;case"6h":return 6*60*60*1e3;case"24h":return 24*60*60*1e3;case"7d":return 7*24*60*60*1e3;case"30d":return 30*24*60*60*1e3;default:return 24*60*60*1e3}},W=r=>{switch(r){case"critical":return"error";case"high":return"warning";case"medium":return"info";case"low":return"success";default:return"default"}},G=()=>{g.clearStoredData(),p()},f=r=>r<1e3?{rating:"Excellent",color:"success.main"}:r<2500?{rating:"Good",color:"info.main"}:r<4e3?{rating:"Fair",color:"warning.main"}:{rating:"Poor",color:"error.main"};if(O)return e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px"},children:e.jsx(K,{})});const M=e.jsxs(t,{sx:{padding:w?2:3},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3},children:[e.jsx(s,{variant:"h4",gutterBottom:!0,children:"Monitoring Dashboard"}),e.jsxs(t,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsxs(Q,{size:"small",sx:{minWidth:120},children:[e.jsx(X,{children:"Time Range"}),e.jsxs(Y,{value:j,label:"Time Range",onChange:r=>U(r.target.value),children:[e.jsx(d,{value:"1h",children:"Last Hour"}),e.jsx(d,{value:"6h",children:"Last 6 Hours"}),e.jsx(d,{value:"24h",children:"Last 24 Hours"}),e.jsx(d,{value:"7d",children:"Last 7 Days"}),e.jsx(d,{value:"30d",children:"Last 30 Days"})]})]}),e.jsx(b,{variant:"outlined",startIcon:e.jsx(Z,{}),onClick:p,children:"Refresh"}),e.jsx(b,{variant:"outlined",color:"error",startIcon:e.jsx(ee,{}),onClick:G,children:"Clear Data"})]})]}),e.jsxs(a,{container:!0,spacing:3,sx:{marginBottom:4},children:[e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{children:e.jsxs(u,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{children:[e.jsx(s,{color:"textSecondary",gutterBottom:!0,children:"Total Errors"}),e.jsx(s,{variant:"h4",children:l.errorCount})]}),e.jsx(re,{sx:{fontSize:40,color:"error.main"}})]}),l.criticalErrors>0&&e.jsxs(S,{severity:"error",sx:{marginTop:1},children:[l.criticalErrors," critical errors detected!"]})]})})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{children:e.jsx(u,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{children:[e.jsx(s,{color:"textSecondary",gutterBottom:!0,children:"Avg Page Load"}),e.jsxs(s,{variant:"h4",children:[Math.round(l.avgPerformance),"ms"]}),e.jsx(s,{variant:"body2",sx:{color:f(l.avgPerformance).color},children:f(l.avgPerformance).rating})]}),e.jsx(se,{sx:{fontSize:40,color:"primary.main"}})]})})})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{children:e.jsx(u,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{children:[e.jsx(s,{color:"textSecondary",gutterBottom:!0,children:"Active Sessions"}),e.jsx(s,{variant:"h4",children:l.sessionCount})]}),e.jsx(te,{sx:{fontSize:40,color:"success.main"}})]})})})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{children:e.jsx(u,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{children:[e.jsx(s,{color:"textSecondary",gutterBottom:!0,children:"Events Tracked"}),e.jsx(s,{variant:"h4",children:H.length})]}),e.jsx(ne,{sx:{fontSize:40,color:"info.main"}})]})})})})]}),e.jsxs(a,{container:!0,spacing:3,children:[e.jsx(a,{item:!0,xs:12,lg:8,children:e.jsxs(C,{sx:{padding:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Recent Errors"}),T.length===0?e.jsx(S,{severity:"success",children:"No errors detected in the selected time range."}):e.jsx(ae,{children:e.jsxs(ie,{children:[e.jsx(oe,{children:e.jsxs(L,{children:[e.jsx(i,{children:"Severity"}),e.jsx(i,{children:"Message"}),e.jsx(i,{children:"Time"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(le,{children:T.slice(0,10).map(r=>e.jsxs(L,{children:[e.jsx(i,{children:e.jsx(R,{label:r.severity.toUpperCase(),color:W(r.severity),size:"small"})}),e.jsx(i,{children:e.jsxs(s,{variant:"body2",sx:{maxWidth:300},children:[r.message.substring(0,100),r.message.length>100?"...":""]})}),e.jsx(i,{children:e.jsx(s,{variant:"body2",children:z(new Date(r.timestamp),{addSuffix:!0})})}),e.jsx(i,{children:e.jsx(ce,{title:"View Details",children:e.jsx(de,{size:"small",onClick:()=>E(r),children:e.jsx(xe,{})})})})]},r.id))})]})})]})}),e.jsx(a,{item:!0,xs:12,lg:4,children:e.jsxs(C,{sx:{padding:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Performance Metrics"}),D.length===0?e.jsx(S,{severity:"info",children:"No performance data available."}):e.jsx(t,{children:D.slice(0,5).map(r=>{const x=f(r.metrics.pageLoadTime);return e.jsxs(t,{sx:{marginBottom:2},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(s,{variant:"body2",children:["Load Time: ",Math.round(r.metrics.pageLoadTime),"ms"]}),e.jsx(R,{label:x.rating,size:"small",sx:{backgroundColor:x.color,color:"white"}})]}),e.jsx(he,{variant:"determinate",value:Math.min(r.metrics.pageLoadTime/5e3*100,100),sx:{marginTop:.5}}),e.jsx(s,{variant:"caption",color:"textSecondary",children:z(new Date(r.timestamp),{addSuffix:!0})})]},r.id)})})]})})]}),B&&e.jsxs(C,{sx:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",maxWidth:800,maxHeight:"80%",overflow:"auto",padding:3,zIndex:1300},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2},children:[e.jsx(s,{variant:"h6",children:"Error Details"}),e.jsx(b,{onClick:()=>E(null),children:"Close"})]}),e.jsx(s,{variant:"body2",component:"pre",sx:{backgroundColor:"grey.100",padding:2,borderRadius:1,fontSize:"0.8rem",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:JSON.stringify(B,null,2)})]})]});return w?e.jsx(ue,{pageTitle:"Monitoring",children:M}):M};export{Te as default};
