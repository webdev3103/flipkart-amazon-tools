import{j as e,B as a,h as n,A as P,k as C,c as Q,aF as z,ac as O,aC as A,aG as Y,D as _,p as Z,r as ee,o as se,bf as re,a3 as U,a$ as B,b0 as T,b1 as m,b2 as r,b4 as E,I as ne,aO as te,a_ as le,ai as N}from"./mui-vendor-DlldRxor.js";import{i as G,a as d,b as ae}from"./react-vendor-C0s_J9t-.js";import{i as H,j as q,aP as $,aO as ie,aQ as V,aR as J,aS as X,u as oe,aT as ce}from"./index-D4QRAU_W.js";import{M as de}from"./MobileAppShell-dHUJWRrR.js";import{M as I}from"./MobileCard-BmxjauOU.js";import"./redux-vendor-tKFe_QvA.js";import"./firebase-vendor-40dJGoDN.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-DisdNAgy.js";const xe=()=>{const h=H(),w=G(),R=d.useRef(null),D=ie(),{uploading:y,uploadProgress:F,error:t,successMessage:i}=q(l=>l.flipkartReturns),[o,c]=d.useState(null),[u,b]=d.useState([]),[g,f]=d.useState(null),[v,k]=d.useState(!1),M=d.useCallback(async l=>{c(l),b([]),f(null),k(!0);try{const s=await new $(l).process();if(!s||s.length===0){f("No valid returns found in file"),k(!1);return}b(s),k(!1)}catch(x){f(x instanceof Error?x.message:"Failed to parse file"),k(!1)}},[]),L=()=>{var l;(l=R.current)==null||l.click()},W=l=>{var s;const x=(s=l.target.files)==null?void 0:s[0];x&&M(x)},K=async()=>{if(o)try{await h(X(o)).unwrap(),c(null),b([])}catch{}},S=()=>{c(null),b([]),f(null),h(J())};return e.jsx(de,{pageTitle:"Upload Returns",showBackButton:!0,onBackClick:()=>w("/flipkart-returns"),children:e.jsxs(a,{sx:{flex:1,overflow:"auto",px:2,pt:2,pb:`calc(${D.bottom}px + 16px)`},children:[!o&&!i&&e.jsxs(I,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Upload a Flipkart Returns Excel file (.xlsx) to import return data."}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"The file should contain columns like return_id, order_item_id, sku, product_title, etc."})]}),(t||g)&&e.jsx(P,{severity:"error",onClose:()=>{h(V()),f(null)},sx:{mb:2},children:t||g}),i&&e.jsxs(P,{severity:"success",onClose:S,sx:{mb:2},icon:e.jsx(Q,{}),children:[i,e.jsx(C,{size:"small",onClick:()=>w("/flipkart-returns"),sx:{mt:1},fullWidth:!0,variant:"outlined",children:"View Returns List"})]}),e.jsx("input",{ref:R,type:"file",accept:".xlsx,.xls",onChange:W,style:{display:"none"}}),!o&&!i&&e.jsx(C,{variant:"contained",size:"large",fullWidth:!0,onClick:L,startIcon:e.jsx(z,{}),sx:{py:2},children:"Select Excel File"}),v&&e.jsx(I,{sx:{mt:2},children:e.jsxs(O,{spacing:2,alignItems:"center",children:[e.jsx(n,{variant:"body2",children:"Parsing file..."}),e.jsx(A,{sx:{width:"100%"}})]})}),o&&!v&&u.length>0&&!i&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{sx:{mt:2,mb:2},children:[e.jsxs(O,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(Y,{color:"action"}),e.jsxs(a,{sx:{flex:1},children:[e.jsx(n,{variant:"body2",fontWeight:"medium",children:o.name}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:[(o.size/1024).toFixed(1)," KB"]})]})]}),e.jsx(_,{sx:{my:2}}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Preview: ",u.length," return",u.length!==1?"s":""," found"]})]}),e.jsxs(I,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",fontWeight:"medium",gutterBottom:!0,children:"First 5 Returns"}),e.jsx(Z,{dense:!0,disablePadding:!0,children:u.slice(0,5).map((l,x)=>e.jsxs(ae.Fragment,{children:[x>0&&e.jsx(_,{}),e.jsx(ee,{disablePadding:!0,sx:{py:1},children:e.jsx(se,{primary:l.productTitle,secondary:e.jsxs(e.Fragment,{children:["Return ID: ",l.returnId,e.jsx("br",{}),"SKU: ",l.sku," • Qty: ",l.quantity]}),primaryTypographyProps:{variant:"body2",noWrap:!0},secondaryTypographyProps:{variant:"caption"}})})]},l.returnId))})]}),y&&e.jsxs(I,{sx:{mb:2},children:[e.jsxs(n,{variant:"body2",gutterBottom:!0,children:["Uploading... ",F,"%"]}),e.jsx(A,{variant:"determinate",value:F})]}),e.jsxs(O,{spacing:2,children:[e.jsx(C,{variant:"contained",size:"large",fullWidth:!0,onClick:K,disabled:y,startIcon:e.jsx(z,{}),children:y?"Uploading...":"Upload Returns"}),e.jsx(C,{variant:"outlined",size:"large",fullWidth:!0,onClick:S,disabled:y,children:"Cancel"})]})]})]})})},ke=()=>oe()?e.jsx(xe,{}):e.jsx(he,{}),he=()=>{const h=H(),w=G(),{uploading:R,uploadProgress:D,error:y,successMessage:F,inventoryRestoration:t}=q(s=>s.flipkartReturns),[i,o]=d.useState(null),[c,u]=d.useState([]),[b,g]=d.useState(null),[f,v]=d.useState(!1),k=d.useCallback(async s=>{o(s),u([]),g(null),v(!0);try{const j=await new $(s).process();if(!j||j.length===0){g("No valid returns found in file. Please check the file format."),v(!1);return}u(j),v(!1)}catch(p){g(p instanceof Error?p.message:"Failed to parse file. Please ensure it is a valid Flipkart Returns Excel file."),v(!1)}},[]),M=s=>{var j;const p=(j=s.target.files)==null?void 0:j[0];p&&k(p)},L=s=>{s.preventDefault(),s.stopPropagation()},W=s=>{var j;s.preventDefault(),s.stopPropagation();const p=(j=s.dataTransfer.files)==null?void 0:j[0];p&&k(p)},K=async()=>{if(i)try{await h(X(i)).unwrap(),o(null),u([])}catch{}},S=()=>{o(null),u([]),g(null),h(J())},l=()=>{h(V())},x=()=>{h(ce())};return e.jsxs(a,{sx:{p:3},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(C,{startIcon:e.jsx(re,{}),onClick:()=>w("/flipkart-returns"),children:"Back to List"}),e.jsx(n,{variant:"h4",children:"Upload Flipkart Returns"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Upload Flipkart Returns Excel file to import return data. The file should contain return information including Return ID, Order ID, SKU, and financial details."}),y&&e.jsx(P,{severity:"error",onClose:l,sx:{mb:2},children:y}),F&&e.jsx(P,{severity:"success",onClose:x,sx:{mb:2},children:F}),t&&(t.restored.length>0||t.errors.length>0||t.skipped.length>0)&&e.jsxs(U,{sx:{p:2,mb:2,bgcolor:"background.default"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Inventory Restoration Summary"}),t.restored.length>0&&e.jsxs(a,{sx:{mb:2},children:[e.jsxs(n,{variant:"subtitle2",color:"success.main",gutterBottom:!0,children:["✓ Restored to Inventory (",t.restored.length," items)"]}),e.jsxs(B,{size:"small",children:[e.jsx(T,{children:e.jsxs(m,{children:[e.jsx(r,{children:"SKU"}),e.jsx(r,{children:"Return ID"}),e.jsx(r,{align:"right",children:"Quantity"}),e.jsx(r,{children:"Category Group"})]})}),e.jsx(E,{children:t.restored.slice(0,5).map(s=>e.jsxs(m,{children:[e.jsx(r,{children:s.sku}),e.jsx(r,{children:s.returnId}),e.jsx(r,{align:"right",children:s.quantity}),e.jsx(r,{children:s.categoryGroupId})]},s.returnId))})]}),t.restored.length>5&&e.jsxs(n,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["... and ",t.restored.length-5," more"]})]}),t.skipped.length>0&&e.jsxs(a,{sx:{mb:2},children:[e.jsxs(n,{variant:"subtitle2",color:"warning.main",gutterBottom:!0,children:["⚠ Skipped (",t.skipped.length," items)"]}),e.jsxs(B,{size:"small",children:[e.jsx(T,{children:e.jsxs(m,{children:[e.jsx(r,{children:"SKU"}),e.jsx(r,{children:"Return ID"}),e.jsx(r,{children:"Reason"})]})}),e.jsx(E,{children:t.skipped.slice(0,5).map(s=>e.jsxs(m,{children:[e.jsx(r,{children:s.sku}),e.jsx(r,{children:s.returnId}),e.jsx(r,{children:s.reason})]},s.returnId))})]}),t.skipped.length>5&&e.jsxs(n,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["... and ",t.skipped.length-5," more"]})]}),t.errors.length>0&&e.jsxs(a,{children:[e.jsxs(n,{variant:"subtitle2",color:"error.main",gutterBottom:!0,children:["✗ Failed (",t.errors.length," items)"]}),e.jsxs(B,{size:"small",children:[e.jsx(T,{children:e.jsxs(m,{children:[e.jsx(r,{children:"SKU"}),e.jsx(r,{children:"Return ID"}),e.jsx(r,{children:"Error"})]})}),e.jsx(E,{children:t.errors.slice(0,5).map(s=>e.jsxs(m,{children:[e.jsx(r,{children:s.sku}),e.jsx(r,{children:s.returnId}),e.jsx(r,{children:s.error})]},s.returnId))})]}),t.errors.length>5&&e.jsxs(n,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["... and ",t.errors.length-5," more"]})]})]}),b&&e.jsx(P,{severity:"error",onClose:()=>g(null),sx:{mb:2},children:b}),!i&&e.jsxs(U,{sx:{p:4,textAlign:"center",border:"2px dashed",borderColor:"primary.main",bgcolor:"action.hover",cursor:"pointer","&:hover":{bgcolor:"action.selected"}},onDragOver:L,onDrop:W,children:[e.jsx("input",{accept:".xlsx,.xls",style:{display:"none"},id:"file-upload",type:"file",onChange:M}),e.jsx("label",{htmlFor:"file-upload",children:e.jsxs(a,{sx:{cursor:"pointer"},children:[e.jsx(z,{sx:{fontSize:64,color:"primary.main",mb:2}}),e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Drag & Drop or Click to Upload"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Supported formats: Excel (.xlsx, .xls)"})]})})]}),i&&!f&&e.jsxs(a,{children:[e.jsx(U,{sx:{p:2,mb:2},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{color:"success"}),e.jsxs(n,{variant:"body1",children:[e.jsx("strong",{children:i.name})," (",(i.size/1024).toFixed(2)," KB)"]})]}),e.jsx(ne,{onClick:S,size:"small",children:e.jsx(te,{})})]})}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"h6",gutterBottom:!0,children:["Preview (",c.length," returns)"]}),e.jsx(le,{component:U,sx:{mb:2,maxHeight:400},children:e.jsxs(B,{stickyHeader:!0,size:"small",children:[e.jsx(T,{children:e.jsxs(m,{children:[e.jsx(r,{children:"Return ID"}),e.jsx(r,{children:"Order ID"}),e.jsx(r,{children:"SKU"}),e.jsx(r,{children:"Product"}),e.jsx(r,{children:"Reason"}),e.jsx(r,{children:"Status"}),e.jsx(r,{align:"right",children:"Refund Amount"}),e.jsx(r,{align:"right",children:"Net Loss"})]})}),e.jsx(E,{children:c.slice(0,10).map(s=>e.jsxs(m,{children:[e.jsx(r,{children:s.returnId}),e.jsx(r,{children:s.orderId}),e.jsx(r,{children:s.sku}),e.jsx(r,{children:e.jsx(n,{variant:"body2",noWrap:!0,sx:{maxWidth:200},children:s.productTitle})}),e.jsx(r,{children:e.jsx(N,{label:s.returnReasonCategory,size:"small",color:s.returnReasonCategory==="Defective"||s.returnReasonCategory==="Quality Issue"?"error":"default"})}),e.jsx(r,{children:e.jsx(N,{label:s.returnStatus,size:"small"})}),e.jsxs(r,{align:"right",children:["₹",s.financials.refundAmount.toFixed(2)]}),e.jsx(r,{align:"right",children:e.jsxs(n,{variant:"body2",color:s.financials.netLoss>0?"error":"success",children:["₹",s.financials.netLoss.toFixed(2)]})})]},s.returnId))})]})}),c.length>10&&e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Showing first 10 of ",c.length," returns"]}),R&&e.jsxs(a,{sx:{mb:2},children:[e.jsx(A,{variant:"determinate",value:D}),e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Uploading... ",D,"%"]})]}),e.jsxs(a,{sx:{display:"flex",gap:2},children:[e.jsxs(C,{variant:"contained",color:"primary",startIcon:e.jsx(z,{}),onClick:K,disabled:R||c.length===0,children:["Upload ",c.length," Returns"]}),e.jsx(C,{variant:"outlined",onClick:S,disabled:R,children:"Cancel"})]})]})]}),f&&e.jsxs(a,{sx:{textAlign:"center",py:4},children:[e.jsx(A,{}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Parsing file..."})]})]})};export{ke as default};
